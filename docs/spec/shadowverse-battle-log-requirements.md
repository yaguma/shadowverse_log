# シャドウバース対戦履歴管理 要件定義書

## 概要

シャドウバースの対戦履歴を登録・一覧表示し、統計分析機能を提供するWebアプリケーション。個人利用を想定したMVP/プロトタイプとして段階的に開発・リリースを行う。

**プロジェクトタイプ**: Webアプリケーション (MVP/プロトタイプ)
**対象ユーザー**: シャドウバースプレイヤー (個人利用)
**開発方針**: 段階的実装・リリース (フェーズ1 → フェーズ2)
**想定データ量**: 1ユーザーあたり1,000件程度 (1年分)

## 関連文書

- **ユーザストーリー**: [📖 shadowverse-battle-log-user-stories.md](shadowverse-battle-log-user-stories.md)
- **受け入れ基準**: [✅ shadowverse-battle-log-acceptance-criteria.md](shadowverse-battle-log-acceptance-criteria.md)
- **技術スタック定義**: [🔧 ../tech-stack.md](../tech-stack.md)

## 機能要件（EARS記法）

**【信頼性レベル凡例】**:
- 🔵 **青信号**: EARS要件定義書・設計文書・ユーザヒアリングを参考にした確実な要件
- 🟡 **黄信号**: EARS要件定義書・設計文書・ユーザヒアリングから妥当な推測による要件
- 🔴 **赤信号**: EARS要件定義書・設計文書・ユーザヒアリングにない推測による要件

### フェーズ1: 基本機能

#### 通常要件（SHALL）

##### 対戦履歴登録機能

- **REQ-001**: システムはダイアログ形式で対戦履歴の新規登録機能を提供しなければならない 🔵 *ユーザヒアリング2025-10-23より*
- **REQ-002**: システムは以下の8項目を対戦履歴として記録しなければならない 🔵 *既存データ構造(battle-logs.json)・ユーザヒアリングより*
  - 日付 (date)
  - 対戦タイプ (battleType): ランクマッチ/対戦台/ロビー大会
  - ランク (rank): サファイア/ダイアモンド/ルビー/トパーズ/"-"
  - グループ (group): A/AA/AAA/Master など
  - マイデッキID (myDeckId)
  - ターン (turn): 先行/後攻
  - 結果 (result): WIN/LOSE
  - 相手デッキID (opponentDeckId)
- **REQ-003**: システムは前回入力した値をデフォルト値として次回登録フォームに引き継がなければならない 🔵 *ユーザヒアリング2025-10-23より*
- **REQ-004**: システムはすべての入力項目を必須項目として扱わなければならない 🔵 *ユーザヒアリング2025-10-23より*
- **REQ-005**: システムは入力完了後、一覧画面に新規登録データを即座に反映しなければならない 🟡 *一般的なUX要件から妥当な推測*

##### 対戦履歴一覧表示機能

- **REQ-101**: システムは対戦履歴を一覧形式で表示しなければならない 🔵 *README.md・ユーザヒアリングより*
- **REQ-102**: システムは直近1週間の対戦履歴を最大100件まで表示しなければならない 🔵 *README.md・ユーザヒアリングより*
- **REQ-103**: システムは対戦履歴を日付順（降順）でソート表示しなければならない 🔵 *ユーザヒアリング2025-10-23より*
- **REQ-104**: システムは一覧から各履歴の詳細情報を表示する機能を提供しなければならない 🔵 *ユーザヒアリング2025-10-23より*
- **REQ-105**: システムは一覧から各履歴を削除する機能を提供しなければならない 🔵 *ユーザヒアリング2025-10-23より*
- **REQ-106**: システムは一覧表示時にマイデッキID・相手デッキIDを対応するデッキ名で表示しなければならない 🟡 *データ構造(deck-master.json)から妥当な推測*

##### 統計・分析ダッシュボード機能

- **REQ-201**: システムは独立した統計・分析ダッシュボード画面を提供しなければならない 🔵 *ユーザヒアリング2025-10-23より*
- **REQ-202**: システムは集計期間を選択可能な機能を提供しなければならない 🔵 *ユーザヒアリング2025-10-23より*
- **REQ-203**: システムは以下の統計情報を表示しなければならない 🔵 *ユーザヒアリング2025-10-23より*
  - 全体の勝率 (WIN/LOSE の割合)
  - デッキタイプ別の勝率 (自分のデッキごと)
  - 対戦相手デッキ別の勝率
  - ランク帯別の成績 (サファイア/ダイアモンド/ルビー)
- **REQ-204**: システムは対戦相手デッキ分布を円グラフで表示しなければならない 🔵 *ユーザヒアリング2025-10-23より*
- **REQ-205**: システムは統計情報をリアルタイムに計算・表示しなければならない 🟡 *パフォーマンス要件から妥当な推測*

##### データインポート機能

- **REQ-301**: システムはJSON形式のファイルから対戦履歴データをインポートする機能を提供しなければならない 🔵 *ユーザヒアリング2025-10-23より*
- **REQ-302**: システムはCSV形式のファイルから対戦履歴データをインポートする機能を提供しなければならない 🔵 *ユーザヒアリング2025-10-23より*
- **REQ-303**: システムはインポート時にデータ形式の妥当性を検証しなければならない 🟡 *データ整合性要件から妥当な推測*

#### 条件付き要件（WHEN/IF-THEN）

- **REQ-401**: 日付入力時に未来の日付が入力された場合、システムはエラーメッセージを表示しなければならない 🔵 *ユーザヒアリング2025-10-23より*
- **REQ-402**: 必須項目が未入力の場合、システムは該当項目にインラインエラーメッセージを表示しなければならない 🔵 *ユーザヒアリング2025-10-23より*
- **REQ-403**: 削除操作が実行された場合、システムは確認ダイアログを表示しなければならない 🟡 *一般的なUX要件から妥当な推測*
- **REQ-404**: データインポート時に不正な形式のファイルが指定された場合、システムは具体的なエラー内容を表示しなければならない 🟡 *エラーハンドリング要件から妥当な推測*
- **REQ-405**: 集計期間にデータが存在しない場合、システムは「データなし」のメッセージを表示しなければならない 🟡 *一般的なUX要件から妥当な推測*

#### 状態要件（WHERE）

- **REQ-501**: 対戦履歴が0件の状態である場合、システムは一覧画面に「データが登録されていません」のメッセージを表示しなければならない 🟡 *一般的なUX要件から妥当な推測*
- **REQ-502**: データ読み込み中の状態である場合、システムはローディングインジケーターを表示しなければならない 🟡 *一般的なUX要件から妥当な推測*

#### 制約要件（MUST）

- **REQ-601**: システムは既存のJSONデータ形式 (battle-logs.json, deck-master.json, my-decks.json) との互換性を保たなければならない 🔵 *既存データ構造より*
- **REQ-602**: システムはAzure Blob StorageにJSONファイルとしてデータを保存しなければならない 🔵 *ユーザヒアリング2025-10-23より*
- **REQ-603**: システムはPC・スマートフォンの両方に対応したレスポンシブデザインでなければならない 🔵 *ユーザヒアリング2025-10-23より*
- **REQ-604**: システムはAzure Static Web Apps + Azure Functionsで動作しなければならない 🔵 *ユーザヒアリング2025-10-23より*

### フェーズ2: 追加機能

#### 通常要件（SHALL）

##### 認証機能

- **REQ-701**: システムはAzure AD B2Cによるユーザー認証機能を提供しなければならない 🔵 *ユーザヒアリング2025-10-23より*
- **REQ-702**: システムは認証済みユーザーのみが対戦履歴にアクセスできるようにしなければならない 🟡 *セキュリティ要件から妥当な推測*

##### マイデッキ管理機能

- **REQ-801**: システムは複数のマイデッキを登録・管理する機能を提供しなければならない 🔵 *ユーザヒアリング2025-10-23より*
- **REQ-802**: システムはマイデッキの追加・編集・削除機能を提供しなければならない 🔵 *ユーザヒアリング2025-10-23より*
- **REQ-803**: システムは使用中のマイデッキを切り替える機能を提供しなければならない 🟡 *既存データ構造(my-decks.json isActive)から妥当な推測*

##### デッキマスター管理機能

- **REQ-901**: システムはユーザーが独自のデッキタイプを追加する機能を提供しなければならない 🔵 *ユーザヒアリング2025-10-23より*
- **REQ-902**: システムはユーザーがデッキタイプを編集・削除する機能を提供しなければならない 🔵 *ユーザヒアリング2025-10-23より*

##### データエクスポート機能

- **REQ-1001**: システムは対戦履歴をJSON形式でエクスポートする機能を提供しなければならない 🔵 *ユーザヒアリング2025-10-23より*
- **REQ-1002**: システムは対戦履歴をCSV形式でエクスポートする機能を提供しなければならない 🔵 *ユーザヒアリング2025-10-23より*

##### PWA対応

- **REQ-1101**: システムはホーム画面への追加機能を提供しなければならない 🔵 *ユーザヒアリング2025-10-23より*
- **REQ-1102**: システムはオフライン時の基本機能（閲覧）を提供しなければならない 🟡 *PWA要件から妥当な推測*

## 非機能要件

### パフォーマンス

- **NFR-001**: システムはページ読み込み時間を3秒以内に収めなければならない 🔵 *tech-stack.md・ユーザヒアリングより*
- **NFR-002**: システムは同時利用者数10人以下の軽負荷環境で安定動作しなければならない 🔵 *tech-stack.mdより*
- **NFR-003**: システムは1ユーザーあたり1,000件のデータを快適に処理できなければならない 🔵 *ユーザヒアリング2025-10-23より*

### セキュリティ

- **NFR-101**: システムはHTTPS通信を必須とし、すべてのデータ通信を暗号化しなければならない 🔵 *tech-stack.md・CLAUDE.mdより*
- **NFR-102**: システムは環境変数でAPIキー・接続文字列を管理しなければならない 🔵 *CLAUDE.mdより*
- **NFR-103**: システムはすべての外部入力に対してバリデーションを実施しなければならない 🔵 *CLAUDE.mdより*
- **NFR-104**: システムはAzure AD B2C認証により個人データを保護しなければならない（フェーズ2） 🔵 *ユーザヒアリング2025-10-23より*

### ユーザビリティ

- **NFR-201**: システムは直感的な操作でデータ登録が完了できるUIを提供しなければならない 🟡 *一般的なUX要件から妥当な推測*
- **NFR-202**: システムはエラーメッセージを分かりやすい日本語で表示しなければならない 🟡 *一般的なUX要件から妥当な推測*
- **NFR-203**: システムはPC・スマートフォンの両方で快適に操作できるレスポンシブデザインを提供しなければならない 🔵 *ユーザヒアリング2025-10-23より*
- **NFR-204**: システムはローディング状態を視覚的に表示しなければならない 🟡 *一般的なUX要件から妥当な推測*

### 保守性・テスタビリティ

- **NFR-301**: システムはTypeScript strict modeで型安全性を確保しなければならない 🔵 *tech-stack.md・CLAUDE.mdより*
- **NFR-302**: システムは可能な範囲でTDD（テスト駆動開発）を適用しなければならない 🔵 *ユーザヒアリング2025-10-23より*
- **NFR-303**: システムは可能な範囲でゼロ警告ポリシーを適用しなければならない 🔵 *ユーザヒアリング2025-10-23より*
- **NFR-304**: システムはUnit テストとE2E テストを実装しなければならない 🔵 *ユーザヒアリング2025-10-23より*
- **NFR-305**: システムはGitHub Actionsで自動テスト・デプロイを実行しなければならない 🔵 *ユーザヒアリング2025-10-23より*

### 互換性

- **NFR-401**: システムは既存のJSONデータ形式との後方互換性を維持しなければならない 🔵 *既存データ構造より*
- **NFR-402**: システムは主要モダンブラウザ（Chrome, Edge, Safari, Firefox）の最新2バージョンで動作しなければならない 🟡 *一般的な互換性要件から妥当な推測*

### 可用性

- **NFR-501**: システムはAzureの無料枠・低コスト枠で運用可能でなければならない 🔵 *tech-stack.mdより*
- **NFR-502**: システムはAzure Blob Storageの障害時にエラーメッセージを表示しなければならない 🟡 *信頼性要件から妥当な推測*

## Edgeケース

### エラー処理

- **EDGE-001**: システムはネットワークエラー時に適切なエラーメッセージとリトライ機能を提供しなければならない 🟡 *CLAUDE.md信頼性要件から妥当な推測*
- **EDGE-002**: システムはAzure Blob Storage接続エラー時に適切なフォールバック処理を実施しなければならない 🟡 *CLAUDE.md信頼性要件から妥当な推測*
- **EDGE-003**: システムはインポートファイルが不正な形式の場合に具体的なエラー箇所を指摘しなければならない 🟡 *エラーハンドリング要件から妥当な推測*

### 境界値

- **EDGE-101**: システムは対戦履歴が0件の場合でも統計画面を表示できなければならない 🟡 *一般的なUX要件から妥当な推測*
- **EDGE-102**: システムは対戦履歴が1,000件を超える場合でもパフォーマンスを維持しなければならない 🔵 *ユーザヒアリング2025-10-23データ量より*
- **EDGE-103**: システムは同一日付に複数の対戦履歴が存在する場合でも正しくソート表示しなければならない 🟡 *データ整合性要件から妥当な推測*

### データ整合性

- **EDGE-201**: システムは存在しないデッキIDが指定された場合に「不明なデッキ」として表示しなければならない 🟡 *データ整合性要件から妥当な推測*
- **EDGE-202**: システムは削除済みマイデッキが過去の対戦履歴で参照されている場合でもデータ表示を継続しなければならない 🟡 *データ整合性要件から妥当な推測*

## 優先順位（MoSCoW分析）

### Must Have（必須 - フェーズ1）

- 対戦履歴登録機能（REQ-001 ~ REQ-005）
- 対戦履歴一覧表示機能（REQ-101 ~ REQ-106）
- 統計・分析ダッシュボード機能（REQ-201 ~ REQ-205）
- データインポート機能（REQ-301 ~ REQ-303）

### Should Have（重要 - フェーズ2）

- 認証機能（REQ-701 ~ REQ-702）
- マイデッキ管理機能（REQ-801 ~ REQ-803）
- デッキマスター管理機能（REQ-901 ~ REQ-902）
- データエクスポート機能（REQ-1001 ~ REQ-1002）

### Could Have（あれば望ましい - フェーズ2）

- PWA対応（REQ-1101 ~ REQ-1102）

### Won't Have（今回は対象外）

- 複数ユーザー間でのデータ共有機能
- リアルタイム対戦記録機能
- AIによるデッキ推奨機能

## 制約事項

### 技術的制約

- Azure無料枠・低コスト枠での運用
- Azure Blob StorageのJSON形式でのデータ管理
- 個人開発・MVP段階のため複雑な機能は後回し

### ビジネス的制約

- 個人利用を想定（商用化は未定）
- 開発期間に明確な期限なし
- 予算最小化（無料枠優先）

### 外部依存

- Azure Static Web Apps
- Azure Functions
- Azure Blob Storage
- Azure AD B2C（フェーズ2）
- シャドウバースのデッキ情報（ゲーム仕様変更の影響あり）

## 用語集

| 用語 | 定義 |
|------|------|
| 対戦履歴 | シャドウバースの1試合分の記録（日付、デッキ、結果など） |
| マイデッキ | ユーザーが使用するデッキの登録情報 |
| デッキマスター | 対戦相手のデッキタイプのマスターデータ |
| 対戦タイプ | ランクマッチ、対戦台、ロビー大会などの対戦モード |
| ランク | ランクマッチのランク帯（サファイア、ダイアモンド、ルビー等） |
| ターン | 先行・後攻の順番 |

## 更新履歴

- **2025-10-23**: 初版作成（tsumiki:kairo-requirements により自動生成）
  - フェーズ1（基本機能）・フェーズ2（追加機能）の要件定義
  - ユーザヒアリング2025-10-23の内容を反映
  - 既存データ構造（battle-logs.json, deck-master.json, my-decks.json）との整合性確保
