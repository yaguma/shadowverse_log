# Statistics Dashboard グラフ表示機能 要件定義書

## 概要

Statistics Dashboard（統計ダッシュボード）に対戦相手デッキ分布の円グラフ表示機能を追加する。TASK-0018で実装された基本統計表示に、視覚的なグラフ表示を統合し、ユーザーが環境（メタゲーム）を直感的に把握できるようにする。

**タスクID**: TASK-0019
**タスク名**: Statistics Dashboard実装 - グラフ表示
**プロジェクトタイプ**: Webアプリケーション（Phase 1 MVP）
**対象ユーザー**: シャドウバースプレイヤー（個人利用）
**開発方針**: TDD（テスト駆動開発）
**前提タスク**: TASK-0018（基本統計表示）完了済み

## 関連文書

- **ユーザストーリー**: [📖 task-0019-user-stories.md](task-0019-user-stories.md)
- **受け入れ基準**: [✅ task-0019-acceptance-criteria.md](task-0019-acceptance-criteria.md)
- **親要件定義書**: [📋 shadowverse-battle-log-requirements.md](shadowverse-battle-log-requirements.md)
- **TASK-0018要件定義**: [📋 ../implements/shadowverse-battle-log/TASK-0018/statistics-dashboard-requirements.md](../implements/shadowverse-battle-log/TASK-0018/statistics-dashboard-requirements.md)

## 機能要件（EARS記法）

**【信頼性レベル凡例】**:
- 🔵 **青信号**: EARS要件定義書・設計文書・ユーザヒアリングを参考にした確実な要件
- 🟡 **黄信号**: EARS要件定義書・設計文書・ユーザヒアリングから妥当な推測による要件
- 🔴 **赤信号**: EARS要件定義書・設計文書・ユーザヒアリングにない推測による要件

### 通常要件（SHALL）

#### 対戦相手デッキ分布の円グラフ表示

- **REQ-GRAPH-001**: システムは統計ダッシュボードに対戦相手デッキ分布を円グラフで表示しなければならない 🔵 *REQ-204・ユーザヒアリング2025-10-23・2025-11-09より*

- **REQ-GRAPH-002**: システムは円グラフの各セグメントに対戦相手デッキ名を表示しなければならない 🔵 *ユーザヒアリング2025-11-09より*

- **REQ-GRAPH-003**: システムは円グラフにデッキタイプごとの対戦回数と割合（%）を表示しなければならない 🔵 *ユーザストーリー3.3・ユーザヒアリング2025-11-09より*

- **REQ-GRAPH-004**: システムは円グラフの凡例にデッキ名と対戦回数を表示しなければならない 🔵 *ユーザストーリー3.3・ユーザヒアリング2025-11-09より*

- **REQ-GRAPH-005**: システムはデッキタイプごとに固定のカラーパレットを使用しなければならない 🔵 *ユーザヒアリング2025-11-09より*

#### グラフのレイアウトと配置

- **REQ-GRAPH-006**: システムは円グラフをデッキ別統計テーブルの横に配置しなければならない 🔵 *ユーザヒアリング2025-11-09 レイアウト案Bより*

- **REQ-GRAPH-007**: システムはPC表示時に2カラムレイアウト（テーブル | グラフ）で表示しなければならない 🔵 *ユーザヒアリング2025-11-09より*

- **REQ-GRAPH-008**: システムはモバイル表示時に円グラフのみを1カラムレイアウトで表示しなければならない 🔵 *ユーザヒアリング2025-11-09 Q5より*

#### グラフのインタラクティブ機能

- **REQ-GRAPH-009**: システムは円グラフのセグメントにマウスホバーした際にツールチップを表示しなければならない 🔵 *ユーザヒアリング2025-11-09 Q3より*

- **REQ-GRAPH-010**: システムはツールチップにデッキ名、対戦回数、割合（%）を表示しなければならない 🟡 *一般的なUX要件から妥当な推測*

#### グラフのデザインとアニメーション

- **REQ-GRAPH-011**: システムは円グラフをアニメーションなしで即座に表示しなければならない 🔵 *ユーザヒアリング2025-11-09 Q4-Bより*

- **REQ-GRAPH-012**: システムはPC版とモバイル版で同じアスペクト比の円グラフを表示しなければならない 🔵 *ユーザヒアリング2025-11-09 Q5-Bより*

### 条件付き要件（WHEN/IF-THEN）

- **REQ-GRAPH-101**: 集計期間にデータが0件の場合、システムは円グラフの代わりに「データなし」メッセージを表示しなければならない 🟡 *REQ-405から妥当な推測*

- **REQ-GRAPH-102**: 対戦相手デッキが1種類のみの場合、システムは100%の単一セグメント円グラフを表示しなければならない 🟡 *エッジケース要件から妥当な推測*

- **REQ-GRAPH-103**: 期間選択が変更された場合、システムは円グラフをリアルタイムに再描画しなければならない 🔵 *REQ-205・ユーザヒアリング2025-11-09より*

### 状態要件（WHERE）

- **REQ-GRAPH-201**: データ読み込み中の状態である場合、システムは円グラフの位置にローディングインジケーターを表示しなければならない 🟡 *REQ-502から妥当な推測*

### 制約要件（MUST）

- **REQ-GRAPH-301**: システムはRechartsライブラリ v3.3.0を使用して円グラフを実装しなければならない 🔵 *tech-stack.md・既存実装より*

- **REQ-GRAPH-302**: システムはReact 19のコンポーネントとして円グラフを実装しなければならない 🔵 *tech-stack.mdより*

- **REQ-GRAPH-303**: システムはTypeScript strict modeで型安全性を確保しなければならない 🔵 *CLAUDE.md・NFR-301より*

- **REQ-GRAPH-304**: システムはTailwind CSSを使用してレスポンシブレイアウトを実装しなければならない 🔵 *tech-stack.mdより*

- **REQ-GRAPH-305**: システムは既存のStatisticsDashboardPageコンポーネントに統合する形で実装しなければならない 🔵 *TASK-0018実装より*

## 非機能要件

### パフォーマンス

- **NFR-GRAPH-001**: システムは円グラフの描画を500ms以内に完了しなければならない 🟡 *NFR-001から妥当な推測*

- **NFR-GRAPH-002**: システムは1,000件のデータから円グラフを生成し、1秒以内に表示しなければならない 🔵 *NFR-003・ユーザヒアリング2025-10-23より*

### ユーザビリティ

- **NFR-GRAPH-101**: システムは円グラフの各セグメントを視覚的に区別しやすい色で表示しなければならない 🟡 *NFR-201から妥当な推測*

- **NFR-GRAPH-102**: システムは円グラフの凡例を読みやすいフォントサイズで表示しなければならない 🟡 *NFR-202から妥当な推測*

- **NFR-GRAPH-103**: システムはモバイル表示時に円グラフをタップ可能なサイズで表示しなければならない 🟡 *NFR-203から妥当な推測*

### 保守性・テスタビリティ

- **NFR-GRAPH-201**: システムは円グラフコンポーネントを独立したReactコンポーネントとして実装しなければならない 🔵 *CLAUDE.md・設計原則より*

- **NFR-GRAPH-202**: システムは円グラフコンポーネントのUnit テストを実装しなければならない 🔵 *NFR-304・ユーザヒアリング2025-10-23より*

- **NFR-GRAPH-203**: システムはTDD（テスト駆動開発）プロセスに従って実装しなければならない 🔵 *NFR-302・ユーザヒアリング2025-10-23より*

### アクセシビリティ

- **NFR-GRAPH-301**: システムは円グラフに適切なaria-label属性を設定しなければならない 🟡 *アクセシビリティ要件から妥当な推測*

- **NFR-GRAPH-302**: システムは色覚多様性に配慮したカラーパレットを使用しなければならない 🟡 *アクセシビリティ要件から妥当な推測*

## Edgeケース

### エラー処理

- **EDGE-GRAPH-001**: システムはRecharts描画エラー時に適切なエラーメッセージを表示しなければならない 🟡 *EDGE-001から妥当な推測*

- **EDGE-GRAPH-002**: システムは不正なデータ形式の場合にグラフ描画をスキップし、エラーメッセージを表示しなければならない 🟡 *エラーハンドリング要件から妥当な推測*

### 境界値

- **EDGE-GRAPH-101**: システムは対戦相手デッキが20種類以上の場合でも円グラフを正しく表示しなければならない 🟡 *境界値要件から妥当な推測*

- **EDGE-GRAPH-102**: システムは特定のデッキの対戦回数が1回の場合でも円グラフのセグメントを表示しなければならない 🟡 *境界値要件から妥当な推測*

- **EDGE-GRAPH-103**: システムは同率のデッキが複数存在する場合、デッキ名の辞書順でソートして表示しなければならない 🟡 *データ整合性要件から妥当な推測*

### データ整合性

- **EDGE-GRAPH-201**: システムは存在しないデッキIDが統計データに含まれる場合、「不明なデッキ」として表示しなければならない 🟡 *EDGE-201から妥当な推測*

## 実装スコープ

### TASK-0019で実装する機能

1. **OpponentDeckPieChart コンポーネント** - 対戦相手デッキ分布の円グラフコンポーネント
   - Recharts PieChartを使用
   - カスタムカラーパレット適用
   - ツールチップ表示
   - 凡例表示

2. **StatisticsDashboardPage 更新** - 円グラフの統合
   - デッキ別統計テーブルと円グラフの2カラムレイアウト実装
   - レスポンシブ対応（モバイルは円グラフのみ）

3. **カラーパレット定義** - デッキタイプごとの固定色定義
   - `frontend/src/constants/deckColors.ts` 作成
   - 色覚多様性に配慮したカラー選定

4. **Unit テスト実装**
   - OpponentDeckPieChart.test.tsx
   - データ描画の正常系テスト
   - エッジケーステスト

### TASK-0019で実装しない機能（将来の拡張）

- 時系列の勝率推移折れ線グラフ（Phase 2以降）
- マイデッキ別勝率の棒グラフ（Phase 2以降）
- グラフのクリックによるフィルタリング機能（Phase 2以降）
- グラフのアニメーション効果（Phase 2以降）

## 技術仕様

### 使用ライブラリ

- **Recharts**: v3.3.0（円グラフ描画）
- **React**: v19.1.1（コンポーネント実装）
- **TypeScript**: v5.x（型安全性）
- **Tailwind CSS**: レスポンシブレイアウト

### コンポーネント構成

```
StatisticsDashboardPage
├── PeriodSelector
├── OverallStats
├── <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
│   ├── DeckStatsTable (既存)
│   └── OpponentDeckPieChart (新規)
├── RankStatsTable
└── TurnStats
```

### データフロー

```
StatisticsDashboardPage
  ↓ statistics.opponentDeckStats
OpponentDeckPieChart
  ↓ transformToPieChartData()
Recharts PieChart
  ↓ レンダリング
円グラフ表示
```

## 優先順位（MoSCoW分析）

### Must Have（必須 - TASK-0019）

- 対戦相手デッキ分布の円グラフ表示（REQ-GRAPH-001 ~ 005）
- デッキタイプごとの固定カラーパレット（REQ-GRAPH-005）
- ツールチップ表示（REQ-GRAPH-009, 010）
- レスポンシブ対応（REQ-GRAPH-006 ~ 008）

### Should Have（重要 - Phase 2以降）

- 時系列の勝率推移折れ線グラフ
- マイデッキ別勝率の棒グラフ

### Could Have（あれば望ましい - Phase 2以降）

- グラフのクリックによるドリルダウン機能
- グラフのアニメーション効果

### Won't Have（実装しない - Phase 1）

- ランク帯別勝率の棒グラフ（テーブル表示で十分）
- 先攻後攻別勝率の円グラフ（テーブル表示で十分）

## 変更履歴

| 日付 | 変更内容 | 変更者 |
|------|---------|-------|
| 2025-11-09 | 初版作成（TASK-0019要件定義） | Claude Code |
