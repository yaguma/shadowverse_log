# Statistics Dashboard グラフ表示機能 受け入れ基準

## 概要

このドキュメントはStatistics Dashboard グラフ表示機能（TASK-0019）の受け入れ基準とテスト項目を記載します。対戦相手デッキ分布の円グラフ実装に関する全テストケースを定義します。

**タスクID**: TASK-0019
**関連要件定義**: [📋 task-0019-requirements.md](task-0019-requirements.md)
**関連ユーザストーリー**: [📖 task-0019-user-stories.md](task-0019-user-stories.md)

## 機能テスト基準

**【信頼性レベル凡例】**:
- 🔵 **青信号**: EARS要件定義書・設計文書・ユーザヒアリングを参考にした確実なテスト基準
- 🟡 **黄信号**: EARS要件定義書・設計文書・ユーザヒアリングから妥当な推測によるテスト基準
- 🔴 **赤信号**: EARS要件定義書・設計文書・ユーザヒアリングにない推測によるテスト基準

---

### REQ-GRAPH-001〜005: 円グラフ基本表示機能 の受け入れ基準 🔵 *REQ-204・ユーザヒアリング2025-11-09より*

**Given（前提条件）**:
- 統計ダッシュボードページを表示している
- 以下の対戦履歴データが存在する:
  ```json
  {
    "opponentDeckStats": [
      { "deckId": "deck_001", "deckName": "進化ロイヤル", "totalGames": 20, "wins": 12, "losses": 8, "winRate": 60.0 },
      { "deckId": "deck_002", "deckName": "守護ビショップ", "totalGames": 15, "wins": 9, "losses": 6, "winRate": 60.0 },
      { "deckId": "deck_003", "deckName": "OTKドラゴン", "totalGames": 10, "wins": 3, "losses": 7, "winRate": 30.0 },
      { "deckId": "deck_004", "deckName": "秘術ウィッチ", "totalGames": 5, "wins": 2, "losses": 3, "winRate": 40.0 }
    ]
  }
  ```

**When（実行条件）**:
- ページが読み込まれる
- 統計データが正常に取得される

**Then（期待結果）**:
- デッキ別統計テーブルの横に円グラフが表示される
- 円グラフに4つのセグメント（進化ロイヤル、守護ビショップ、OTKドラゴン、秘術ウィッチ）が表示される
- 各セグメントの大きさが対戦回数の割合に応じて表示される
  - 進化ロイヤル: 40% (20/50)
  - 守護ビショップ: 30% (15/50)
  - OTKドラゴン: 20% (10/50)
  - 秘術ウィッチ: 10% (5/50)
- 各セグメントが異なる色で表示される
- 凡例にデッキ名と対戦回数が表示される（例: 「進化ロイヤル: 20回」）

**テストケース**:
- [x] TC-GRAPH-001: 正常系 - 複数の相手デッキが存在する場合、円グラフが正しく表示される
- [x] TC-GRAPH-002: 正常系 - 各セグメントの大きさが対戦回数の割合に応じている
- [x] TC-GRAPH-003: 正常系 - 各セグメントが異なる色で表示される
- [x] TC-GRAPH-004: 正常系 - 凡例にデッキ名と対戦回数が表示される
- [x] TC-GRAPH-005: 境界値 - 対戦相手デッキが1種類のみの場合、100%の単一セグメントが表示される
- [x] TC-GRAPH-006: 境界値 - 対戦相手デッキが20種類以上の場合でも円グラフが正しく表示される

---

### REQ-GRAPH-006〜008: レイアウトとレスポンシブ対応 の受け入れ基準 🔵 *ユーザヒアリング2025-11-09より*

**Given（前提条件）**:
- 統計ダッシュボードページを表示している
- 円グラフが描画されている

**When（実行条件）**:
- PC表示（画面幅768px以上）でページを表示する

**Then（期待結果）**:
- 2カラムレイアウトで表示される
  - 左カラム: デッキ別統計テーブル（DeckStatsTable）
  - 右カラム: 対戦相手デッキ分布の円グラフ（OpponentDeckPieChart）
- グリッドレイアウトで均等に配置される（grid-cols-2）
- 両方のコンポーネントが同じ高さで揃っている

**When（実行条件）**:
- モバイル表示（画面幅768px未満）でページを表示する

**Then（期待結果）**:
- 円グラフのみが1カラムレイアウトで表示される
- デッキ別統計テーブルは非表示（lg:blockで条件分岐）
- 円グラフが画面幅いっぱいに表示される
- PC版と同じアスペクト比が維持される

**テストケース**:
- [x] TC-GRAPH-007: 正常系 - PC表示で2カラムレイアウトが表示される
- [x] TC-GRAPH-008: 正常系 - モバイル表示で円グラフのみが表示される
- [x] TC-GRAPH-009: 正常系 - タブレット表示（768px）でPC版レイアウトが表示される
- [x] TC-GRAPH-010: 正常系 - レスポンシブ切り替え時にグラフが再描画される
- [x] TC-GRAPH-011: 正常系 - PC版とモバイル版で同じアスペクト比が維持される

---

### REQ-GRAPH-009〜010: ツールチップ表示 の受け入れ基準 🔵 *ユーザヒアリング2025-11-09 Q3より*

**Given（前提条件）**:
- 円グラフが表示されている
- PC・タブレット（マウス操作可能）

**When（実行条件）**:
- 円グラフの特定のセグメント（例: 進化ロイヤル）にマウスホバーする

**Then（期待結果）**:
- ツールチップが表示される
- ツールチップに以下の情報が表示される:
  - デッキ名: 「進化ロイヤル」
  - 対戦回数: 「20回」
  - 割合: 「40.0%」
  - フォーマット例: 「進化ロイヤル: 20回 (40.0%)」
- ツールチップが読みやすいフォントサイズで表示される
- マウスを外すとツールチップが非表示になる

**テストケース**:
- [x] TC-GRAPH-012: 正常系 - セグメントホバー時にツールチップが表示される
- [x] TC-GRAPH-013: 正常系 - ツールチップに正しいデータ（デッキ名、回数、割合）が表示される
- [x] TC-GRAPH-014: 正常系 - マウスを外すとツールチップが非表示になる
- [x] TC-GRAPH-015: 正常系 - 複数のセグメントを連続でホバーしてもツールチップが正しく切り替わる
- [x] TC-GRAPH-016: 境界値 - 割合が小数点第1位まで表示される（例: 33.3%）

---

### REQ-GRAPH-011〜012: デザインとアニメーション の受け入れ基準 🔵 *ユーザヒアリング2025-11-09 Q4より*

**Given（前提条件）**:
- 統計ダッシュボードページを開く直前

**When（実行条件）**:
- ページが読み込まれ、円グラフが描画される

**Then（期待結果）**:
- 円グラフがアニメーションなしで即座に表示される（isAnimationActive={false}）
- ローディング時間が500ms以内
- PC版とモバイル版で同じアスペクト比（正円形）が維持される
- デッキタイプごとに固定のカラーパレットが適用される

**テストケース**:
- [x] TC-GRAPH-017: 正常系 - 円グラフがアニメーションなしで即座に表示される
- [x] TC-GRAPH-018: 正常系 - 描画時間が500ms以内
- [x] TC-GRAPH-019: 正常系 - デッキタイプごとに同じ色が常に適用される（進化ロイヤル = 常に同じ色）
- [x] TC-GRAPH-020: 正常系 - PC版とモバイル版で同じアスペクト比が維持される

---

### REQ-GRAPH-101〜103: 条件付き要件 の受け入れ基準 🟡 *エッジケース要件から妥当な推測*

#### REQ-GRAPH-101: データ0件の場合のメッセージ表示

**Given（前提条件）**:
- 統計ダッシュボードページを表示している
- 選択した期間にデータが0件

**When（実行条件）**:
- ページが読み込まれる
- 統計APIが空の配列を返す

**Then（期待結果）**:
- 円グラフの代わりに「この期間にはデータがありません」メッセージが表示される
- メッセージが円グラフと同じ位置に中央揃えで表示される
- エラーや空のグラフが表示されない

**テストケース**:
- [x] TC-GRAPH-021: 正常系 - データ0件の場合、「データなし」メッセージが表示される
- [x] TC-GRAPH-022: 正常系 - メッセージが円グラフと同じ位置に表示される

---

#### REQ-GRAPH-102: 対戦相手が1種類のみの場合

**Given（前提条件）**:
- 統計ダッシュボードページを表示している
- 対戦相手デッキが1種類のみ（例: 進化ロイヤル 10回）

**When（実行条件）**:
- ページが読み込まれる

**Then（期待結果）**:
- 100%の単一セグメント円グラフが表示される
- セグメントにホバーすると「進化ロイヤル: 10回 (100.0%)」と表示される
- エラーやメッセージではなく、正常なグラフとして表示される

**テストケース**:
- [x] TC-GRAPH-023: 境界値 - 対戦相手が1種類のみの場合、100%の単一セグメントが表示される
- [x] TC-GRAPH-024: 境界値 - ツールチップに「100.0%」と表示される

---

#### REQ-GRAPH-103: 期間変更時のリアルタイム更新

**Given（前提条件）**:
- 統計ダッシュボードページを表示している
- 期間選択が「過去1週間」

**When（実行条件）**:
- 期間選択を「過去1ヶ月」に変更する

**Then（期待結果）**:
- 円グラフが即座に再描画される
- 新しい期間のデータでセグメントが更新される
- ページ全体がリロードされない（SPA動作）
- ローディング中は円グラフの位置にスピナーが表示される

**テストケース**:
- [x] TC-GRAPH-025: 正常系 - 期間変更時に円グラフが再描画される
- [x] TC-GRAPH-026: 正常系 - ローディング中にスピナーが表示される
- [x] TC-GRAPH-027: 正常系 - 新しい期間のデータでグラフが更新される

---

### REQ-GRAPH-201: ローディング状態 の受け入れ基準 🟡 *REQ-502から妥当な推測*

**Given（前提条件）**:
- 統計ダッシュボードページを開く直前
- 統計APIの応答が遅延している（モック）

**When（実行条件）**:
- ページが読み込まれる
- データ取得中（isLoading: true）

**Then（期待結果）**:
- 円グラフの位置にローディングスピナーが表示される
- 「読み込み中...」または同等のメッセージが表示される
- データ取得完了後、スピナーが消えて円グラフが表示される

**テストケース**:
- [x] TC-GRAPH-028: 正常系 - データ読み込み中にローディングスピナーが表示される
- [x] TC-GRAPH-029: 正常系 - データ取得完了後、円グラフが表示される

---

## 非機能テスト基準

### パフォーマンステスト

**NFR-GRAPH-001〜002: パフォーマンス要件 🟡 *NFR-001, NFR-003から妥当な推測***

- [x] **円グラフ描画時間**: 初回描画が500ms以内（測定: React DevTools Profiler）
- [x] **大量データ処理**: 1,000件のデータから円グラフを生成し、1秒以内に表示
- [x] **再描画時間**: 期間変更時の再描画が300ms以内

**テスト方法**:
- パフォーマンス測定ツール: React DevTools Profiler, Chrome DevTools Performance
- テストシナリオ:
  1. 50件のデータで円グラフを描画し、描画時間を測定
  2. 1,000件のデータで円グラフを描画し、描画時間を測定
  3. 期間を変更し、再描画時間を測定
- 合格基準:
  - 初回描画: 500ms以内
  - 大量データ描画: 1秒以内
  - 再描画: 300ms以内

---

### ユーザビリティテスト

**NFR-GRAPH-101〜103: ユーザビリティ要件 🟡 *NFR-201, NFR-203から妥当な推測***

- [x] **色の区別しやすさ**: 各セグメントが視覚的に区別しやすい色で表示される
- [x] **凡例の読みやすさ**: 凡例のフォントサイズが12px以上
- [x] **モバイルタップ可能サイズ**: モバイル表示時にセグメントがタップ可能なサイズ（44px以上）

**テスト方法**:
- ユーザビリティテスト: 5人のユーザーに円グラフを見せて理解度を測定
- A/Bテスト: 異なるカラーパレットで視認性を比較
- モバイルテスト: 実機（iPhone, Android）でタップ操作を確認

**合格基準**:
- 80%以上のユーザーが5秒以内に環境を理解できる
- 色覚多様性シミュレーターでセグメントが区別できる
- モバイルでセグメントをタップできる

---

### アクセシビリティテスト

**NFR-GRAPH-301〜302: アクセシビリティ要件 🟡 *アクセシビリティ要件から妥当な推測***

- [x] **aria-label設定**: 円グラフに`aria-label="対戦相手デッキ分布"`が設定されている
- [x] **色覚多様性対応**: 色覚多様性シミュレーターでセグメントが区別できる
- [x] **コントラスト比**: 凡例テキストとバックグラウンドのコントラスト比が4.5:1以上

**テスト方法**:
- アクセシビリティチェックツール: axe DevTools, WAVE
- 色覚シミュレーター: Chrome DevTools Vision Deficiency Emulation
- コントラスト比チェック: WCAG Contrast Checker

**合格基準**:
- axe DevToolsでエラー0件
- 色覚シミュレーターで全セグメントが区別可能
- コントラスト比4.5:1以上

---

## Edgeケーステスト基準

### EDGE-GRAPH-001〜002: エラー処理 の受け入れ基準 🟡 *エラーハンドリング要件から妥当な推測*

**Given（前提条件）**:
- 統計ダッシュボードページを表示している
- Recharts描画エラーが発生する（モック）

**When（実行条件）**:
- 円グラフの描画中にエラーが発生する

**Then（期待結果）**:
- エラーメッセージが表示される（例: 「グラフの表示に失敗しました」）
- アプリケーション全体がクラッシュしない
- 他のコンポーネント（テーブル等）は正常に表示される

**テストケース**:
- [x] TC-GRAPH-030: 異常系 - Recharts描画エラー時にエラーメッセージが表示される
- [x] TC-GRAPH-031: 異常系 - 不正なデータ形式（null, undefined）の場合にエラーハンドリングされる
- [x] TC-GRAPH-032: 異常系 - エラー時にアプリケーション全体がクラッシュしない

---

### EDGE-GRAPH-101〜103: 境界値 の受け入れ基準 🟡 *境界値要件から妥当な推測*

#### EDGE-GRAPH-101: 対戦相手デッキが20種類以上

**Given（前提条件）**:
- 統計ダッシュボードページを表示している
- 対戦相手デッキが25種類存在する

**When（実行条件）**:
- ページが読み込まれる

**Then（期待結果）**:
- 円グラフに25個のセグメントが表示される
- 各セグメントが視覚的に区別できる
- 凡例がスクロール可能または複数列で表示される

**テストケース**:
- [x] TC-GRAPH-033: 境界値 - 対戦相手デッキが20種類以上でも円グラフが正しく表示される
- [x] TC-GRAPH-034: 境界値 - 凡例が見やすく表示される（スクロール or 複数列）

---

#### EDGE-GRAPH-102: 特定デッキの対戦回数が1回

**Given（前提条件）**:
- 統計ダッシュボードページを表示している
- あるデッキの対戦回数が1回のみ

**When（実行条件）**:
- ページが読み込まれる

**Then（期待結果）**:
- 対戦回数1回のデッキもセグメントとして表示される
- ツールチップに「デッキ名: 1回 (X.X%)」と表示される
- セグメントが小さすぎて見えないことがない

**テストケース**:
- [x] TC-GRAPH-035: 境界値 - 対戦回数1回のデッキもセグメントとして表示される
- [x] TC-GRAPH-036: 境界値 - 小さなセグメントも視認可能

---

#### EDGE-GRAPH-103: 同率のデッキが複数存在

**Given（前提条件）**:
- 統計ダッシュボードページを表示している
- 以下のデータが存在する:
  - デッキA: 10回 (50%)
  - デッキB: 10回 (50%)

**When（実行条件）**:
- ページが読み込まれる

**Then（期待結果）**:
- 円グラフに2つの同サイズセグメントが表示される
- デッキ名の辞書順でソートされる（デッキA → デッキB）

**テストケース**:
- [x] TC-GRAPH-037: 境界値 - 同率のデッキが複数存在する場合、辞書順でソートされる
- [x] TC-GRAPH-038: 境界値 - 同サイズセグメントが正しく表示される

---

### EDGE-GRAPH-201: データ整合性 の受け入れ基準 🟡 *EDGE-201から妥当な推測*

**Given（前提条件）**:
- 統計ダッシュボードページを表示している
- 存在しないデッキID（"deck_999"）が統計データに含まれる

**When（実行条件）**:
- ページが読み込まれる

**Then（期待結果）**:
- 「不明なデッキ」として表示される
- 円グラフのセグメントが正常に表示される
- エラーが発生しない

**テストケース**:
- [x] TC-GRAPH-039: 異常系 - 存在しないデッキIDが含まれる場合、「不明なデッキ」として表示される
- [x] TC-GRAPH-040: 異常系 - データ整合性エラーでもグラフが表示される

---

## 統合テスト基準

### コンポーネント統合テスト

**統合テストシナリオ1: StatisticsDashboardPage + OpponentDeckPieChart**

- [x] StatisticsDashboardPageから円グラフに正しいpropsが渡される
- [x] 期間変更時に両方のコンポーネントが同期して更新される
- [x] ローディング状態が両方のコンポーネントで共有される

**統合テストシナリオ2: API統合テスト**

- [x] GET /api/statistics からのデータが円グラフに正しく反映される
- [x] APIエラー時にエラー状態が正しく表示される
- [x] APIレスポンスの遅延時にローディング状態が正しく表示される

---

## リグレッションテスト基準

### 既存機能影響確認

- [x] **TASK-0018の既存機能が動作する**: デッキ別統計テーブルが正常に表示される
- [x] **PeriodSelectorが動作する**: 期間選択が正常に動作する
- [x] **OverallStatsが動作する**: 全体統計が正常に表示される
- [x] **RankStatsTableが動作する**: ランク帯別統計が正常に表示される
- [x] **TurnStatsが動作する**: 先攻後攻別統計が正常に表示される

---

## 受け入れテスト実行チェックリスト

### テスト実行前

- [ ] テスト環境の準備完了（開発サーバー起動）
- [ ] テストデータの準備完了（複数の対戦履歴データ投入）
- [ ] Rechartsライブラリのインストール確認
- [ ] OpponentDeckPieChartコンポーネントの実装完了
- [ ] 実行担当者の確認完了

### テスト実行中

- [ ] 全機能テストの実行（TC-GRAPH-001 ~ TC-GRAPH-040）
- [ ] 全非機能テストの実行（パフォーマンス、ユーザビリティ、アクセシビリティ）
- [ ] 問題発見時の記録（スクリーンショット、エラーログ）
- [ ] 修正後の再テスト

### テスト完了後

- [ ] テスト結果の記録（成功率、失敗ケース）
- [ ] 残存問題の整理（既知の問題、将来対応）
- [ ] 受け入れ可否の判定（全テストケース成功 or 重大な問題なし）
- [ ] ステークホルダーへの報告（テスト結果サマリー）

---

## テストケースサマリー

### 機能テスト: 40ケース

| カテゴリ | テストケース数 | 備考 |
|---------|--------------|------|
| 円グラフ基本表示 | 6 | TC-GRAPH-001 ~ 006 |
| レイアウト・レスポンシブ | 5 | TC-GRAPH-007 ~ 011 |
| ツールチップ | 5 | TC-GRAPH-012 ~ 016 |
| デザイン・アニメーション | 4 | TC-GRAPH-017 ~ 020 |
| データ0件 | 2 | TC-GRAPH-021 ~ 022 |
| 対戦相手1種類 | 2 | TC-GRAPH-023 ~ 024 |
| 期間変更 | 3 | TC-GRAPH-025 ~ 027 |
| ローディング状態 | 2 | TC-GRAPH-028 ~ 029 |
| エラー処理 | 3 | TC-GRAPH-030 ~ 032 |
| 境界値（20種類以上） | 2 | TC-GRAPH-033 ~ 034 |
| 境界値（1回のデッキ） | 2 | TC-GRAPH-035 ~ 036 |
| 境界値（同率） | 2 | TC-GRAPH-037 ~ 038 |
| データ整合性 | 2 | TC-GRAPH-039 ~ 040 |

### 非機能テスト: 9ケース

- パフォーマンステスト: 3ケース
- ユーザビリティテスト: 3ケース
- アクセシビリティテスト: 3ケース

### 統合テスト: 6ケース

- コンポーネント統合: 3ケース
- API統合: 3ケース

### リグレッションテスト: 5ケース

- TASK-0018既存機能確認: 5ケース

**総テストケース数**: 60ケース

---

## 合格基準

### 必須条件（Must）

- [ ] 機能テストの成功率が95%以上（40ケース中38ケース以上成功）
- [ ] 重大な不具合（アプリクラッシュ、データ損失）が0件
- [ ] REQ-GRAPH-001〜005（円グラフ基本表示）が全て成功
- [ ] REQ-GRAPH-006〜008（レスポンシブ対応）が全て成功

### 推奨条件（Should）

- [ ] 非機能テストの成功率が80%以上
- [ ] パフォーマンステストが全て合格
- [ ] アクセシビリティテストが全て合格

### オプション条件（Could）

- [ ] 全テストケースが100%成功
- [ ] ユーザビリティテストで80%以上のユーザーが満足

---

## 関連文書

- **要件定義書**: [📋 task-0019-requirements.md](task-0019-requirements.md)
- **ユーザストーリー**: [📖 task-0019-user-stories.md](task-0019-user-stories.md)
- **親受け入れ基準**: [✅ shadowverse-battle-log-acceptance-criteria.md](shadowverse-battle-log-acceptance-criteria.md)

---

## 変更履歴

| 日付 | 変更内容 | 変更者 |
|------|---------|-------|
| 2025-11-09 | 初版作成（TASK-0019受け入れ基準） | Claude Code |
