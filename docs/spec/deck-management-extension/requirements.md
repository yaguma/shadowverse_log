# デッキ管理機能拡張 要件定義書

## 概要

シャドウバース対戦履歴管理アプリケーションにおいて、デッキ種別（DeckMaster）の追加・編集機能、使用デッキ（MyDeck）の追加機能、統計画面の改善、およびUI/UXの向上を実現する機能拡張。

**プロジェクトタイプ**: 機能拡張（既存システムへの追加）
**対象ユーザー**: シャドウバースプレイヤー（個人利用）
**開発方針**: 既存アーキテクチャを維持した段階的実装

## 関連文書

- **ヒアリング記録**: [interview-record.md](interview-record.md)
- **ユーザストーリー**: [user-stories.md](user-stories.md)
- **受け入れ基準**: [acceptance-criteria.md](acceptance-criteria.md)
- **既存要件定義書**: [../shadowverse-battle-log-requirements.md](../shadowverse-battle-log-requirements.md)
- **既存アーキテクチャ**: [../../design/shadowverse-battle-log/architecture-cloudflare.md](../../design/shadowverse-battle-log/architecture-cloudflare.md)

## 機能要件（EARS記法）

**【信頼性レベル凡例】**:
- 🔵 **青信号**: ユーザヒアリング・設計文書を参考にした確実な要件
- 🟡 **黄信号**: ユーザヒアリング・設計文書から妥当な推測による要件
- 🔴 **赤信号**: ユーザヒアリング・設計文書にない推測による要件

---

### 1. デッキ種別（DeckMaster）管理機能

#### 通常要件（SHALL）

##### デッキ種別追加機能

- **REQ-EXT-001**: システムはデッキ種別（DeckMaster）の新規追加機能を提供しなければならない 🔵 *ユーザヒアリング2025-01-26より*
- **REQ-EXT-002**: システムはデッキ種別追加時にclassName（クラス名）を既存のクラス一覧から選択式で入力させなければならない 🔵 *ユーザヒアリング2025-01-26より*
- **REQ-EXT-003**: システムはデッキ種別追加時にdeckName（デッキ名）を自由入力式で入力させなければならない 🔵 *ユーザヒアリング2025-01-26より*
- **REQ-EXT-004**: システムはデッキ種別追加時にsortOrderを自動採番しなければならない 🔵 *ユーザヒアリング2025-01-26より*
- **REQ-EXT-005**: システムはデッキ種別追加時にidを自動採番しなければならない 🔵 *ユーザヒアリング2025-01-26より*

##### デッキ種別編集機能

- **REQ-EXT-006**: システムは登録済みデッキ種別のdeckName（デッキ名）を編集する機能を提供しなければならない 🔵 *ユーザヒアリング2025-01-26より*
- **REQ-EXT-007**: システムは登録済みデッキ種別のclassName（クラス名）は変更不可としなければならない 🔵 *ユーザヒアリング2025-01-26より*

##### デッキ種別削除機能

- **REQ-EXT-008**: システムはデッキ種別を削除する機能を提供しなければならない 🔵 *ユーザヒアリング2025-01-26より*

---

### 2. 使用デッキ（MyDeck）追加機能

#### 通常要件（SHALL）

##### 使用デッキ追加機能

- **REQ-EXT-101**: システムは使用デッキ（MyDeck）の新規追加機能を提供しなければならない 🔵 *ユーザヒアリング2025-01-26より*
- **REQ-EXT-102**: システムは使用デッキ追加時にdeckId（デッキ種別ID）をDeckMasterのクラス名から選択式で入力させ、選択したクラス名に紐づくidを保存しなければならない 🔵 *ユーザヒアリング2025-01-26より（表示はclassName、登録データはid）*
- **REQ-EXT-103**: システムは使用デッキ追加時にdeckName（デッキ名）を自由入力式で入力させなければならない 🔵 *ユーザヒアリング2025-01-26より*
- **REQ-EXT-104**: システムは使用デッキ追加時にdeckCode（デッキコード）を自由入力式で入力させなければならない（空白可） 🔵 *ユーザヒアリング2025-01-26より*
- **REQ-EXT-105**: システムは使用デッキ追加時にisActiveをtrue固定で設定し、ユーザーには入力欄を表示しないものとする 🔵 *ユーザヒアリング2025-01-26より*
- **REQ-EXT-106**: システムは使用デッキ追加時にidを自動採番しなければならない 🔵 *ユーザヒアリング2025-01-26より*
- **REQ-EXT-107**: システムは使用デッキのdeckCodeにバリデーションを適用しないものとする 🔵 *ユーザヒアリング2025-01-26より*

##### 使用デッキ削除機能

- **REQ-EXT-108**: システムは使用デッキを削除する機能を提供しなければならない 🔵 *ユーザヒアリング2025-01-26より*

---

### 3. 統計画面機能拡張

#### 通常要件（SHALL）

##### 対戦履歴登録機能

- **REQ-EXT-201**: システムは統計画面においても対戦履歴登録機能を提供しなければならない 🔵 *ユーザヒアリング2025-01-26より*
- **REQ-EXT-202**: システムは統計画面の対戦履歴登録に、対戦履歴一覧画面と同じダイアログを使用しなければならない 🔵 *ユーザヒアリング2025-01-26より*

##### シーズン選択機能

- **REQ-EXT-203**: システムは統計画面の初期表示時に最新シーズンの全期間のデータを表示しなければならない 🔵 *ユーザヒアリング2025-01-26より*
- **REQ-EXT-204**: システムは統計画面においてシーズンを選択式で変更できる機能を提供しなければならない 🔵 *ユーザヒアリング2025-01-26より*
- **REQ-EXT-205**: システムはシーズン選択肢に上限を設けず、登録されているすべてのシーズンを表示しなければならない 🔵 *ユーザヒアリング2025-01-26より*

---

### 4. 対戦履歴登録UI改善

#### 通常要件（SHALL）

##### レイアウト改善

- **REQ-EXT-301**: システムは対戦履歴登録ダイアログにおいてシーズンと対戦日を横並びで表示しなければならない 🔵 *ユーザヒアリング2025-01-26より*

##### 相手デッキ選択改善

- **REQ-EXT-302**: システムは対戦履歴登録時の相手デッキ選択肢を、最近の対戦で使われた順にソートして表示しなければならない 🔵 *ユーザヒアリング2025-01-26より*

---

## 条件付き要件（WHEN/IF-THEN）

- **REQ-EXT-401**: デッキ種別削除時に該当デッキ種別が対戦履歴で参照されている場合、システムは削除を禁止しなければならない 🔵 *ユーザヒアリング2025-01-26より*
- **REQ-EXT-402**: 使用デッキ削除時に該当使用デッキが対戦履歴で参照されている場合、システムは削除を禁止しなければならない 🔵 *ユーザヒアリング2025-01-26より*
- **REQ-EXT-403**: デッキ種別のdeckName編集時に空文字が入力された場合、システムはバリデーションエラーを表示しなければならない 🔵 *入力検証要件として確定*

---

## 状態要件（WHERE）

- **REQ-EXT-501**: デッキ種別が0件の状態である場合、システムは「デッキ種別が登録されていません」のメッセージを表示しなければならない 🔵 *一般的なUX要件として確定*
- **REQ-EXT-502**: 使用デッキが0件の状態である場合、システムは「使用デッキが登録されていません」のメッセージを表示しなければならない 🔵 *一般的なUX要件として確定*

---

## 制約要件（MUST）

- **REQ-EXT-601**: システムは既存のDeckMasterテーブル構造を維持しなければならない 🔵 *既存データ構造より*
- **REQ-EXT-602**: システムは既存のmy_decksテーブル構造を維持しなければならない（classIdはdeckIdを通じてDeckMasterから取得） 🔵 *ユーザヒアリング2025-01-26より*
- **REQ-EXT-603**: システムは既存の対戦履歴データとの後方互換性を維持しなければならない 🔵 *既存要件より*

---

## 非機能要件

### パフォーマンス

- **NFR-EXT-001**: システムはデッキ種別一覧を1秒以内に読み込まなければならない 🔵 *既存パフォーマンス要件として確定*
- **NFR-EXT-002**: システムは相手デッキ選択肢のソート処理を200ms以内に完了しなければならない 🔵 *UX要件として確定*

### ユーザビリティ

- **NFR-EXT-102**: システムは最近使用した相手デッキを上位に表示することで入力効率を向上させなければならない 🔵 *ユーザヒアリング2025-01-26より*

---

## Edgeケース

### 境界値

- **EDGE-EXT-101**: システムは対戦履歴が0件の状態でも「最近使用したデッキ順」ソートが正常に動作しなければならない（その場合はsortOrder順で表示） 🔵 *データ整合性要件として確定*

---

## 優先順位（MoSCoW分析）

### Must Have（必須）

- デッキ種別追加機能（REQ-EXT-001 ~ REQ-EXT-005）
- デッキ種別編集機能（REQ-EXT-006 ~ REQ-EXT-007）
- 使用デッキ追加機能（REQ-EXT-101 ~ REQ-EXT-107）
- 統計画面での対戦履歴登録機能（REQ-EXT-201 ~ REQ-EXT-202）
- シーズン選択機能（REQ-EXT-203 ~ REQ-EXT-205）
- レイアウト改善（REQ-EXT-301）
- 相手デッキ選択改善（REQ-EXT-302）

### Should Have（重要）

- デッキ種別削除機能（REQ-EXT-008）
- 使用デッキ削除機能（REQ-EXT-108）
- 参照時削除禁止（REQ-EXT-401 ~ REQ-EXT-402）

### Won't Have（今回は対象外）

- 使用デッキの編集機能（deckName、deckCodeの変更）
- デッキ種別のsortOrder手動変更機能

---

## データモデル

### DeckMaster（デッキ種別）テーブル構造

```typescript
interface DeckMaster {
  id: string;           // 自動採番
  className: string;    // クラス名（選択式：エルフ、ロイヤル、ウィッチ、ドラゴン等）
  deckName: string;     // デッキ名（自由入力）
  sortOrder: number;    // 自動採番
  createdAt?: string;
  updatedAt?: string;
}
```

### MyDeck（使用デッキ）テーブル構造（既存のまま）

```typescript
interface MyDeck {
  id: string;           // 自動採番
  deckId: string;       // DeckMasterのid（選択時はclassNameで表示）
  deckCode: string;     // デッキコード（自由入力、空白可）
  deckName: string;     // デッキ名（自由入力）
  isActive: boolean;    // true固定
  userId?: string;
  createdAt: string;
  updatedAt?: string;
}
```

---

## 用語集

| 用語 | 定義 |
|------|------|
| デッキ種別（DeckMaster） | 対戦相手のデッキタイプを管理するマスターデータ |
| 使用デッキ（MyDeck） | ユーザーが使用するデッキの登録情報 |
| クラス名（className） | シャドウバースのクラス（エルフ、ロイヤル、ウィッチ等） |
| デッキコード（deckCode） | シャドウバース公式のデッキ共有コード |
| シーズン | シャドウバースの対戦シーズン（番号で管理） |

---

## 更新履歴

- **2025-01-26**: 初版作成（tsumiki:kairo-requirements により生成）
  - デッキ種別管理機能の追加要件
  - 使用デッキ追加機能の要件
  - 統計画面機能拡張の要件
  - 対戦履歴登録UI改善の要件
