# デッキ管理機能拡張 受け入れ基準

**作成日**: 2025-01-26
**関連要件定義**: [requirements.md](requirements.md)
**ユーザストーリー**: [user-stories.md](user-stories.md)

**【信頼性レベル凡例】**:
- 🔵 **青信号**: ユーザヒアリング・設計文書を参考にした確実な基準
- 🟡 **黄信号**: ユーザヒアリング・設計文書から妥当な推測による基準
- 🔴 **赤信号**: ユーザヒアリング・設計文書にない推測による基準

---

## エピック1: デッキ種別管理

### AC-1.1: デッキ種別追加機能 🔵

**関連ストーリー**: ストーリー 1.1
**関連要件**: REQ-EXT-001 ~ REQ-EXT-005

#### Given-When-Then

```gherkin
Scenario: デッキ種別を新規追加できる
  Given デッキ種別管理画面を開いている
  When 「追加」ボタンをクリックする
  And クラス名「ウィッチ」を選択する
  And デッキ名「スペルウィッチ」を入力する
  And 「登録」ボタンをクリックする
  Then デッキ種別一覧に「スペルウィッチ」が表示される
  And idが自動採番されている
  And sortOrderが自動採番されている

Scenario: クラス名は選択式で入力できる
  Given デッキ種別追加ダイアログを開いている
  When クラス名のドロップダウンを開く
  Then 既存のすべてのクラス名が選択肢として表示される

Scenario: デッキ名が空の場合は登録できない
  Given デッキ種別追加ダイアログを開いている
  And クラス名「エルフ」を選択している
  When デッキ名を空のまま「登録」ボタンをクリックする
  Then バリデーションエラーが表示される
  And デッキ種別は登録されない
```

#### チェックリスト

- [ ] デッキ種別管理画面に「追加」ボタンが存在する
- [ ] クラス名はドロップダウンで選択できる
- [ ] クラス名の選択肢に既存のすべてのクラスが含まれる
- [ ] デッキ名は自由入力できる
- [ ] デッキ名が空の場合はバリデーションエラーが表示される
- [ ] 登録時にidが自動採番される
- [ ] 登録時にsortOrderが自動採番される
- [ ] 登録後、一覧に新しいデッキ種別が表示される

---

### AC-1.2: デッキ種別編集機能 🔵

**関連ストーリー**: ストーリー 1.2
**関連要件**: REQ-EXT-006, REQ-EXT-007

#### Given-When-Then

```gherkin
Scenario: デッキ名を編集できる
  Given デッキ種別「スペルイッチ」が登録されている
  And デッキ種別管理画面を開いている
  When 「スペルイッチ」の「編集」ボタンをクリックする
  And デッキ名を「スペルウィッチ」に変更する
  And 「保存」ボタンをクリックする
  Then デッキ種別一覧に「スペルウィッチ」が表示される

Scenario: クラス名は編集できない
  Given デッキ種別編集ダイアログを開いている
  Then クラス名は編集不可（読み取り専用）である
```

#### チェックリスト

- [ ] デッキ種別一覧に「編集」ボタンが存在する
- [ ] 編集ダイアログでデッキ名を変更できる
- [ ] 編集ダイアログでクラス名は変更できない（読み取り専用表示）
- [ ] 編集後、一覧に更新後のデッキ名が表示される
- [ ] 編集後もidとsortOrderは変更されない

---

### AC-1.3: デッキ種別削除機能 🔵

**関連ストーリー**: ストーリー 1.3
**関連要件**: REQ-EXT-008, REQ-EXT-401

#### Given-When-Then

```gherkin
Scenario: デッキ種別を削除できる
  Given デッキ種別「旧環境デッキ」が登録されている
  And 「旧環境デッキ」は対戦履歴で参照されていない
  And デッキ種別管理画面を開いている
  When 「旧環境デッキ」の「削除」ボタンをクリックする
  And 確認ダイアログで「削除する」をクリックする
  Then デッキ種別一覧から「旧環境デッキ」が削除される

Scenario: 対戦履歴で参照されているデッキ種別は削除できない
  Given デッキ種別「アグロエルフ」が対戦履歴で参照されている
  And デッキ種別管理画面を開いている
  Then 「アグロエルフ」の「削除」ボタンは無効化されている
  Or 「削除」ボタンをクリックするとエラーメッセージが表示される
```

#### チェックリスト

- [ ] デッキ種別一覧に「削除」ボタンが存在する
- [ ] 削除前に確認ダイアログが表示される
- [ ] 対戦履歴で参照されている場合は削除できない（ボタン無効化またはエラー表示）
- [ ] 参照されていないデッキ種別は確認後に削除される
- [ ] 削除後、一覧から該当デッキ種別が消える

---

## エピック2: 使用デッキ管理

### AC-2.1: 使用デッキ追加機能 🔵

**関連ストーリー**: ストーリー 2.1
**関連要件**: REQ-EXT-101 ~ REQ-EXT-107

#### Given-When-Then

```gherkin
Scenario: 使用デッキを新規追加できる
  Given 使用デッキ管理画面を開いている
  When 「追加」ボタンをクリックする
  And クラス名「エルフ」を選択する
  And デッキ名「アグロエルフ」を入力する
  And デッキコードを入力する（任意）
  And 「登録」ボタンをクリックする
  Then 使用デッキ一覧に「アグロエルフ」が表示される
  And idが自動採番されている
  And isActiveがtrueに設定されている

Scenario: デッキコードは空でも登録できる
  Given 使用デッキ追加ダイアログを開いている
  And クラス名「ロイヤル」を選択している
  And デッキ名「コントロールロイヤル」を入力している
  When デッキコードを空のまま「登録」ボタンをクリックする
  Then 使用デッキが正常に登録される

Scenario: クラス名選択時にDeckMasterのidが保存される
  Given 使用デッキ追加ダイアログを開いている
  When クラス名「ドラゴン」を選択する
  Then 内部的にDeckMasterのidがdeckIdとして保存される
  And UIにはクラス名「ドラゴン」が表示される
```

#### チェックリスト

- [ ] 使用デッキ管理画面に「追加」ボタンが存在する
- [ ] クラス名はドロップダウンで選択できる（表示はclassName）
- [ ] 選択したクラス名に紐づくDeckMasterのidがdeckIdとして保存される
- [ ] デッキ名は自由入力できる
- [ ] デッキコードは自由入力できる（空白可）
- [ ] デッキコードにバリデーションはない
- [ ] isActiveは自動的にtrueに設定される（入力欄なし）
- [ ] 登録時にidが自動採番される
- [ ] 登録後、一覧に新しい使用デッキが表示される

---

### AC-2.2: 使用デッキ削除機能 🔵

**関連ストーリー**: ストーリー 2.2
**関連要件**: REQ-EXT-108, REQ-EXT-402

#### Given-When-Then

```gherkin
Scenario: 使用デッキを削除できる
  Given 使用デッキ「古いデッキ」が登録されている
  And 「古いデッキ」は対戦履歴で参照されていない
  And 使用デッキ管理画面を開いている
  When 「古いデッキ」の「削除」ボタンをクリックする
  And 確認ダイアログで「削除する」をクリックする
  Then 使用デッキ一覧から「古いデッキ」が削除される

Scenario: 対戦履歴で参照されている使用デッキは削除できない
  Given 使用デッキ「メインデッキ」が対戦履歴で参照されている
  And 使用デッキ管理画面を開いている
  Then 「メインデッキ」の「削除」ボタンは無効化されている
  Or 「削除」ボタンをクリックするとエラーメッセージが表示される
```

#### チェックリスト

- [ ] 使用デッキ一覧に「削除」ボタンが存在する
- [ ] 削除前に確認ダイアログが表示される
- [ ] 対戦履歴で参照されている場合は削除できない（ボタン無効化またはエラー表示）
- [ ] 参照されていない使用デッキは確認後に削除される
- [ ] 削除後、一覧から該当使用デッキが消える

---

## エピック3: 統計画面機能拡張

### AC-3.1: 統計画面からの対戦履歴登録 🔵

**関連ストーリー**: ストーリー 3.1
**関連要件**: REQ-EXT-201, REQ-EXT-202

#### Given-When-Then

```gherkin
Scenario: 統計画面から対戦履歴を登録できる
  Given 統計画面を開いている
  When 「対戦を記録」ボタンをクリックする
  Then 対戦履歴登録ダイアログが表示される
  And ダイアログは一覧画面と同じ形式である

Scenario: 登録後に統計データが更新される
  Given 統計画面で対戦履歴登録ダイアログを開いている
  When 対戦情報を入力して「登録」ボタンをクリックする
  Then ダイアログが閉じる
  And 統計データが更新されて表示される
```

#### チェックリスト

- [ ] 統計画面に「対戦を記録」ボタンが存在する
- [ ] ボタンクリックで対戦履歴登録ダイアログが開く
- [ ] ダイアログは一覧画面と同じコンポーネントを使用している
- [ ] 登録後、統計データが自動的に更新される

---

### AC-3.2: 最新シーズン初期表示 🔵

**関連ストーリー**: ストーリー 3.2
**関連要件**: REQ-EXT-203

#### Given-When-Then

```gherkin
Scenario: 統計画面の初期表示は最新シーズン
  Given 対戦履歴にシーズン25、26、27のデータが登録されている
  When 統計画面を開く
  Then シーズン27（最新）が選択されている
  And シーズン27の全期間の統計が表示される
```

#### チェックリスト

- [ ] 統計画面を開くと自動的に最新シーズンが選択される
- [ ] 最新シーズンの全期間のデータが表示される
- [ ] 対戦履歴が0件の場合も正常に表示される

---

### AC-3.3: シーズン選択切り替え 🔵

**関連ストーリー**: ストーリー 3.3
**関連要件**: REQ-EXT-204, REQ-EXT-205

#### Given-When-Then

```gherkin
Scenario: シーズンを切り替えできる
  Given 統計画面で最新シーズン27が表示されている
  When シーズン選択ドロップダウンを開く
  And シーズン25を選択する
  Then シーズン25の統計データが表示される

Scenario: すべての登録シーズンが選択可能
  Given 対戦履歴にシーズン1～30のデータが登録されている
  When シーズン選択ドロップダウンを開く
  Then すべてのシーズン（1～30）が選択肢に表示される
```

#### チェックリスト

- [ ] シーズン選択ドロップダウンが存在する
- [ ] 登録されているすべてのシーズンが選択肢に表示される
- [ ] シーズン選択肢に上限はない
- [ ] シーズン選択後、該当シーズンの統計が表示される

---

## エピック4: 対戦履歴登録UI改善

### AC-4.1: シーズン・日付横並びレイアウト 🔵

**関連ストーリー**: ストーリー 4.1
**関連要件**: REQ-EXT-301

#### Given-When-Then

```gherkin
Scenario: シーズンと対戦日が横並びで表示される
  Given 対戦履歴登録ダイアログを開いている
  Then シーズン選択と対戦日入力が横並びで表示される
```

#### チェックリスト

- [ ] シーズン選択フィールドと対戦日入力フィールドが横並びで配置されている
- [ ] デスクトップ表示で横並びレイアウトが適用される
- [ ] モバイル表示ではレスポンシブに対応している

---

### AC-4.2: 相手デッキ選択肢ソート 🔵

**関連ストーリー**: ストーリー 4.2
**関連要件**: REQ-EXT-302

#### Given-When-Then

```gherkin
Scenario: 相手デッキが最近の対戦順でソートされる
  Given 最近の対戦相手が「アグロエルフ」「コントロールウィッチ」「ランプドラゴン」の順
  When 対戦履歴登録ダイアログで相手デッキの選択肢を開く
  Then 「アグロエルフ」が最上位に表示される
  And 「コントロールウィッチ」が2番目に表示される
  And 「ランプドラゴン」が3番目に表示される

Scenario: 対戦履歴がない場合はsortOrder順で表示される
  Given 対戦履歴が0件である
  When 対戦履歴登録ダイアログで相手デッキの選択肢を開く
  Then デッキ種別がsortOrder順で表示される
```

#### チェックリスト

- [ ] 相手デッキ選択肢が最近の対戦順でソートされている
- [ ] 最も最近対戦したデッキが最上位に表示される
- [ ] 対戦履歴が0件の場合はsortOrder順で表示される
- [ ] ソート処理が200ms以内に完了する

---

## 状態要件

### AC-S1: デッキ種別0件状態 🔵

**関連要件**: REQ-EXT-501

#### Given-When-Then

```gherkin
Scenario: デッキ種別が0件の場合のメッセージ表示
  Given デッキ種別が1件も登録されていない
  When デッキ種別管理画面を開く
  Then 「デッキ種別が登録されていません」のメッセージが表示される
```

---

### AC-S2: 使用デッキ0件状態 🔵

**関連要件**: REQ-EXT-502

#### Given-When-Then

```gherkin
Scenario: 使用デッキが0件の場合のメッセージ表示
  Given 使用デッキが1件も登録されていない
  When 使用デッキ管理画面を開く
  Then 「使用デッキが登録されていません」のメッセージが表示される
```

---

## 非機能要件

### AC-NF1: パフォーマンス 🔵

**関連要件**: NFR-EXT-001, NFR-EXT-002

#### チェックリスト

- [ ] デッキ種別一覧が1秒以内に読み込まれる
- [ ] 相手デッキ選択肢のソート処理が200ms以内に完了する

---

### AC-NF2: 後方互換性 🔵

**関連要件**: REQ-EXT-601, REQ-EXT-602, REQ-EXT-603

#### チェックリスト

- [ ] 既存のDeckMasterテーブル構造が維持されている
- [ ] 既存のmy_decksテーブル構造が維持されている
- [ ] 既存の対戦履歴データが正常に表示される
- [ ] 新機能追加後も既存データとの互換性が保たれている

---

## テストケースサマリー

### 単体テスト項目

| カテゴリ | テスト項目数 | 優先度 |
|---------|-------------|--------|
| デッキ種別追加 | 8 | Must |
| デッキ種別編集 | 5 | Must |
| デッキ種別削除 | 6 | Should |
| 使用デッキ追加 | 9 | Must |
| 使用デッキ削除 | 6 | Should |
| 統計画面対戦記録 | 4 | Must |
| シーズン初期表示 | 3 | Must |
| シーズン選択 | 4 | Must |
| レイアウト改善 | 3 | Must |
| 相手デッキソート | 4 | Must |
| **合計** | **52** | - |

### E2Eテストシナリオ

1. **新環境対応フロー**: デッキ種別追加 → 使用デッキ追加 → 対戦履歴記録 → 統計確認
2. **統計確認・記録フロー**: 統計画面表示 → シーズン確認 → 対戦記録 → 統計更新
3. **削除フロー**: 対戦履歴参照ありデッキの削除 → 警告確認 → 削除実行 → データ整合性確認

---

## 信頼性レベルサマリー

- 🔵 青信号: 13件 (100%)
- 🟡 黄信号: 0件 (0%)
- 🔴 赤信号: 0件 (0%)

**品質評価**: 最高品質（すべての基準がユーザヒアリングに基づく）

---

## 更新履歴

- **2025-01-26**: 初版作成（tsumiki:kairo-requirements により生成）
