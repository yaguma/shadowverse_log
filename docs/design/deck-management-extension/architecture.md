# ãƒ‡ãƒƒã‚­ç®¡ç†æ©Ÿèƒ½æ‹¡å¼µ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ

**ä½œæˆæ—¥**: 2025-01-26
**é–¢é€£è¦ä»¶å®šç¾©**: [requirements.md](../../spec/deck-management-extension/requirements.md)
**ãƒ™ãƒ¼ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£**: [shadowverse-battle-log/architecture-cloudflare.md](../shadowverse-battle-log/architecture-cloudflare.md)

**ã€ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«å‡¡ä¾‹ã€‘**:
- ğŸ”µ **é’ä¿¡å·**: ãƒ¦ãƒ¼ã‚¶ãƒ’ã‚¢ãƒªãƒ³ã‚°ãƒ»è¨­è¨ˆæ–‡æ›¸ã‚’å‚è€ƒã«ã—ãŸç¢ºå®Ÿãªè¨­è¨ˆ
- ğŸŸ¡ **é»„ä¿¡å·**: ãƒ¦ãƒ¼ã‚¶ãƒ’ã‚¢ãƒªãƒ³ã‚°ãƒ»è¨­è¨ˆæ–‡æ›¸ã‹ã‚‰å¦¥å½“ãªæ¨æ¸¬ã«ã‚ˆã‚‹è¨­è¨ˆ
- ğŸ”´ **èµ¤ä¿¡å·**: ãƒ¦ãƒ¼ã‚¶ãƒ’ã‚¢ãƒªãƒ³ã‚°ãƒ»è¨­è¨ˆæ–‡æ›¸ã«ãªã„æ¨æ¸¬ã«ã‚ˆã‚‹è¨­è¨ˆ

---

## 1. ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦ ğŸ”µ

æœ¬æ©Ÿèƒ½æ‹¡å¼µã¯ã€æ—¢å­˜ã®ã‚·ãƒ£ãƒ‰ã‚¦ãƒãƒ¼ã‚¹å¯¾æˆ¦å±¥æ­´ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’ç¶­æŒã—ã¤ã¤ã€ãƒ‡ãƒƒã‚­ç®¡ç†æ©Ÿèƒ½ã‚’è¿½åŠ ã™ã‚‹ã‚‚ã®ã§ã‚ã‚‹ã€‚

### 1.1 ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆå›³ ğŸ”µ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Cloudflare Pages (Frontend)                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    React 19 + Vite 6                     â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚ å¯¾æˆ¦å±¥æ­´ä¸€è¦§  â”‚ â”‚  çµ±è¨ˆç”»é¢     â”‚ â”‚ ãƒ‡ãƒƒã‚­ç®¡ç†    â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  BattleLog   â”‚ â”‚  Statistics   â”‚ â”‚ DeckManage   â”‚  â”‚   â”‚
â”‚  â”‚  â”‚   Page       â”‚ â”‚    Page       â”‚ â”‚   Page  [NEW]â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚         â”‚                 â”‚                 â”‚            â”‚   â”‚
â”‚  â”‚         â–¼                 â–¼                 â–¼            â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚            Zustand Store (with persist)          â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â”‚BattleLog â”‚ â”‚Statisticsâ”‚ â”‚  Deck    â”‚        â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  Store   â”‚ â”‚  Store   â”‚ â”‚  Store   â”‚        â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ HTTPS (REST API)
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Cloudflare Workers (Backend)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                      Hono Framework                       â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚                  API Routes                        â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  /api/battle-logs    (æ—¢å­˜)                       â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  /api/deck-master    (CRUDæ‹¡å¼µ) [MODIFIED]        â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  /api/my-decks       (CRUDæ‹¡å¼µ) [MODIFIED]        â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  /api/statistics     (ã‚·ãƒ¼ã‚ºãƒ³å¯¾å¿œ) [MODIFIED]     â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  /api/import         (æ—¢å­˜)                       â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ SQL
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Cloudflare D1 (SQLite)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ battle_logs  â”‚ â”‚ deck_master  â”‚ â”‚  my_decks    â”‚            â”‚
â”‚  â”‚    (æ—¢å­˜)    â”‚ â”‚   (æ—¢å­˜)     â”‚ â”‚   (æ—¢å­˜)     â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 è¨­è¨ˆåŸå‰‡ ğŸ”µ

1. **æ—¢å­˜ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®ç¶­æŒ**: Cloudflare Workers + D1 + Pagesæ§‹æˆã‚’ç¶™ç¶š
2. **ãƒ†ãƒ¼ãƒ–ãƒ«æ§‹é€ ã®ç¶­æŒ**: æ—¢å­˜ã®deck_master, my_decksãƒ†ãƒ¼ãƒ–ãƒ«ã‚’å¤‰æ›´ã—ãªã„
3. **ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå†åˆ©ç”¨**: BattleLogDialogã‚’çµ±è¨ˆç”»é¢ã§ã‚‚å®Œå…¨å†åˆ©ç”¨
4. **æ—¢å­˜APIãƒ‘ã‚¿ãƒ¼ãƒ³è¸è¥²**: /api/deck-master, /api/my-decksã«CRUDæ“ä½œã‚’è¿½åŠ 

---

## 2. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰è¨­è¨ˆ ğŸ”µ

### 2.1 æ–°è¦ç”»é¢æ§‹æˆ ğŸ”µ

```
src/
â”œâ”€â”€ pages/
â”‚   â”œâ”€â”€ BattleLogPage.tsx          (æ—¢å­˜ - ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆæ”¹å–„)
â”‚   â”œâ”€â”€ StatisticsPage.tsx         (æ—¢å­˜ - ã‚·ãƒ¼ã‚ºãƒ³é¸æŠãƒ»ç™»éŒ²ãƒœã‚¿ãƒ³è¿½åŠ )
â”‚   â””â”€â”€ DeckManagePage.tsx         [NEW] ãƒ‡ãƒƒã‚­ç®¡ç†ç”»é¢
â”‚
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ battle-log/
â”‚   â”‚   â””â”€â”€ BattleLogDialog.tsx    (æ—¢å­˜ - ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆæ”¹å–„ãƒ»ã‚½ãƒ¼ãƒˆå¯¾å¿œ)
â”‚   â”‚
â”‚   â”œâ”€â”€ deck-master/               [NEW]
â”‚   â”‚   â”œâ”€â”€ DeckMasterList.tsx     ãƒ‡ãƒƒã‚­ç¨®åˆ¥ä¸€è¦§ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”œâ”€â”€ DeckMasterDialog.tsx   ãƒ‡ãƒƒã‚­ç¨®åˆ¥è¿½åŠ ãƒ»ç·¨é›†ãƒ€ã‚¤ã‚¢ãƒ­ã‚°
â”‚   â”‚   â””â”€â”€ DeckMasterItem.tsx     ãƒ‡ãƒƒã‚­ç¨®åˆ¥ã‚¢ã‚¤ãƒ†ãƒ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚
â”‚   â””â”€â”€ my-deck/                   [NEW]
â”‚       â”œâ”€â”€ MyDeckList.tsx         ä½¿ç”¨ãƒ‡ãƒƒã‚­ä¸€è¦§ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚       â”œâ”€â”€ MyDeckDialog.tsx       ä½¿ç”¨ãƒ‡ãƒƒã‚­è¿½åŠ ãƒ€ã‚¤ã‚¢ãƒ­ã‚°
â”‚       â””â”€â”€ MyDeckItem.tsx         ä½¿ç”¨ãƒ‡ãƒƒã‚­ã‚¢ã‚¤ãƒ†ãƒ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚
â””â”€â”€ stores/
    â”œâ”€â”€ battleLogStore.ts          (æ—¢å­˜)
    â”œâ”€â”€ statisticsStore.ts         (æ—¢å­˜ - ã‚·ãƒ¼ã‚ºãƒ³é¸æŠçŠ¶æ…‹è¿½åŠ )
    â””â”€â”€ deckStore.ts               (æ—¢å­˜ - CRUDæ“ä½œè¿½åŠ )
```

### 2.2 ç”»é¢é·ç§»è¨­è¨ˆ ğŸ”µ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ãƒ˜ãƒƒãƒ€ãƒ¼ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³                    â”‚
â”‚  [å¯¾æˆ¦å±¥æ­´] [çµ±è¨ˆ] [ãƒ‡ãƒƒã‚­ç®¡ç†]                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚           â”‚            â”‚
         â–¼           â–¼            â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚å¯¾æˆ¦å±¥æ­´ â”‚ â”‚ çµ±è¨ˆ    â”‚ â”‚   ãƒ‡ãƒƒã‚­ç®¡ç†        â”‚
    â”‚ ä¸€è¦§    â”‚ â”‚ ç”»é¢    â”‚ â”‚ [ãƒ‡ãƒƒã‚­ç¨®åˆ¥][ä½¿ç”¨ãƒ‡ãƒƒã‚­] â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚           â”‚            â”‚          â”‚
         â–¼           â–¼            â–¼          â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ç™»éŒ²     â”‚ â”‚ç™»éŒ²     â”‚ â”‚ç¨®åˆ¥è¿½åŠ  â”‚ â”‚ãƒ‡ãƒƒã‚­   â”‚
    â”‚ãƒ€ã‚¤ã‚¢ãƒ­ã‚°â”‚ â”‚ãƒ€ã‚¤ã‚¢ãƒ­ã‚°â”‚ â”‚ç·¨é›†å‰Šé™¤ â”‚ â”‚è¿½åŠ å‰Šé™¤ â”‚
    â”‚(å…±é€š)   â”‚ â”‚(å…±é€š)   â”‚ â”‚ãƒ€ã‚¤ã‚¢ãƒ­ã‚°â”‚ â”‚ãƒ€ã‚¤ã‚¢ãƒ­ã‚°â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.3 ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè¨­è¨ˆ ğŸ”µ

#### DeckManagePageï¼ˆãƒ‡ãƒƒã‚­ç®¡ç†ç”»é¢ï¼‰

```typescript
// ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆã§ãƒ‡ãƒƒã‚­ç¨®åˆ¥ç®¡ç†ã¨ä½¿ç”¨ãƒ‡ãƒƒã‚­ç®¡ç†ã‚’åˆ‡ã‚Šæ›¿ãˆ
interface DeckManagePageProps {}

const DeckManagePage: React.FC<DeckManagePageProps> = () => {
  const [activeTab, setActiveTab] = useState<'deckMaster' | 'myDeck'>('deckMaster');

  return (
    <div>
      <Tabs value={activeTab} onChange={setActiveTab}>
        <Tab value="deckMaster" label="ãƒ‡ãƒƒã‚­ç¨®åˆ¥" />
        <Tab value="myDeck" label="ä½¿ç”¨ãƒ‡ãƒƒã‚­" />
      </Tabs>
      {activeTab === 'deckMaster' ? <DeckMasterList /> : <MyDeckList />}
    </div>
  );
};
```

#### BattleLogDialogæ”¹å–„ ğŸ”µ

```typescript
// æ”¹å–„ç‚¹:
// 1. ã‚·ãƒ¼ã‚ºãƒ³ã¨å¯¾æˆ¦æ—¥ã‚’æ¨ªä¸¦ã³ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
// 2. ç›¸æ‰‹ãƒ‡ãƒƒã‚­é¸æŠè‚¢ã‚’æœ€è¿‘ä½¿ç”¨é †ã«ã‚½ãƒ¼ãƒˆ

interface BattleLogDialogProps {
  open: boolean;
  onClose: () => void;
  onSubmit: (data: BattleLogInput) => void;
  initialData?: BattleLog;
}
```

---

## 3. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰è¨­è¨ˆ ğŸ”µ

### 3.1 APIãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°æ§‹æˆ ğŸ”µ

```typescript
// backend/src/index.ts
const app = new Hono<{ Bindings: Bindings }>();

// æ—¢å­˜ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
app.route('/api/battle-logs', battleLogRoutes);
app.route('/api/statistics', statisticsRoutes);  // ã‚·ãƒ¼ã‚ºãƒ³å¯¾å¿œè¿½åŠ 
app.route('/api/import', importRoutes);

// æ‹¡å¼µã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
app.route('/api/deck-master', deckMasterRoutes);  // CRUDè¿½åŠ 
app.route('/api/my-decks', myDeckRoutes);         // CRUDè¿½åŠ 
```

### 3.2 ãƒ«ãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ ğŸ”µ

```
backend/src/
â”œâ”€â”€ routes/
â”‚   â”œâ”€â”€ battleLogRoutes.ts      (æ—¢å­˜)
â”‚   â”œâ”€â”€ statisticsRoutes.ts     (æ—¢å­˜ - ã‚·ãƒ¼ã‚ºãƒ³ãƒ•ã‚£ãƒ«ã‚¿è¿½åŠ )
â”‚   â”œâ”€â”€ importRoutes.ts         (æ—¢å­˜)
â”‚   â”œâ”€â”€ deckMasterRoutes.ts     (æ—¢å­˜ - POST/PUT/DELETEè¿½åŠ )
â”‚   â””â”€â”€ myDeckRoutes.ts         (æ—¢å­˜ - POST/DELETEè¿½åŠ )
â”‚
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ battleLogService.ts     (æ—¢å­˜)
â”‚   â”œâ”€â”€ statisticsService.ts    (æ—¢å­˜ - ã‚·ãƒ¼ã‚ºãƒ³ãƒ•ã‚£ãƒ«ã‚¿è¿½åŠ )
â”‚   â”œâ”€â”€ deckMasterService.ts    (æ—¢å­˜ - CRUDè¿½åŠ )
â”‚   â””â”€â”€ myDeckService.ts        (æ—¢å­˜ - CRUDè¿½åŠ )
â”‚
â””â”€â”€ repositories/
    â”œâ”€â”€ battleLogRepository.ts  (æ—¢å­˜)
    â”œâ”€â”€ deckMasterRepository.ts (æ—¢å­˜ - CRUDè¿½åŠ )
    â””â”€â”€ myDeckRepository.ts     (æ—¢å­˜ - CRUDè¿½åŠ )
```

---

## 4. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ ğŸ”µ

### 4.1 æ—¢å­˜ãƒ†ãƒ¼ãƒ–ãƒ«æ§‹é€ ï¼ˆå¤‰æ›´ãªã—ï¼‰ ğŸ”µ

```sql
-- ãƒ‡ãƒƒã‚­ç¨®åˆ¥ãƒã‚¹ã‚¿ãƒ¼ï¼ˆæ—¢å­˜ã®ã¾ã¾ç¶­æŒï¼‰
CREATE TABLE deck_master (
    id TEXT PRIMARY KEY,
    class_name TEXT NOT NULL,
    deck_name TEXT NOT NULL,
    sort_order INTEGER NOT NULL,
    created_at TEXT NOT NULL DEFAULT (datetime('now')),
    updated_at TEXT
);

-- ä½¿ç”¨ãƒ‡ãƒƒã‚­ï¼ˆæ—¢å­˜ã®ã¾ã¾ç¶­æŒï¼‰
CREATE TABLE my_decks (
    id TEXT PRIMARY KEY,
    deck_id TEXT NOT NULL,
    deck_code TEXT,
    deck_name TEXT NOT NULL,
    is_active INTEGER NOT NULL DEFAULT 1,
    user_id TEXT,
    created_at TEXT NOT NULL DEFAULT (datetime('now')),
    updated_at TEXT,
    FOREIGN KEY (deck_id) REFERENCES deck_master(id)
);

-- å¯¾æˆ¦å±¥æ­´ï¼ˆæ—¢å­˜ã®ã¾ã¾ç¶­æŒï¼‰
CREATE TABLE battle_logs (
    id TEXT PRIMARY KEY,
    season INTEGER NOT NULL,
    battle_date TEXT NOT NULL,
    my_deck_id TEXT NOT NULL,
    opponent_deck_id TEXT NOT NULL,
    is_first INTEGER NOT NULL,
    result TEXT NOT NULL CHECK (result IN ('win', 'lose')),
    memo TEXT,
    created_at TEXT NOT NULL DEFAULT (datetime('now')),
    updated_at TEXT,
    FOREIGN KEY (my_deck_id) REFERENCES my_decks(id),
    FOREIGN KEY (opponent_deck_id) REFERENCES deck_master(id)
);
```

### 4.2 ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¨­è¨ˆ ğŸŸ¡

```sql
-- æ—¢å­˜ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
CREATE INDEX idx_battle_logs_season ON battle_logs(season);
CREATE INDEX idx_battle_logs_battle_date ON battle_logs(battle_date);
CREATE INDEX idx_deck_master_class_name ON deck_master(class_name);
CREATE INDEX idx_deck_master_sort_order ON deck_master(sort_order);

-- è¿½åŠ æ¨å¥¨ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼ˆç›¸æ‰‹ãƒ‡ãƒƒã‚­ã‚½ãƒ¼ãƒˆæœ€é©åŒ–ç”¨ï¼‰
CREATE INDEX idx_battle_logs_opponent_deck_id ON battle_logs(opponent_deck_id);
```

---

## 5. çŠ¶æ…‹ç®¡ç†è¨­è¨ˆ ğŸ”µ

### 5.1 Zustand Storeæ‹¡å¼µ ğŸ”µ

```typescript
// stores/deckStore.ts æ‹¡å¼µ

interface DeckStore {
  // æ—¢å­˜
  deckMasters: DeckMaster[];
  myDecks: MyDeck[];
  isLoading: boolean;
  error: string | null;

  // æ—¢å­˜ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
  fetchDeckMasters: () => Promise<void>;
  fetchMyDecks: () => Promise<void>;

  // æ–°è¦ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆDeckMaster CRUDï¼‰
  addDeckMaster: (data: DeckMasterInput) => Promise<void>;
  updateDeckMaster: (id: string, data: DeckMasterUpdateInput) => Promise<void>;
  deleteDeckMaster: (id: string) => Promise<void>;

  // æ–°è¦ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆMyDeck CRUDï¼‰
  addMyDeck: (data: MyDeckInput) => Promise<void>;
  deleteMyDeck: (id: string) => Promise<void>;
}
```

### 5.2 StatisticsStoreæ‹¡å¼µ ğŸ”µ

```typescript
// stores/statisticsStore.ts æ‹¡å¼µ

interface StatisticsStore {
  // æ—¢å­˜
  statistics: Statistics | null;
  isLoading: boolean;
  error: string | null;

  // æ–°è¦çŠ¶æ…‹
  selectedSeason: number | null;      // é¸æŠä¸­ã®ã‚·ãƒ¼ã‚ºãƒ³
  availableSeasons: number[];         // åˆ©ç”¨å¯èƒ½ãªã‚·ãƒ¼ã‚ºãƒ³ä¸€è¦§

  // æ—¢å­˜ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
  fetchStatistics: () => Promise<void>;

  // æ–°è¦ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
  setSelectedSeason: (season: number) => void;
  fetchSeasons: () => Promise<void>;
  fetchStatisticsBySeason: (season: number) => Promise<void>;
}
```

---

## 6. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°è¨­è¨ˆ ğŸ”µ

### 6.1 å‰Šé™¤åˆ¶ç´„ã‚¨ãƒ©ãƒ¼ ğŸ”µ

```typescript
// å‚ç…§ã•ã‚Œã¦ã„ã‚‹ãƒ‡ãƒƒã‚­ç¨®åˆ¥ãƒ»ä½¿ç”¨ãƒ‡ãƒƒã‚­ã®å‰Šé™¤æ™‚ã‚¨ãƒ©ãƒ¼
interface DeleteConstraintError {
  code: 'DELETE_CONSTRAINT_ERROR';
  message: string;
  details: {
    entityType: 'deckMaster' | 'myDeck';
    entityId: string;
    referencedBy: 'battleLogs';
    referenceCount: number;
  };
}
```

### 6.2 ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ ğŸ”µ

```typescript
// deckNameç©ºæ–‡å­—ã‚¨ãƒ©ãƒ¼ç­‰
interface ValidationError {
  code: 'VALIDATION_ERROR';
  message: string;
  details: {
    field: string;
    constraint: string;
    value: unknown;
  }[];
}
```

---

## 7. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­è¨ˆ ğŸ”µ

### 7.1 å…¥åŠ›ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ ğŸ”µ

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ | å‚™è€ƒ |
|-----------|---------------|------|
| deckName | å¿…é ˆã€1æ–‡å­—ä»¥ä¸Šã€100æ–‡å­—ä»¥ä¸‹ | ç©ºæ–‡å­—ã¯ã‚¨ãƒ©ãƒ¼ |
| className | å¿…é ˆã€æ—¢å­˜ã‚¯ãƒ©ã‚¹åãƒªã‚¹ãƒˆã«å«ã¾ã‚Œã‚‹ã“ã¨ | é¸æŠå¼ |
| deckCode | ä»»æ„ã€ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãªã— | ç©ºç™½å¯ |

### 7.2 å‰Šé™¤æ™‚ã®æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯ ğŸ”µ

```typescript
// å‰Šé™¤å‰ã«å‚ç…§ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿæ–½
async function canDeleteDeckMaster(id: string): Promise<boolean> {
  const referenceCount = await db
    .select({ count: sql`count(*)` })
    .from(battleLogs)
    .where(eq(battleLogs.opponentDeckId, id));
  return referenceCount[0].count === 0;
}

async function canDeleteMyDeck(id: string): Promise<boolean> {
  const referenceCount = await db
    .select({ count: sql`count(*)` })
    .from(battleLogs)
    .where(eq(battleLogs.myDeckId, id));
  return referenceCount[0].count === 0;
}
```

---

## 8. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨­è¨ˆ ğŸ”µ

### 8.1 ç›¸æ‰‹ãƒ‡ãƒƒã‚­ã‚½ãƒ¼ãƒˆæœ€é©åŒ– ğŸ”µ

```sql
-- æœ€è¿‘ä½¿ç”¨ã•ã‚ŒãŸç›¸æ‰‹ãƒ‡ãƒƒã‚­ã®å–å¾—ã‚¯ã‚¨ãƒª
SELECT
  dm.*,
  MAX(bl.battle_date) as last_used_date,
  COUNT(bl.id) as usage_count
FROM deck_master dm
LEFT JOIN battle_logs bl ON dm.id = bl.opponent_deck_id
GROUP BY dm.id
ORDER BY
  CASE WHEN last_used_date IS NULL THEN 1 ELSE 0 END,
  last_used_date DESC,
  dm.sort_order ASC;
```

### 8.2 ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥ ğŸ”µ

| ãƒ‡ãƒ¼ã‚¿ç¨®åˆ¥ | TTL | ç„¡åŠ¹åŒ–ã‚¿ã‚¤ãƒŸãƒ³ã‚° |
|-----------|-----|-----------------|
| ãƒ‡ãƒƒã‚­ç¨®åˆ¥ä¸€è¦§ | 5åˆ† | è¿½åŠ ãƒ»ç·¨é›†ãƒ»å‰Šé™¤æ™‚ |
| ä½¿ç”¨ãƒ‡ãƒƒã‚­ä¸€è¦§ | 5åˆ† | è¿½åŠ ãƒ»å‰Šé™¤æ™‚ |
| ã‚·ãƒ¼ã‚ºãƒ³ä¸€è¦§ | 5åˆ† | å¯¾æˆ¦å±¥æ­´ç™»éŒ²æ™‚ |
| çµ±è¨ˆãƒ‡ãƒ¼ã‚¿ | 5åˆ† | å¯¾æˆ¦å±¥æ­´ç™»éŒ²ãƒ»å‰Šé™¤æ™‚ |

---

## 9. ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«ã‚µãƒãƒªãƒ¼

- ğŸ”µ é’ä¿¡å·: 28ä»¶ (93%)
- ğŸŸ¡ é»„ä¿¡å·: 2ä»¶ (7%)
- ğŸ”´ èµ¤ä¿¡å·: 0ä»¶ (0%)

**å“è³ªè©•ä¾¡**: é«˜å“è³ªï¼ˆã»ã¼ã™ã¹ã¦ã®è¨­è¨ˆãŒãƒ¦ãƒ¼ã‚¶ãƒ’ã‚¢ãƒªãƒ³ã‚°ã¨æ—¢å­˜è¨­è¨ˆã«åŸºã¥ãï¼‰

---

## æ›´æ–°å±¥æ­´

- **2025-01-26**: åˆç‰ˆä½œæˆï¼ˆtsumiki:kairo-design ã«ã‚ˆã‚Šç”Ÿæˆï¼‰
