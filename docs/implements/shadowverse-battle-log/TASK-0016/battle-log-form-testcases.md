# TDDテストケース定義: Battle Log登録フォーム実装

**タスクID**: TASK-0016
**タスク名**: Battle Log登録フォーム実装
**実装タイプ**: TDD Process
**作成日**: 2025-11-07
**ステータス**: テストケース定義完了

---

## 開発言語・フレームワーク

- **プログラミング言語**: TypeScript 5.7+
  - **言語選択の理由**: 型安全性を確保し、開発時のエラーを早期発見できるため
  - **テストに適した機能**: 型推論による高度な型チェック、インターフェースベースのモック作成が容易
- **テストフレームワーク**: Vitest + React Testing Library
  - **フレームワーク選択の理由**: Vite環境との統合が最適で、高速なテスト実行が可能。React Testing Libraryはユーザー視点のテストを推奨
  - **テスト実行環境**: happy-dom（軽量なDOMエミュレーション環境）
- 🔵 この内容の信頼性レベル: tech-stack.md、vitest.config.tsの実際の設定に基づいた選択

---

## 1. 正常系テストケース（基本的な動作）

### TC-FORM-001: フォームが正しく初期表示される

- **テスト名**: フォームが正しく初期表示される
  - **何をテストするか**: BattleLogFormコンポーネントが初回マウント時に正しくレンダリングされること
  - **期待される動作**: すべての入力フィールドとボタンが表示され、デフォルト値が正しく設定される
- **入力値**: なし（初期レンダリング）
  - **入力データの意味**: 初回表示時、previousInputは存在しない状態を想定
- **期待される結果**:
  - 日付フィールド: 今日の日付（YYYY-MM-DD形式）
  - 対戦タイプ: 空または選択肢リスト表示
  - ランク: 空または選択肢リスト表示
  - グループ: 空または選択肢リスト表示
  - マイデッキ: 空または選択肢リスト表示
  - ターン: 空または選択肢表示（ラジオボタン）
  - 結果: 空または選択肢表示（ラジオボタン）
  - 相手デッキ: 空または選択肢リスト表示
  - 登録ボタン: 有効化
  - キャンセルボタン: 有効化
  - **期待結果の理由**: 初回表示時は前回入力値が存在しないため、日付のみ今日の日付が自動設定される（REQ-002, REQ-003）
- **テストの目的**: フォームの初期状態が仕様通りに表示されることを確認
  - **確認ポイント**: 日付フィールドのデフォルト値が今日の日付であること、すべてのフィールドがアクセス可能であること
- 🔵 このテストケースの信頼性レベル: 要件定義書 REQ-002, REQ-003 に基づく

---

### TC-FORM-002: 前回入力値が正しく引き継がれる（日付以外）

- **テスト名**: 前回入力値が正しく引き継がれる（日付以外）
  - **何をテストするか**: Zustand Storeの previousInput から前回入力値を取得し、フォームに反映されること
  - **期待される動作**: 日付以外の7フィールドに前回入力値が自動入力され、日付は今日の日付が設定される
- **入力値**: Zustand Store の previousInput に以下の値を設定
  ```typescript
  {
    date: "2025-11-06", // 前回の日付（引き継がれない）
    battleType: "ランクマッチ",
    rank: "ダイアモンド",
    group: "AAA",
    myDeckId: "deck-001",
    turn: "先攻",
    result: "勝ち",
    opponentDeckId: "deck-master-002"
  }
  ```
  - **入力データの意味**: 前回の対戦履歴登録時の入力値を再利用し、連続入力を効率化するため（REQ-003）
  - **実際の発生シナリオ**: ユーザーが同じデッキで連続して対戦を記録する場合
- **期待される結果**:
  - 日付: 今日の日付（前回値を引き継がない）
  - 対戦タイプ: "ランクマッチ"
  - ランク: "ダイアモンド"
  - グループ: "AAA"
  - マイデッキ: "deck-001"
  - ターン: "先攻"
  - 結果: "勝ち"
  - 相手デッキ: "deck-master-002"
  - **期待結果の理由**: REQ-003により、日付以外の7フィールドは前回入力値を引き継ぐが、日付は常に今日の日付を設定する仕様
- **テストの目的**: 前回入力値の引き継ぎ機能が正しく動作することを確認
  - **確認ポイント**: 日付フィールドのみ今日の日付に上書きされ、その他は前回値が維持されること
- 🔵 このテストケースの信頼性レベル: 要件定義書 REQ-003 に基づく

---

### TC-FORM-003: 各フィールドに入力できる

- **テスト名**: 各フィールドに入力できる
  - **何をテストするか**: ユーザーが各入力フィールドに値を入力でき、内部状態が更新されること
  - **期待される動作**: onChange イベントが発火し、フォームの内部状態が正しく更新される
- **入力値**: ユーザーが以下の値を手動入力
  ```typescript
  {
    date: "2025-11-07",
    battleType: "対戦台",
    rank: "ルビー",
    group: "AA",
    myDeckId: "deck-002",
    turn: "後攻",
    result: "負け",
    opponentDeckId: "deck-master-005"
  }
  ```
  - **入力データの意味**: ユーザーが対戦台での対戦結果を記録するケース
- **期待される結果**: 各フィールドの値が入力した値に更新され、内部状態が変更される
  - **期待結果の理由**: Reactの制御コンポーネントパターンにより、onChangeイベントで状態が更新される
- **テストの目的**: フォームの各フィールドが正常に入力を受け付けることを確認
  - **確認ポイント**: すべての入力フィールドがユーザーの入力を受け付け、状態が同期されること
- 🔵 このテストケースの信頼性レベル: Reactの基本的な動作パターンに基づく

---

### TC-FORM-004: フォーム送信が成功し、onSuccessコールバックが呼ばれる

- **テスト名**: フォーム送信が成功し、onSuccessコールバックが呼ばれる
  - **何をテストするか**: フォーム送信ボタンクリック時に Zustand Store の createBattleLog() が呼ばれ、成功時に onSuccess コールバックが実行されること
  - **期待される動作**: API呼び出しが成功し、フォームが閉じられる（onSuccessコールバック経由）
- **入力値**: 正常なデータ
  ```typescript
  {
    date: "2025-11-07",
    battleType: "ランクマッチ",
    rank: "ダイアモンド",
    group: "AAA",
    myDeckId: "deck-001",
    turn: "先攻",
    result: "勝ち",
    opponentDeckId: "deck-master-002"
  }
  ```
  - **入力データの意味**: 通常のランクマッチ対戦結果を記録するケース
- **期待される結果**:
  - useBattleLogStore.createBattleLog() が1回呼ばれる
  - onSuccessコールバックが1回呼ばれる
  - isLoading が true → false に遷移する
  - エラーメッセージが表示されない
  - **期待結果の理由**: 正常系では API呼び出しが成功し、登録完了後に親コンポーネントに通知する仕様（REQ-001）
- **テストの目的**: フォーム送信処理が正常に動作し、成功コールバックが呼ばれることを確認
  - **確認ポイント**: createBattleLog()の呼び出し、onSuccessコールバックの呼び出し、ローディング状態の遷移
- 🔵 このテストケースの信頼性レベル: 要件定義書 REQ-001、データフロー図に基づく

---

### TC-FORM-005: キャンセルボタンでonCancelコールバックが呼ばれる

- **テスト名**: キャンセルボタンでonCancelコールバックが呼ばれる
  - **何をテストするか**: キャンセルボタンクリック時に onCancel コールバックが呼ばれること
  - **期待される動作**: フォームがクローズされる（onCancelコールバック経由）
- **入力値**: キャンセルボタンのクリック
  - **入力データの意味**: ユーザーが対戦履歴登録をキャンセルする操作
- **期待される結果**:
  - onCancelコールバックが1回呼ばれる
  - API呼び出しは行われない
  - **期待結果の理由**: キャンセル時はデータを送信せず、フォームを閉じる仕様
- **テストの目的**: キャンセル機能が正常に動作することを確認
  - **確認ポイント**: onCancelコールバックの呼び出し、API呼び出しが行われないこと
- 🟡 このテストケースの信頼性レベル: 一般的なフォームUIパターンから推測

---

## 2. 異常系テストケース（エラーハンドリング）

### TC-FORM-ERR-001: 未来日付でバリデーションエラーが表示される

- **テスト名**: 未来日付でバリデーションエラーが表示される
  - **エラーケースの概要**: ユーザーが未来の日付を入力した場合のクライアント側バリデーション
  - **エラー処理の重要性**: データの整合性を保証し、ユーザーに明確なフィードバックを提供するため（REQ-030）
- **入力値**: 未来の日付（"2099-12-31"）
  - **不正な理由**: 過去または今日の対戦結果のみを記録する仕様のため、未来日付は入力できない（REQ-030）
  - **実際の発生シナリオ**: ユーザーが誤って未来の日付を入力した場合、または日付入力UIの不具合
- **期待される結果**:
  - 日付フィールドの下にインラインエラーメッセージ表示: "未来の日付は入力できません"
  - 送信ボタンが無効化される
  - フォーカスが日付フィールドに移動する
  - **エラーメッセージの内容**: ユーザーが何を修正すべきか明確に理解できる日本語メッセージ（REQ-031）
  - **システムの安全性**: クライアント側でバリデーションエラーを検出し、不正なデータがBackend APIに送信されない
- **テストの目的**: 未来日付のバリデーションが正しく動作することを確認
  - **品質保証の観点**: データ整合性の保証、ユーザーへの適切なフィードバック提供
- 🔵 このテストケースの信頼性レベル: 要件定義書 REQ-030, REQ-031 に基づく

---

### TC-FORM-ERR-002: 必須項目未入力でバリデーションエラーが表示される（myDeckId）

- **テスト名**: 必須項目未入力でバリデーションエラーが表示される（myDeckId）
  - **エラーケースの概要**: マイデッキIDが未選択の場合のバリデーション
  - **エラー処理の重要性**: 必須項目の入力を強制し、不完全なデータ登録を防止するため（REQ-002）
- **入力値**: myDeckId が未選択（空文字または null）
  - **不正な理由**: myDeckIdは対戦履歴を記録する上で必須項目であり、どのデッキを使用したかを識別するため（REQ-002）
  - **実際の発生シナリオ**: ユーザーが新規登録時にマイデッキを選択せずに送信しようとした場合
- **期待される結果**:
  - マイデッキフィールドの下にインラインエラーメッセージ表示: "使用デッキは必須です"
  - 送信ボタンが無効化される
  - フォーカスがマイデッキフィールドに移動する
  - **エラーメッセージの内容**: フィールド名を明示し、ユーザーが何を入力すべきか明確に伝える
  - **システムの安全性**: 不完全なデータがBackend APIに送信されない
- **テストの目的**: 必須項目バリデーションが正しく動作することを確認
  - **品質保証の観点**: データ完全性の保証、ユーザーへの適切なフィードバック提供
- 🔵 このテストケースの信頼性レベル: 要件定義書 REQ-002 に基づく

---

### TC-FORM-ERR-003: 必須項目未入力でバリデーションエラーが表示される（opponentDeckId）

- **テスト名**: 必須項目未入力でバリデーションエラーが表示される（opponentDeckId）
  - **エラーケースの概要**: 相手デッキIDが未選択の場合のバリデーション
  - **エラー処理の重要性**: 必須項目の入力を強制し、対戦相手の情報を正確に記録するため（REQ-002）
- **入力値**: opponentDeckId が未選択（空文字または null）
  - **不正な理由**: opponentDeckIdは対戦履歴を記録する上で必須項目であり、対戦相手のデッキを識別するため（REQ-002）
  - **実際の発生シナリオ**: ユーザーが対戦相手のデッキを選択せずに送信しようとした場合
- **期待される結果**:
  - 相手デッキフィールドの下にインラインエラーメッセージ表示: "相手デッキは必須です"
  - 送信ボタンが無効化される
  - フォーカスが相手デッキフィールドに移動する
  - **エラーメッセージの内容**: フィールド名を明示し、ユーザーが何を入力すべきか明確に伝える
  - **システムの安全性**: 不完全なデータがBackend APIに送信されない
- **テストの目的**: 必須項目バリデーションが正しく動作することを確認
  - **品質保証の観点**: データ完全性の保証、ユーザーへの適切なフィードバック提供
- 🔵 このテストケースの信頼性レベル: 要件定義書 REQ-002 に基づく

---

### TC-FORM-ERR-004: APIエラー時にエラーメッセージが表示される（ネットワークエラー）

- **テスト名**: APIエラー時にエラーメッセージが表示される（ネットワークエラー）
  - **エラーケースの概要**: Backend APIへの通信が失敗した場合のエラーハンドリング
  - **エラー処理の重要性**: ネットワーク障害時でもアプリケーションが安全に動作し、ユーザーに適切なメッセージを表示するため
- **入力値**: 正常なデータを入力し、送信ボタンをクリック
  - **不正な理由**: Backend APIがネットワークエラーで応答しない状況
  - **実際の発生シナリオ**: ユーザーがオフライン状態、またはBackend APIサーバーがダウンしている場合
- **期待される結果**:
  - フォーム上部にグローバルエラーメッセージ表示: "ネットワークエラーが発生しました"
  - ローディング状態が解除される
  - フォームは閉じない（再送信可能）
  - **エラーメッセージの内容**: ユーザーがネットワーク接続を確認すべきことを理解できるメッセージ
  - **システムの安全性**: エラー時でもフォームの入力内容が失われず、再送信可能な状態を維持
- **テストの目的**: ネットワークエラー時のエラーハンドリングが正しく動作することを確認
  - **品質保証の観点**: システムの耐障害性、ユーザーへの適切なフィードバック提供
- 🔵 このテストケースの信頼性レベル: EDGE-001 (ネットワークエラー) に基づく

---

### TC-FORM-ERR-005: APIエラー時にエラーメッセージが表示される（バリデーションエラー）

- **テスト名**: APIエラー時にエラーメッセージが表示される（バリデーションエラー）
  - **エラーケースの概要**: Backend APIがバリデーションエラーを返した場合のエラーハンドリング
  - **エラー処理の重要性**: サーバー側バリデーションエラーをユーザーに明確に伝えるため（REQ-031）
- **入力値**: クライアント側バリデーションをすり抜けた不正なデータ（例: 不正な日付形式）
  - **不正な理由**: Backend APIのバリデーションルールに違反している
  - **実際の発生シナリオ**: クライアント側とサーバー側のバリデーションルールにズレがある場合
- **期待される結果**:
  - フォーム上部にグローバルエラーメッセージ表示: "入力値が不正です"
  - エラー詳細（detailsフィールド）がインラインエラーとして各フィールドに表示される
  - ローディング状態が解除される
  - フォームは閉じない（修正可能）
  - **エラーメッセージの内容**: 具体的にどのフィールドが不正かを示す
  - **システムの安全性**: エラー時でもフォームの入力内容が失われず、修正可能な状態を維持
- **テストの目的**: バリデーションエラー時のエラーハンドリングが正しく動作することを確認
  - **品質保証の観点**: サーバー側エラーの適切な表示、ユーザーが修正可能な状態の維持
- 🔵 このテストケースの信頼性レベル: EDGE-004 (APIバリデーションエラー) に基づく

---

## 3. 境界値テストケース（最小値、最大値、null等）

### TC-FORM-BND-001: 日付 = 今日（境界値：最大値）

- **テスト名**: 日付 = 今日（境界値：最大値）
  - **境界値の意味**: 入力可能な最大の日付は今日であり、未来日付は禁止される（REQ-030）
  - **境界値での動作保証**: 今日の日付は正常に登録できることを確認
- **入力値**: 今日の日付（例: "2025-11-07"）
  - **境界値選択の根拠**: REQ-030により、入力可能な最大の日付は今日（未来日付禁止）
  - **実際の使用場面**: ユーザーが今日の対戦結果を記録する通常の使用ケース
- **期待される結果**:
  - バリデーションエラーが表示されない
  - フォーム送信が成功する
  - onSuccessコールバックが呼ばれる
  - **境界での正確性**: 今日の日付は正常に受け入れられる
  - **一貫した動作**: 過去日付と同様に処理される
- **テストの目的**: 日付フィールドの境界値（今日）が正常に処理されることを確認
  - **堅牢性の確認**: 境界値でもシステムが安定動作すること
- 🔵 このテストケースの信頼性レベル: 要件定義書 REQ-030 に基づく

---

### TC-FORM-BND-002: 日付 = 今日 + 1日（境界値：最小のエラー値）

- **テスト名**: 日付 = 今日 + 1日（境界値：最小のエラー値）
  - **境界値の意味**: 未来日付の最小値（今日+1日）でもエラーが発生することを確認
  - **境界値での動作保証**: 境界を1日でも超えるとエラーになることを確認
- **入力値**: 明日の日付（例: "2025-11-08"）
  - **境界値選択の根拠**: 今日の次の日が未来日付の最小値であり、エラーになる最小境界
  - **実際の使用場面**: ユーザーが誤って明日の日付を入力した場合
- **期待される結果**:
  - 日付フィールドの下にインラインエラーメッセージ表示: "未来の日付は入力できません"
  - 送信ボタンが無効化される
  - **境界での正確性**: 今日+1日は確実にエラーになる
  - **一貫した動作**: すべての未来日付が同様にエラーになる
- **テストの目的**: 日付フィールドの境界値（未来日付の最小値）でエラーが発生することを確認
  - **堅牢性の確認**: 境界を超えた場合の動作が一貫していること
- 🔵 このテストケースの信頼性レベル: 要件定義書 REQ-030 に基づく

---

### TC-FORM-BND-003: 日付フィールドが空（null/undefined）

- **テスト名**: 日付フィールドが空（null/undefined）
  - **境界値の意味**: 日付フィールドは省略可能（省略時は今日の日付が適用される）
  - **境界値での動作保証**: 日付が未入力でも正常に登録できることを確認
- **入力値**: 日付フィールドを空にする（null または undefined）
  - **境界値選択の根拠**: REQ-002により、dateフィールドは省略可能（省略時は当日が適用される）
  - **実際の使用場面**: ユーザーが日付を入力せずに送信した場合、今日の日付が自動適用される
- **期待される結果**:
  - バリデーションエラーが表示されない
  - フォーム送信が成功する
  - Backend APIに送信されるデータの date フィールドは省略される（または今日の日付が設定される）
  - **境界での正確性**: 空の日付フィールドが今日の日付として処理される
  - **一貫した動作**: 日付省略時の動作がBackend API仕様と一致する
- **テストの目的**: 日付フィールドが省略可能であることを確認
  - **堅牢性の確認**: 空値でもシステムが安全に動作すること
- 🔵 このテストケースの信頼性レベル: 要件定義書 REQ-002（date?:string）に基づく

---

### TC-FORM-BND-004: マイデッキが0件の場合、送信ボタンが無効化される

- **テスト名**: マイデッキが0件の場合、送信ボタンが無効化される
  - **境界値の意味**: マイデッキが1件も登録されていない状態（最小値 = 0）
  - **境界値での動作保証**: マイデッキが存在しない場合はフォーム送信を防止する
- **入力値**: マイデッキ一覧が空配列（[]）
  - **境界値選択の根拠**: マイデッキが0件の場合、対戦履歴を登録できない（myDeckIdが必須のため）
  - **実際の使用場面**: 新規ユーザーがマイデッキを登録せずにフォームを開いた場合
- **期待される結果**:
  - マイデッキフィールドに選択肢が表示されない
  - マイデッキフィールドの下にメッセージ表示: "マイデッキを登録してください"
  - 送信ボタンが無効化される
  - **境界での正確性**: マイデッキが0件の場合は登録不可
  - **一貫した動作**: 不完全なデータが送信されないよう制御される
- **テストの目的**: マイデッキが0件の場合の動作を確認
  - **堅牢性の確認**: マイデッキが存在しない状態でもエラーが発生しないこと
- 🟡 このテストケースの信頼性レベル: エッジケースとして妥当な推測

---

### TC-FORM-BND-005: デッキマスターが0件の場合、送信ボタンが無効化される

- **テスト名**: デッキマスターが0件の場合、送信ボタンが無効化される
  - **境界値の意味**: デッキマスターが1件も登録されていない状態（最小値 = 0）
  - **境界値での動作保証**: デッキマスターが存在しない場合はフォーム送信を防止する
- **入力値**: デッキマスター一覧が空配列（[]）
  - **境界値選択の根拠**: デッキマスターが0件の場合、対戦履歴を登録できない（opponentDeckIdが必須のため）
  - **実際の使用場面**: システム初期化直後、デッキマスターがまだ登録されていない場合
- **期待される結果**:
  - 相手デッキフィールドに選択肢が表示されない
  - 相手デッキフィールドの下にメッセージ表示: "デッキマスターを登録してください"
  - 送信ボタンが無効化される
  - **境界での正確性**: デッキマスターが0件の場合は登録不可
  - **一貫した動作**: 不完全なデータが送信されないよう制御される
- **テストの目的**: デッキマスターが0件の場合の動作を確認
  - **堅牢性の確認**: デッキマスターが存在しない状態でもエラーが発生しないこと
- 🟡 このテストケースの信頼性レベル: エッジケースとして妥当な推測

---

## 4. UI/UXテストケース

### TC-FORM-UI-001: ローディング中はボタンが無効化される

- **テスト名**: ローディング中はボタンが無効化される
  - **何をテストするか**: フォーム送信中（isLoading = true）はボタンが無効化され、連続クリックを防止すること
  - **期待される動作**: 登録ボタンが無効化され、ローディングスピナーが表示される
- **入力値**: フォーム送信ボタンをクリック
  - **入力データの意味**: ユーザーがフォームを送信する操作
- **期待される結果**:
  - 登録ボタンが無効化される（disabled属性が付与される）
  - ローディングスピナーが表示される
  - キャンセルボタンも無効化される
  - **期待結果の理由**: 二重送信を防止し、ユーザーに処理中であることを視覚的に伝えるため
- **テストの目的**: ローディング状態中のUI動作を確認
  - **確認ポイント**: ボタンの無効化、ローディングスピナーの表示
- 🟡 このテストケースの信頼性レベル: 一般的なUXパターンから推測

---

### TC-FORM-UI-002: 送信成功後にフォームが閉じる

- **テスト名**: 送信成功後にフォームが閉じる
  - **何をテストするか**: フォーム送信成功後に onSuccess コールバックが呼ばれ、フォームが閉じること
  - **期待される動作**: フォームが閉じられ、対戦履歴一覧が更新される
- **入力値**: 正常なデータを入力し、送信ボタンをクリック
  - **入力データの意味**: ユーザーが対戦履歴を正常に登録する操作
- **期待される結果**:
  - createBattleLog() が成功する
  - onSuccess コールバックが呼ばれる
  - フォームが閉じられる
  - **期待結果の理由**: 登録完了後はフォームを閉じ、更新された対戦履歴一覧を表示するため
- **テストの目的**: 送信成功後のUI動作を確認
  - **確認ポイント**: onSuccessコールバックの呼び出し、フォームのクローズ
- 🔵 このテストケースの信頼性レベル: データフロー図に基づく

---

### TC-FORM-UI-003: レスポンシブデザインが動作する（モバイル）

- **テスト名**: レスポンシブデザインが動作する（モバイル）
  - **何をテストするか**: モバイル画面サイズ（幅 < 768px）でフォームが正しく表示されること
  - **期待される動作**: フィールドが縦に並び、スクロール可能な状態で表示される
- **入力値**: ビューポート幅を375pxに設定（iPhone サイズ）
  - **入力データの意味**: モバイルデバイスでの表示をシミュレート
- **期待される結果**:
  - すべてのフィールドが縦に並んで表示される
  - フィールドがビューポート幅に収まる
  - タップターゲットが十分な大きさ（最小44px × 44px）
  - **期待結果の理由**: REQ-603により、モバイルファーストのレスポンシブデザインが必須
- **テストの目的**: モバイル画面でのレスポンシブデザインを確認
  - **確認ポイント**: レイアウトの縦並び、タップターゲットのサイズ
- 🔵 このテストケースの信頼性レベル: 要件定義書 REQ-603 に基づく

---

### TC-FORM-UI-004: レスポンシブデザインが動作する（タブレット）

- **テスト名**: レスポンシブデザインが動作する（タブレット）
  - **何をテストするか**: タブレット画面サイズ（768px ≤ 幅 < 1024px）でフォームが正しく表示されること
  - **期待される動作**: フィールドが2カラムレイアウトで表示される
- **入力値**: ビューポート幅を768pxに設定（iPad サイズ）
  - **入力データの意味**: タブレットデバイスでの表示をシミュレート
- **期待される結果**:
  - フィールドが2カラムレイアウトで表示される
  - すべてのフィールドが画面内に収まる
  - **期待結果の理由**: REQ-603により、タブレット対応のレスポンシブデザインが必須
- **テストの目的**: タブレット画面でのレスポンシブデザインを確認
  - **確認ポイント**: 2カラムレイアウト、フィールドの配置
- 🔵 このテストケースの信頼性レベル: 要件定義書 REQ-603 に基づく

---

## 5. 統合テストケース

### TC-FORM-INT-001: マイデッキ一覧がAPI経由で取得される

- **テスト名**: マイデッキ一覧がAPI経由で取得される
  - **何をテストするか**: フォーム初期化時に GET /api/my-decks エンドポイントが呼ばれ、マイデッキ一覧が取得されること
  - **期待される動作**: マイデッキ一覧が取得され、選択肢としてフォームに表示される
- **入力値**: フォームコンポーネントのマウント
  - **入力データの意味**: フォームが表示された時点でマイデッキ一覧を取得する必要がある
- **期待される結果**:
  - GET /api/my-decks が呼ばれる
  - 取得したマイデッキ一覧が選択肢として表示される
  - **期待結果の理由**: マイデッキ一覧は動的に取得する必要があるため
- **テストの目的**: マイデッキ一覧取得処理が正常に動作することを確認
  - **確認ポイント**: API呼び出し、選択肢の表示
- 🟡 このテストケースの信頼性レベル: API設計から妥当な推測

---

### TC-FORM-INT-002: デッキマスター一覧がAPI経由で取得される

- **テスト名**: デッキマスター一覧がAPI経由で取得される
  - **何をテストするか**: フォーム初期化時に GET /api/deck-masters エンドポイントが呼ばれ、デッキマスター一覧が取得されること
  - **期待される動作**: デッキマスター一覧が取得され、選択肢としてフォームに表示される
- **入力値**: フォームコンポーネントのマウント
  - **入力データの意味**: フォームが表示された時点でデッキマスター一覧を取得する必要がある
- **期待される結果**:
  - GET /api/deck-masters が呼ばれる
  - 取得したデッキマスター一覧が選択肢として表示される
  - **期待結果の理由**: デッキマスター一覧は動的に取得する必要があるため
- **テストの目的**: デッキマスター一覧取得処理が正常に動作することを確認
  - **確認ポイント**: API呼び出し、選択肢の表示
- 🟡 このテストケースの信頼性レベル: API設計から妥当な推測

---

## 6. アクセシビリティテストケース

### TC-FORM-A11Y-001: すべてのフィールドにlabel要素が関連付けられている

- **テスト名**: すべてのフィールドにlabel要素が関連付けられている
  - **何をテストするか**: すべての入力フィールドに <label> 要素が関連付けられていること（for属性とid属性の紐付け）
  - **期待される動作**: スクリーンリーダーがフィールド名を正しく読み上げる
- **入力値**: フォームのレンダリング
  - **入力データの意味**: アクセシビリティ対応の確認
- **期待される結果**:
  - すべての入力フィールドに対応する <label> 要素が存在する
  - label要素のfor属性とinput要素のid属性が一致する
  - **期待結果の理由**: WCAG 2.1 AA準拠のため、すべてのフォームフィールドにラベルが必要
- **テストの目的**: アクセシビリティ対応（ラベル関連付け）を確認
  - **確認ポイント**: label要素の存在、for属性とid属性の紐付け
- 🟡 このテストケースの信頼性レベル: アクセシビリティ要件から推測

---

### TC-FORM-A11Y-002: バリデーションエラー時にaria-invalid属性が設定される

- **テスト名**: バリデーションエラー時にaria-invalid属性が設定される
  - **何をテストするか**: バリデーションエラーが発生した場合、該当フィールドに aria-invalid="true" 属性が設定されること
  - **期待される動作**: スクリーンリーダーがエラー状態を正しく読み上げる
- **入力値**: 未来日付を入力し、Blurイベントを発火
  - **入力データの意味**: バリデーションエラーが発生する状況を作成
- **期待される結果**:
  - 日付フィールドに aria-invalid="true" 属性が設定される
  - 日付フィールドに aria-describedby 属性が設定され、エラーメッセージと関連付けられる
  - **期待結果の理由**: WCAG 2.1 AA準拠のため、エラー状態をスクリーンリーダーに伝える必要がある
- **テストの目的**: アクセシビリティ対応（エラー状態の通知）を確認
  - **確認ポイント**: aria-invalid属性、aria-describedby属性の設定
- 🟡 このテストケースの信頼性レベル: アクセシビリティ要件から推測

---

### TC-FORM-A11Y-003: Tabキーでフォーカスが正しく移動する

- **テスト名**: Tabキーでフォーカスが正しく移動する
  - **何をテストするか**: Tabキー押下時にフォーカスが論理的な順序で移動すること
  - **期待される動作**: フォーカスが上から下、左から右の順で移動する
- **入力値**: Tabキーを連続して押下
  - **入力データの意味**: キーボードナビゲーションの確認
- **期待される結果**:
  - フォーカスが以下の順序で移動する: 日付 → 対戦タイプ → ランク → グループ → マイデッキ → ターン → 結果 → 相手デッキ → キャンセルボタン → 登録ボタン
  - すべてのフォーカス可能な要素が視覚的にハイライトされる
  - **期待結果の理由**: WCAG 2.1 AA準拠のため、論理的なフォーカス順序が必要
- **テストの目的**: キーボードナビゲーションを確認
  - **確認ポイント**: フォーカス順序、フォーカスのハイライト表示
- 🟡 このテストケースの信頼性レベル: アクセシビリティ要件から推測

---

### TC-FORM-A11Y-004: Enterキー押下でフォーム送信される

- **テスト名**: Enterキー押下でフォーム送信される
  - **何をテストするか**: フォーム内でEnterキーを押下した場合、フォーム送信が実行されること
  - **期待される動作**: Enterキー押下時にフォームが送信される
- **入力値**: フォーム内でEnterキーを押下
  - **入力データの意味**: キーボードショートカットの確認
- **期待される結果**:
  - Enterキー押下時にフォームが送信される
  - createBattleLog() が呼ばれる
  - **期待結果の理由**: 一般的なフォームUXとして、Enterキーで送信できることが期待される
- **テストの目的**: キーボードショートカット（Enterキー送信）を確認
  - **確認ポイント**: Enterキー押下時のフォーム送信
- 🟡 このテストケースの信頼性レベル: 一般的なフォームUXから推測

---

### TC-FORM-A11Y-005: Escキー押下でフォームが閉じる

- **テスト名**: Escキー押下でフォームが閉じる
  - **何をテストするか**: フォーム内でEscキーを押下した場合、onCancel コールバックが呼ばれてフォームが閉じること
  - **期待される動作**: Escキー押下時にフォームがキャンセルされる
- **入力値**: フォーム内でEscキーを押下
  - **入力データの意味**: キーボードショートカットの確認
- **期待される結果**:
  - Escキー押下時に onCancel コールバックが呼ばれる
  - フォームが閉じられる
  - **期待結果の理由**: 一般的なモーダルUIとして、Escキーで閉じることが期待される
- **テストの目的**: キーボードショートカット（Escキー閉じる）を確認
  - **確認ポイント**: Escキー押下時のフォームクローズ
- 🟡 このテストケースの信頼性レベル: 一般的なモーダルUXから推測

---

## 7. エッジケース

### TC-FORM-EDGE-001: previousInputが部分的な値の場合でも正常に動作する

- **テスト名**: previousInputが部分的な値の場合でも正常に動作する
  - **何をテストするか**: Zustand Store の previousInput が部分的な値（一部のフィールドのみ存在）の場合でも正常に動作すること
  - **期待される動作**: 存在するフィールドのみデフォルト値として設定され、存在しないフィールドは空のまま
- **入力値**: previousInput に一部のフィールドのみ設定
  ```typescript
  {
    battleType: "ランクマッチ",
    myDeckId: "deck-001"
  }
  ```
  - **入力データの意味**: previousInputが完全でない状態（データ移行時やバグによる部分的データ）
- **期待される結果**:
  - 対戦タイプ: "ランクマッチ"
  - マイデッキ: "deck-001"
  - その他のフィールド: 空
  - エラーが発生しない
  - **期待結果の理由**: 部分的なデータでもアプリケーションが安全に動作すること
- **テストの目的**: 部分的なpreviousInputでも正常に動作することを確認
  - **確認ポイント**: エラーが発生しないこと、存在するフィールドのみデフォルト値として設定されること
- 🟡 このテストケースの信頼性レベル: エッジケースとして妥当な推測

---

### TC-FORM-EDGE-002: previousInputがnullの場合でも正常に動作する

- **テスト名**: previousInputがnullの場合でも正常に動作する
  - **何をテストするか**: Zustand Store の previousInput が null の場合でも正常に動作すること
  - **期待される動作**: すべてのフィールドが空で初期化され、日付のみ今日の日付が設定される
- **入力値**: previousInput = null
  - **入力データの意味**: 初回登録時、またはpreviousInputがクリアされた状態
- **期待される結果**:
  - 日付: 今日の日付
  - その他のフィールド: 空
  - エラーが発生しない
  - **期待結果の理由**: 初回登録時の標準的な動作
- **テストの目的**: previousInput が null でも正常に動作することを確認
  - **確認ポイント**: エラーが発生しないこと、日付のみ今日の日付が設定されること
- 🔵 このテストケースの信頼性レベル: 初回登録時の標準動作

---

## テストケース実装時の日本語コメント指針

各テストケースの実装時には以下の日本語コメントを必ず含めてください：

### テストケース開始時のコメント

```typescript
// 【テスト目的】: [このテストで何を確認するかを日本語で明記]
// 【テスト内容】: [具体的にどのような処理をテストするかを説明]
// 【期待される動作】: [正常に動作した場合の結果を説明]
// 🔵🟡🔴 この内容の信頼性レベルを記載
```

### Given（準備フェーズ）のコメント

```typescript
// 【テストデータ準備】: [なぜこのデータを用意するかの理由]
// 【初期条件設定】: [テスト実行前の状態を説明]
// 【前提条件確認】: [テスト実行に必要な前提条件を明記]
```

### When（実行フェーズ）のコメント

```typescript
// 【実際の処理実行】: [どの機能/メソッドを呼び出すかを説明]
// 【処理内容】: [実行される処理の内容を日本語で説明]
// 【実行タイミング】: [なぜこのタイミングで実行するかを説明]
```

### Then（検証フェーズ）のコメント

```typescript
// 【結果検証】: [何を検証するかを具体的に説明]
// 【期待値確認】: [期待される結果とその理由を説明]
// 【品質保証】: [この検証がシステム品質にどう貢献するかを説明]
```

### 各expectステートメントのコメント

```typescript
// 【検証項目】: [この検証で確認している具体的な項目]
// 🔵🟡🔴 この内容の信頼性レベルを記載
expect(result).toBe(expected); // 【確認内容】: [具体的な確認内容]
```

### セットアップ・クリーンアップのコメント

```typescript
beforeEach(() => {
  // 【テスト前準備】: [各テスト実行前に行う準備作業の説明]
  // 【環境初期化】: [テスト環境をクリーンな状態にする理由と方法]
});

afterEach(() => {
  // 【テスト後処理】: [各テスト実行後に行うクリーンアップ作業の説明]
  // 【状態復元】: [次のテストに影響しないよう状態を復元する理由]
});
```

---

## テストケース分類まとめ

### 正常系テストケース（5件）
- TC-FORM-001: フォームが正しく初期表示される
- TC-FORM-002: 前回入力値が正しく引き継がれる（日付以外）
- TC-FORM-003: 各フィールドに入力できる
- TC-FORM-004: フォーム送信が成功し、onSuccessコールバックが呼ばれる
- TC-FORM-005: キャンセルボタンでonCancelコールバックが呼ばれる

### 異常系テストケース（5件）
- TC-FORM-ERR-001: 未来日付でバリデーションエラーが表示される
- TC-FORM-ERR-002: 必須項目未入力でバリデーションエラーが表示される（myDeckId）
- TC-FORM-ERR-003: 必須項目未入力でバリデーションエラーが表示される（opponentDeckId）
- TC-FORM-ERR-004: APIエラー時にエラーメッセージが表示される（ネットワークエラー）
- TC-FORM-ERR-005: APIエラー時にエラーメッセージが表示される（バリデーションエラー）

### 境界値テストケース（5件）
- TC-FORM-BND-001: 日付 = 今日（境界値：最大値）
- TC-FORM-BND-002: 日付 = 今日 + 1日（境界値：最小のエラー値）
- TC-FORM-BND-003: 日付フィールドが空（null/undefined）
- TC-FORM-BND-004: マイデッキが0件の場合、送信ボタンが無効化される
- TC-FORM-BND-005: デッキマスターが0件の場合、送信ボタンが無効化される

### UI/UXテストケース（4件）
- TC-FORM-UI-001: ローディング中はボタンが無効化される
- TC-FORM-UI-002: 送信成功後にフォームが閉じる
- TC-FORM-UI-003: レスポンシブデザインが動作する（モバイル）
- TC-FORM-UI-004: レスポンシブデザインが動作する（タブレット）

### 統合テストケース（2件）
- TC-FORM-INT-001: マイデッキ一覧がAPI経由で取得される
- TC-FORM-INT-002: デッキマスター一覧がAPI経由で取得される

### アクセシビリティテストケース（5件）
- TC-FORM-A11Y-001: すべてのフィールドにlabel要素が関連付けられている
- TC-FORM-A11Y-002: バリデーションエラー時にaria-invalid属性が設定される
- TC-FORM-A11Y-003: Tabキーでフォーカスが正しく移動する
- TC-FORM-A11Y-004: Enterキー押下でフォーム送信される
- TC-FORM-A11Y-005: Escキー押下でフォームが閉じる

### エッジケース（2件）
- TC-FORM-EDGE-001: previousInputが部分的な値の場合でも正常に動作する
- TC-FORM-EDGE-002: previousInputがnullの場合でも正常に動作する

**合計**: 28件のテストケース

---

## 品質判定

### ✅ 高品質

- **テストケース分類**: 正常系・異常系・境界値が網羅されている（正常系5件、異常系5件、境界値5件、UI/UX4件、統合2件、アクセシビリティ5件、エッジケース2件）
- **期待値定義**: 各テストケースの期待値が明確で、要件定義書と整合性が取れている
- **技術選択**: プログラミング言語（TypeScript 5.7+）・テストフレームワーク（Vitest + React Testing Library）が確定
- **実装可能性**: 現在の技術スタックで実現可能（Vitest設定、既存テストパターンと整合性あり）

---

## 次のステップ

次のお勧めステップ: `/tsumiki:tdd-red` でRedフェーズ（失敗テスト作成）を開始します。

---

## 更新履歴

- **2025-11-07**: 初版作成（TDDテストケース定義完了）
  - 正常系5件、異常系5件、境界値5件、UI/UX4件、統合2件、アクセシビリティ5件、エッジケース2件の合計28件のテストケースを定義
  - 要件定義書（REQ-001, REQ-002, REQ-003, REQ-030, REQ-031, REQ-603）に基づいた包括的なテストケースを作成
  - 既存のテストパターン（battleLogStore.test.ts, client.test.ts）を参考に、日本語コメント指針を整備
