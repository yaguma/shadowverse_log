# TASK-0032: 相手デッキ選択肢ソート機能 - 要件定義

## 概要

対戦履歴登録フォーム（BattleLogForm）の相手デッキ選択肢を、最近使用順でソートして表示する機能を実装する。

## 機能要件

### REQ-0032-001: 相手デッキ選択肢の最近使用順ソート

**EARS記法**: When ユーザーが対戦履歴登録フォームを開く時 the システム shall 相手デッキ選択肢を最近使用順でソートして表示する

**受け入れ基準**:
- [x] 最終使用日が新しいデッキが上位に表示される
- [x] 使用履歴のないデッキはsortOrder順で末尾に表示される
- [x] 同じ最終使用日の場合はsortOrder順でソートされる

### REQ-0032-002: 使用回数の表示（オプション）

**EARS記法**: When 相手デッキ選択肢が表示される時 the システム shall 使用回数を選択肢に表示する

**受け入れ基準**:
- [x] 使用回数が0より大きい場合、デッキ名の後ろに「(N回)」形式で表示される
- [x] 使用回数が0の場合は回数を表示しない

### REQ-0032-003: データ取得方法

**EARS記法**: When フォームが初期化される時 the システム shall includeUsage=trueパラメータ付きでデッキマスターAPIを呼び出す

**受け入れ基準**:
- [x] `fetchDeckMastersWithUsage(true)`がフォーム初期化時に呼び出される
- [x] `deckMastersWithUsage`ステートが相手デッキ選択に使用される

### REQ-0032-004: ローディング状態の表示

**EARS記法**: While デッキマスターデータを取得中 the システム shall ローディング状態を表示する

**受け入れ基準**:
- [x] `isLoadingDeckMasters`がtrueの間、適切なUI状態が表示される
- [x] ローディング中はフォーム送信ボタンが無効化される

### REQ-0032-005: エラーハンドリング

**EARS記法**: If デッキマスターAPIがエラーを返す場合 the システム shall エラーメッセージを表示する

**受け入れ基準**:
- [x] `deckMasterError`がnullでない場合、エラーメッセージが表示される
- [x] エラー時でもフォームは操作可能な状態を維持する

## 非機能要件

### NFR-0032-001: パフォーマンス

- APIレスポンスは300ms以内を目標
- デッキマスター数が100件以上でも問題なく動作する

### NFR-0032-002: 互換性

- 既存のテストケースを破壊しない
- 既存のAPI呼び出しパターンとの互換性を維持

## テストケース概要

| テストID | テスト内容 | 期待結果 |
|----------|------------|----------|
| TC-0032-001 | 最近使用順ソート | lastUsedDate降順で表示 |
| TC-0032-002 | 使用回数表示 | 「(N回)」形式で表示 |
| TC-0032-003 | 未使用デッキの位置 | 末尾に表示 |
| TC-0032-004 | ローディング状態 | 適切なUI表示 |
| TC-0032-005 | エラーハンドリング | エラーメッセージ表示 |

## 関連文書

- タスク定義: `docs/tasks/deck-management-extension/TASK-0032.md`
- API仕様: `docs/design/deck-management-extension/api-endpoints.md`
- データフロー: `docs/design/deck-management-extension/dataflow.md`
