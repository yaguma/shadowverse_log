# TASK-0041: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ– - è¦ä»¶å®šç¾©

## ğŸ”µ æ¦‚è¦

ã“ã®ã‚¿ã‚¹ã‚¯ã§ã¯ã€Shadowverse Battle Log ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ã‚’å®Ÿè£…ã™ã‚‹ã€‚

## ğŸ”µ è¦ä»¶ID

- **NFR-301**: APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¿ã‚¤ãƒ  100msä»¥ä¸‹
- **NFR-302**: åˆæœŸãƒ­ãƒ¼ãƒ‰æ™‚é–“ 1ç§’ä»¥ä¸‹

## ğŸ”µ æ©Ÿèƒ½è¦ä»¶

### 1. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰æœ€é©åŒ–

#### 1.1 ã‚³ãƒ¼ãƒ‰åˆ†å‰²ï¼ˆReact Lazy Loadingï¼‰
- **ä¿¡é ¼æ€§**: ğŸ”µ
- ãƒšãƒ¼ã‚¸ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’å‹•çš„ã‚¤ãƒ³ãƒãƒ¼ãƒˆã§é…å»¶èª­ã¿è¾¼ã¿
- å¯¾è±¡ãƒšãƒ¼ã‚¸:
  - `BattleLogListPage`
  - `StatisticsDashboardPage`
  - `ImportDataPage`
- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ä¸­ã¯ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯UIè¡¨ç¤º

#### 1.2 ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºæœ€é©åŒ–
- **ä¿¡é ¼æ€§**: ğŸ”µ
- Viteã®manual chunksè¨­å®šã§ãƒãƒ³ãƒ‰ãƒ«åˆ†å‰²
- åˆ†å‰²æ–¹é‡:
  - `vendor`: react, react-dom, react-router-dom
  - `store`: zustand (çŠ¶æ…‹ç®¡ç†)
  - `charts`: recharts (ã‚°ãƒ©ãƒ•ãƒ©ã‚¤ãƒ–ãƒ©ãƒª)
- gzipåœ§ç¸®å¾Œ 500KBä»¥ä¸‹

### 2. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰æœ€é©åŒ–

#### 2.1 CDNã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢
- **ä¿¡é ¼æ€§**: ğŸ”µ
- Cloudflare Workers Cache APIä½¿ç”¨
- å¯¾è±¡ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ:
  - `/api/deck-master` (ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿ã€TTL: 5åˆ†)
- Cache-Controlãƒ˜ãƒƒãƒ€ãƒ¼è¨­å®š

#### 2.2 D1ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¯ã‚¨ãƒªæœ€é©åŒ–
- **ä¿¡é ¼æ€§**: ğŸ”µ
- è¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¿½åŠ :
  - `idx_battle_logs_user_date`: (user_id, date DESC)
  - `idx_battle_logs_user_type_result`: (user_id, battle_type, result)
  - `idx_my_decks_user_active`: (user_id, is_active DESC)
- N+1å•é¡Œã®è§£æ¶ˆï¼ˆJOINã‚¯ã‚¨ãƒªä½¿ç”¨ï¼‰

## ğŸ”µ éæ©Ÿèƒ½è¦ä»¶

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åŸºæº–

| é …ç›® | ç›®æ¨™å€¤ | å‚™è€ƒ |
|------|--------|------|
| åˆæœŸãƒ­ãƒ¼ãƒ‰æ™‚é–“ | < 1ç§’ | First Contentful Paint |
| APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¿ã‚¤ãƒ  | < 100ms | ã‚¨ãƒƒã‚¸å®Ÿè¡Œæ™‚ |
| ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚º | < 500KB | gzipåœ§ç¸®å¾Œ |
| Lighthouse Performance | > 85ç‚¹ | ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ— |

## ğŸ”µ å®Œäº†æ¡ä»¶

- [ ] React Lazy Loading ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹
- [ ] CDNã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒå‹•ä½œã™ã‚‹
- [ ] D1ã‚¯ã‚¨ãƒªãŒæœ€é©åŒ–ã•ã‚Œã¦ã„ã‚‹
- [ ] ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãŒè¿½åŠ ã•ã‚Œã¦ã„ã‚‹
- [ ] ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºãŒ500KBä»¥ä¸‹
- [ ] åˆæœŸãƒ­ãƒ¼ãƒ‰æ™‚é–“ãŒ1ç§’ä»¥ä¸‹
- [ ] APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¿ã‚¤ãƒ ãŒ100msä»¥ä¸‹
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆãŒæˆåŠŸã™ã‚‹

## ğŸ”µ æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

- **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰**: React 19, Vite 6, TypeScript
- **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰**: Hono, Cloudflare Workers
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**: Cloudflare D1 (SQLite)
- **ã‚­ãƒ£ãƒƒã‚·ãƒ¥**: Cloudflare Cache API

## ğŸ”µ å½±éŸ¿ç¯„å›²

- `frontend/src/main.tsx` - ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¨­å®šå¤‰æ›´
- `frontend/vite.config.ts` - ãƒ“ãƒ«ãƒ‰è¨­å®šæœ€é©åŒ–
- `backend/src/middleware/cache.ts` - æ–°è¦ä½œæˆ
- `backend/src/db/migrations/0001_add_indexes.sql` - æ–°è¦ä½œæˆ
- `backend/src/index.ts` - ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢è¿½åŠ 

## ğŸ”µ é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- `docs/design/shadowverse-battle-log/architecture-cloudflare.md`
- `docs/design/shadowverse-battle-log/api-endpoints-cloudflare.md`
- `docs/tasks/cloudflare-migration-phase4-part2.md`
