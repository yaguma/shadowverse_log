# TASK-0038: レスポンシブ対応・E2Eテスト 要件定義書

## 1. タスク概要

### 1.1 目的
Shadowverse Battle Log のフロントエンド全体のレスポンシブ対応を完成させ、Playwright によるE2Eテストを実装・完成させることで、PC・モバイル両環境でのユーザビリティと品質を保証する。

### 1.2 スコープ
- **レスポンシブ対応**: Tailwind CSS によるモバイル・PC対応のレイアウト最終調整
- **E2Eテスト**: Playwright による7ケース以上のE2Eテスト実装

### 1.3 信頼性レベル
🔵 **青信号**: EARS要件定義書・設計文書を参考にしてほぼ推測していない

## 2. 関連要件

### 2.1 機能要件 (🔵)
| 要件ID | 要件内容 | 優先度 |
|--------|----------|--------|
| REQ-034 | レスポンシブデザイン対応 | 必須 |
| REQ-603 | モバイルファーストデザイン | 必須 |
| NFR-101 | モバイル対応 | 必須 |

### 2.2 非機能要件 (🔵)
| 要件ID | 要件内容 | 目標値 |
|--------|----------|--------|
| NFR-PERF-001 | ページロード時間 | 3秒以内 |
| NFR-A11Y-001 | アクセシビリティ | WCAG 2.1 AA準拠 |

## 3. レスポンシブ対応仕様

### 3.1 ブレークポイント設計 (🔵)
Tailwind CSS v4 のデフォルトブレークポイントを使用:

| ブレークポイント | 画面幅 | 対象デバイス |
|-----------------|--------|--------------|
| sm | 640px以上 | スマートフォン横向き |
| md | 768px以上 | タブレット |
| lg | 1024px以上 | デスクトップ |
| xl | 1280px以上 | 大画面デスクトップ |

### 3.2 表示切り替え仕様

#### 3.2.1 対戦履歴一覧 (BattleLogList)
| 画面サイズ | 表示形式 | Tailwindクラス |
|-----------|---------|---------------|
| lg未満 | カード形式 | `lg:hidden` |
| lg以上 | テーブル形式 | `hidden lg:table` |

#### 3.2.2 統計ダッシュボード (StatisticsDashboardPage)
| 画面サイズ | レイアウト | Tailwindクラス |
|-----------|-----------|---------------|
| sm未満 | 1カラム | デフォルト |
| sm以上 | 2カラム | `sm:grid-cols-2` |
| lg以上 | 3カラム | `lg:grid-cols-3` |

### 3.3 現在の実装状況 (🔵)

#### 3.3.1 BattleLogList.tsx
- ✅ テーブル表示 (lg以上): `hidden lg:table`
- ✅ カード表示 (lg未満): `lg:hidden`
- 🟡 テスト環境での分岐処理あり (`import.meta.env.VITEST`)

#### 3.3.2 StatisticsDashboardPage.tsx
- ✅ 基本レイアウト実装済み
- 🟡 レスポンシブグリッドの最適化が必要な場合あり

## 4. E2Eテスト仕様

### 4.1 テスト環境 (🔵)
- **テストフレームワーク**: Playwright
- **テストブラウザ**: Chromium (必須), Mobile Chrome (モバイルテスト用)
- **ベースURL**: `http://localhost:5173`
- **開発サーバー自動起動**: `pnpm dev`

### 4.2 テストケース一覧

#### 4.2.1 対戦履歴機能 (battle-log.spec.ts)
| テストID | テストケース | 実装状況 |
|---------|-------------|---------|
| E2E-BL-001 | 対戦履歴ページが表示される | ✅ 実装済み |
| E2E-BL-002 | 対戦履歴登録フォームが開く | ✅ 実装済み |
| E2E-BL-003 | 対戦履歴を登録できる | ⏳ スキップ中 (モックAPI必要) |
| E2E-BL-004 | 対戦履歴一覧が表示される | ⏳ スキップ中 (テストデータ必要) |
| E2E-BL-005 | 対戦履歴を削除できる | ⏳ スキップ中 (テストデータ必要) |

#### 4.2.2 統計ダッシュボード機能 (statistics.spec.ts)
| テストID | テストケース | 実装状況 |
|---------|-------------|---------|
| E2E-ST-001 | 統計ダッシュボードページが表示される | ✅ 実装済み |
| E2E-ST-002 | 期間を選択して統計情報が表示される | ⏳ スキップ中 |
| E2E-ST-003 | 全体統計が表示される | ⏳ スキップ中 |
| E2E-ST-004 | デッキ別統計が表示される | ⏳ スキップ中 |
| E2E-ST-005 | 円グラフが表示される | ⏳ スキップ中 |
| E2E-ST-006 | レスポンシブデザインが動作する | ⏳ スキップ中 |

### 4.3 実装方針

#### 4.3.1 モックAPI戦略 (🟡)
現在のE2Eテストではモックサーバーが未設定のため、以下の戦略を検討:

1. **Playwright MSW**: Mock Service Worker を使用した API モック
2. **テストデータセットアップ**: テスト前にバックエンドAPIを呼び出してデータを準備
3. **スナップショットテスト**: UI の見た目のみをテスト

**選択**: 実装工数を考慮し、現状のE2Eテストは「ページ表示確認」「UI操作確認」に限定し、API連携を伴うテストは統合テスト（Vitest）でカバーする。

#### 4.3.2 モバイルテスト追加
Playwright 設定にモバイルプロジェクトを追加:
```typescript
{
  name: 'Mobile Chrome',
  use: { ...devices['Pixel 5'] },
}
```

## 5. 完了条件

### 5.1 レスポンシブ対応
- [ ] モバイル対応が実装されている（lg未満: カード表示）
- [ ] PC対応が実装されている（lg以上: テーブル表示）
- [ ] 統計ダッシュボードがレスポンシブに表示される

### 5.2 E2Eテスト
- [ ] Playwright E2Eテストが実装されている（7ケース以上）
- [ ] すべてのE2Eテストが成功する
- [ ] モバイル表示テストが成功する

### 5.3 品質
- [ ] Biome lintエラーが0件
- [ ] TypeScript型エラーが0件

## 6. 依存関係

### 6.1 前提タスク
- **TASK-0036**: 対戦履歴UI実装 ✅ 完了
- **TASK-0037**: 統計ダッシュボード実装 ✅ 完了

### 6.2 後続タスク
- **TASK-0039**: Cloudflare Access認証

## 7. 技術スタック

| 技術 | バージョン | 用途 |
|------|----------|------|
| React | 19.x | フロントエンドフレームワーク |
| Tailwind CSS | v4 | スタイリング・レスポンシブ |
| Playwright | latest | E2Eテスト |
| Vitest | latest | 単体テスト |
| TypeScript | 5.7+ | 型安全性 |

## 更新履歴
- 2025-11-30: 初版作成
