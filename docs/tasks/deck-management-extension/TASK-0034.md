# TASK-0034: å…¨æ©Ÿèƒ½çµ±åˆE2Eãƒ†ã‚¹ãƒˆ

## ã‚¿ã‚¹ã‚¯æƒ…å ±

- **ã‚¿ã‚¹ã‚¯ID**: TASK-0034
- **ã‚¿ã‚¤ãƒ—**: TDD
- **æ¨å®šå·¥æ•°**: 2æ™‚é–“
- **ãƒ•ã‚§ãƒ¼ã‚º**: Phase 6 - å¯¾æˆ¦å±¥æ­´UIæ”¹å–„
- **ä¿¡é ¼æ€§**: ğŸ”µ
- **ä¾å­˜ã‚¿ã‚¹ã‚¯**: TASK-0033
- **å¾Œç¶šã‚¿ã‚¹ã‚¯**: ãªã—ï¼ˆæœ€çµ‚ã‚¿ã‚¹ã‚¯ï¼‰
- **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: [x] å®Œäº†

---

## æ¦‚è¦

å…¨æ©Ÿèƒ½ã‚’é€šã—ãŸçµ±åˆE2Eãƒ†ã‚¹ãƒˆã‚’ä½œæˆã™ã‚‹ã€‚ãƒ‡ãƒƒã‚­ç¨®åˆ¥è¿½åŠ â†’ä½¿ç”¨ãƒ‡ãƒƒã‚­è¿½åŠ â†’å¯¾æˆ¦å±¥æ­´ç™»éŒ²â†’çµ±è¨ˆç¢ºèªã®ä¸€é€£ã®ãƒ•ãƒ­ãƒ¼ã¨ã€ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ï¼ˆå‰Šé™¤åˆ¶ç´„ã€ç©ºå…¥åŠ›ç­‰ï¼‰ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹ã€‚

---

## å®Ÿè£…å†…å®¹

### 1. çµ±åˆE2Eãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ

`packages/frontend/e2e/integration.spec.ts`:

```typescript
import { test, expect } from '@playwright/test';

test.describe('å…¨æ©Ÿèƒ½çµ±åˆãƒ†ã‚¹ãƒˆ', () => {
  test.describe('ãƒ•ãƒ«ãƒ•ãƒ­ãƒ¼: ãƒ‡ãƒƒã‚­è¿½åŠ â†’å¯¾æˆ¦è¨˜éŒ²â†’çµ±è¨ˆç¢ºèª', () => {
    test('ãƒ‡ãƒƒã‚­ç¨®åˆ¥è¿½åŠ ã‹ã‚‰çµ±è¨ˆç¢ºèªã¾ã§ã®å®Œå…¨ãƒ•ãƒ­ãƒ¼', async ({ page }) => {
      // 1. ãƒ‡ãƒƒã‚­ç®¡ç†ç”»é¢ã«ç§»å‹•
      await page.goto('/decks');
      await expect(page.locator('h1')).toHaveText('ãƒ‡ãƒƒã‚­ç®¡ç†');

      // 2. ãƒ‡ãƒƒã‚­ç¨®åˆ¥ã‚’è¿½åŠ 
      await page.click('button:has-text("ãƒ‡ãƒƒã‚­ç¨®åˆ¥ã‚’è¿½åŠ ")');
      await expect(page.locator('[role="dialog"]')).toBeVisible();

      const testClassName = `ãƒ†ã‚¹ãƒˆã‚¯ãƒ©ã‚¹_${Date.now()}`;
      const testDeckName = `ãƒ†ã‚¹ãƒˆãƒ‡ãƒƒã‚­_${Date.now()}`;

      await page.fill('input[name="className"]', testClassName);
      await page.fill('input[name="deckName"]', testDeckName);
      await page.click('button:has-text("ä¿å­˜")');
      await expect(page.locator('[role="dialog"]')).not.toBeVisible();

      // ãƒ‡ãƒƒã‚­ç¨®åˆ¥ãŒä¸€è¦§ã«è¿½åŠ ã•ã‚ŒãŸã“ã¨ã‚’ç¢ºèª
      await expect(page.locator(`text=${testDeckName}`)).toBeVisible();

      // 3. ä½¿ç”¨ãƒ‡ãƒƒã‚­ã‚¿ãƒ–ã«åˆ‡ã‚Šæ›¿ãˆ
      await page.click('button:has-text("ä½¿ç”¨ãƒ‡ãƒƒã‚­")');
      await expect(page.locator('[data-testid="my-deck-list"]')).toBeVisible();

      // 4. ä½¿ç”¨ãƒ‡ãƒƒã‚­ã‚’è¿½åŠ 
      await page.click('button:has-text("ä½¿ç”¨ãƒ‡ãƒƒã‚­ã‚’è¿½åŠ ")');
      await expect(page.locator('[role="dialog"]')).toBeVisible();

      const myDeckName = `ãƒã‚¤ãƒ‡ãƒƒã‚­_${Date.now()}`;

      // å…ˆã»ã©è¿½åŠ ã—ãŸãƒ‡ãƒƒã‚­ç¨®åˆ¥ã‚’é¸æŠ
      await page.selectOption('select[name="deckId"]', { label: testDeckName });
      await page.fill('input[name="deckCode"]', 'test-deck-code-123');
      await page.fill('input[name="deckName"]', myDeckName);
      await page.click('button:has-text("ä¿å­˜")');
      await expect(page.locator('[role="dialog"]')).not.toBeVisible();

      // ä½¿ç”¨ãƒ‡ãƒƒã‚­ãŒä¸€è¦§ã«è¿½åŠ ã•ã‚ŒãŸã“ã¨ã‚’ç¢ºèª
      await expect(page.locator(`text=${myDeckName}`)).toBeVisible();

      // 5. çµ±è¨ˆç”»é¢ã«ç§»å‹•ã—ã¦å¯¾æˆ¦å±¥æ­´ã‚’ç™»éŒ²
      await page.click('nav >> text=çµ±è¨ˆ');
      await expect(page).toHaveURL('/statistics');

      await page.click('button:has-text("å¯¾æˆ¦ã‚’è¨˜éŒ²")');
      await expect(page.locator('[role="dialog"]')).toBeVisible();

      // ãƒ•ã‚©ãƒ¼ãƒ å…¥åŠ›
      await page.selectOption('select[name="myDeckId"]', { label: myDeckName });
      await page.selectOption('select[name="opponentDeckId"]', { index: 1 });
      await page.selectOption('select[name="turn"]', 'å…ˆæ”»');
      await page.selectOption('select[name="result"]', 'å‹ã¡');
      await page.click('button:has-text("ä¿å­˜")');
      await expect(page.locator('[role="dialog"]')).not.toBeVisible();

      // 6. çµ±è¨ˆãŒæ›´æ–°ã•ã‚ŒãŸã“ã¨ã‚’ç¢ºèª
      await page.waitForResponse((response) =>
        response.url().includes('/api/statistics') && response.status() === 200
      );

      // çµ±è¨ˆã«ä½¿ç”¨ãƒ‡ãƒƒã‚­ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
      await expect(page.locator(`text=${myDeckName}`).first()).toBeVisible();
    });
  });

  test.describe('ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹: å‰Šé™¤åˆ¶ç´„', () => {
    test('å¯¾æˆ¦å±¥æ­´ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ãƒ‡ãƒƒã‚­ç¨®åˆ¥ã¯å‰Šé™¤ã§ããªã„', async ({ page }) => {
      // å‰ææ¡ä»¶: å¯¾æˆ¦å±¥æ­´ãŒå­˜åœ¨ã™ã‚‹ãƒ‡ãƒƒã‚­ç¨®åˆ¥ãŒã‚ã‚‹

      await page.goto('/decks');

      // ä½¿ç”¨ä¸­ã®ãƒ‡ãƒƒã‚­ç¨®åˆ¥ã®å‰Šé™¤ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
      // ï¼ˆå®Ÿéš›ã®å®Ÿè£…ã«å¿œã˜ã¦èª¿æ•´ãŒå¿…è¦ï¼‰
      const deleteButton = page.locator('[data-testid="deck-master-row"]:has-text("ä½¿ç”¨ä¸­")').locator('button:has-text("å‰Šé™¤")');

      if (await deleteButton.isVisible()) {
        await deleteButton.click();

        // ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°ãŒè¡¨ç¤ºã•ã‚ŒãŸå ´åˆ
        const confirmDialog = page.locator('[role="alertdialog"]');
        if (await confirmDialog.isVisible()) {
          await page.click('button:has-text("å‰Šé™¤")');
        }

        // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
        await expect(page.locator('text=å‰Šé™¤ã§ãã¾ã›ã‚“')).toBeVisible();
      }
    });

    test('ä½¿ç”¨ãƒ‡ãƒƒã‚­ã«ç´ä»˜ã„ã¦ã„ã‚‹ãƒ‡ãƒƒã‚­ç¨®åˆ¥ã¯å‰Šé™¤æ™‚ã«è­¦å‘ŠãŒè¡¨ç¤ºã•ã‚Œã‚‹', async ({ page }) => {
      await page.goto('/decks');

      // ãƒ†ã‚¹ãƒˆç”¨ã®ãƒ‡ãƒƒã‚­ç¨®åˆ¥ã¨ä½¿ç”¨ãƒ‡ãƒƒã‚­ã‚’ä½œæˆ
      // ... (ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å‡¦ç†)

      // å‰Šé™¤æ™‚ã«è­¦å‘Šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
    });
  });

  test.describe('ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹: ç©ºå…¥åŠ›ãƒ»ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³', () => {
    test('ãƒ‡ãƒƒã‚­ç¨®åˆ¥: å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒç©ºã®å ´åˆã¯ä¿å­˜ã§ããªã„', async ({ page }) => {
      await page.goto('/decks');
      await page.click('button:has-text("ãƒ‡ãƒƒã‚­ç¨®åˆ¥ã‚’è¿½åŠ ")');
      await expect(page.locator('[role="dialog"]')).toBeVisible();

      // ä½•ã‚‚å…¥åŠ›ã›ãšã«ä¿å­˜ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
      await page.click('button:has-text("ä¿å­˜")');

      // HTMLãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚ˆã‚Šãƒ€ã‚¤ã‚¢ãƒ­ã‚°ãŒé–‰ã˜ãªã„ã“ã¨ã‚’ç¢ºèª
      await expect(page.locator('[role="dialog"]')).toBeVisible();

      // å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºãŒã‚ã‚‹ã“ã¨ã‚’ç¢ºèª
      const classNameInput = page.locator('input[name="className"]');
      await expect(classNameInput).toHaveAttribute('required');
    });

    test('ä½¿ç”¨ãƒ‡ãƒƒã‚­: ãƒ‡ãƒƒã‚­ç¨®åˆ¥æœªé¸æŠã®å ´åˆã¯ä¿å­˜ã§ããªã„', async ({ page }) => {
      await page.goto('/decks');
      await page.click('button:has-text("ä½¿ç”¨ãƒ‡ãƒƒã‚­")');
      await page.click('button:has-text("ä½¿ç”¨ãƒ‡ãƒƒã‚­ã‚’è¿½åŠ ")');
      await expect(page.locator('[role="dialog"]')).toBeVisible();

      // ãƒ‡ãƒƒã‚­ç¨®åˆ¥ã‚’é¸æŠã›ãšã«ä¿å­˜
      await page.fill('input[name="deckCode"]', 'test-code');
      await page.fill('input[name="deckName"]', 'ãƒ†ã‚¹ãƒˆ');
      await page.click('button:has-text("ä¿å­˜")');

      // ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ãŒé–‰ã˜ãªã„ã“ã¨ã‚’ç¢ºèª
      await expect(page.locator('[role="dialog"]')).toBeVisible();
    });

    test('å¯¾æˆ¦å±¥æ­´: ä½¿ç”¨ãƒ‡ãƒƒã‚­ãƒ»ç›¸æ‰‹ãƒ‡ãƒƒã‚­æœªé¸æŠã®å ´åˆã¯ä¿å­˜ã§ããªã„', async ({ page }) => {
      await page.goto('/statistics');
      await page.click('button:has-text("å¯¾æˆ¦ã‚’è¨˜éŒ²")');
      await expect(page.locator('[role="dialog"]')).toBeVisible();

      // ä½•ã‚‚é¸æŠã›ãšã«ä¿å­˜
      await page.click('button:has-text("ä¿å­˜")');

      // ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ãŒé–‰ã˜ãªã„ã“ã¨ã‚’ç¢ºèª
      await expect(page.locator('[role="dialog"]')).toBeVisible();
    });
  });

  test.describe('ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹: ãƒ‡ãƒ¼ã‚¿ãªã—çŠ¶æ…‹', () => {
    test('ãƒ‡ãƒƒã‚­ç¨®åˆ¥0ä»¶: ç©ºçŠ¶æ…‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹', async ({ page }) => {
      // æ³¨: ã“ã®ãƒ†ã‚¹ãƒˆã¯å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿çŠ¶æ…‹ã«ä¾å­˜
      // ãƒ¢ãƒƒã‚¯APIã‚’ä½¿ç”¨ã™ã‚‹ã‹ã€ãƒ†ã‚¹ãƒˆç”¨ã®çŠ¶æ…‹ã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã™ã‚‹å¿…è¦ã‚ã‚Š
    });

    test('å¯¾æˆ¦å±¥æ­´0ä»¶: çµ±è¨ˆç”»é¢ã§é©åˆ‡ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹', async ({ page }) => {
      await page.goto('/statistics');

      // ãƒ‡ãƒ¼ã‚¿ãŒãªã„å ´åˆã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç¢ºèª
      // å®Ÿéš›ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«å¿œã˜ã¦èª¿æ•´
      const emptyMessage = page.locator('text=çµ±è¨ˆãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“');
      const recordButton = page.locator('button:has-text("æœ€åˆã®å¯¾æˆ¦ã‚’è¨˜éŒ²ã™ã‚‹")');

      // ã„ãšã‚Œã‹ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
      const isEmptyMessageVisible = await emptyMessage.isVisible().catch(() => false);
      const isRecordButtonVisible = await recordButton.isVisible().catch(() => false);

      if (!isEmptyMessageVisible && !isRecordButtonVisible) {
        // çµ±è¨ˆãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹å ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—
        test.skip();
      }
    });
  });

  test.describe('ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³é€£æº', () => {
    test('å…¨ãƒšãƒ¼ã‚¸é–“ã‚’æ­£å¸¸ã«é·ç§»ã§ãã‚‹', async ({ page }) => {
      // ãƒ›ãƒ¼ãƒ  â†’ å¯¾æˆ¦å±¥æ­´
      await page.goto('/');
      await page.click('nav >> text=å¯¾æˆ¦å±¥æ­´');
      await expect(page).toHaveURL('/battle-logs');

      // å¯¾æˆ¦å±¥æ­´ â†’ çµ±è¨ˆ
      await page.click('nav >> text=çµ±è¨ˆ');
      await expect(page).toHaveURL('/statistics');

      // çµ±è¨ˆ â†’ ãƒ‡ãƒƒã‚­ç®¡ç†
      await page.click('nav >> text=ãƒ‡ãƒƒã‚­ç®¡ç†');
      await expect(page).toHaveURL('/decks');

      // ãƒ‡ãƒƒã‚­ç®¡ç† â†’ ãƒ›ãƒ¼ãƒ 
      await page.click('nav >> text=ãƒ›ãƒ¼ãƒ ');
      await expect(page).toHaveURL('/');
    });

    test('å„ãƒšãƒ¼ã‚¸ã§ãƒ‡ãƒ¼ã‚¿ãŒæ­£ã—ãè¡¨ç¤ºã•ã‚Œã‚‹', async ({ page }) => {
      // å¯¾æˆ¦å±¥æ­´ãƒšãƒ¼ã‚¸
      await page.goto('/battle-logs');
      await expect(page.locator('h1')).toBeVisible();

      // çµ±è¨ˆãƒšãƒ¼ã‚¸
      await page.goto('/statistics');
      await expect(page.locator('h1')).toBeVisible();

      // ãƒ‡ãƒƒã‚­ç®¡ç†ãƒšãƒ¼ã‚¸
      await page.goto('/decks');
      await expect(page.locator('h1')).toBeVisible();
    });
  });

  test.describe('ã‚·ãƒ¼ã‚ºãƒ³é€£æº', () => {
    test('çµ±è¨ˆç”»é¢ã§ã‚·ãƒ¼ã‚ºãƒ³ã‚’åˆ‡ã‚Šæ›¿ãˆã¦ã‚‚å¯¾æˆ¦å±¥æ­´ç™»éŒ²ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã«åæ˜ ã•ã‚Œã‚‹', async ({ page }) => {
      await page.goto('/statistics');

      // ã‚·ãƒ¼ã‚ºãƒ³ä¸€è¦§ãŒèª­ã¿è¾¼ã¾ã‚Œã‚‹ã¾ã§å¾…æ©Ÿ
      await page.waitForSelector('#season-select option');

      // ã‚·ãƒ¼ã‚ºãƒ³ã‚’é¸æŠ
      const select = page.locator('#season-select');
      const options = select.locator('option');
      const optionCount = await options.count();

      if (optionCount > 1) {
        // 2ç•ªç›®ã®ã‚·ãƒ¼ã‚ºãƒ³ã‚’é¸æŠ
        await select.selectOption({ index: 1 });

        // å¯¾æˆ¦å±¥æ­´ç™»éŒ²ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’é–‹ã
        await page.click('button:has-text("å¯¾æˆ¦ã‚’è¨˜éŒ²")');
        await expect(page.locator('[role="dialog"]')).toBeVisible();

        // ãƒ€ã‚¤ã‚¢ãƒ­ã‚°å†…ã®ã‚·ãƒ¼ã‚ºãƒ³é¸æŠãŒé€£å‹•ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
        const dialogSeasonSelect = page.locator('[role="dialog"] select[name="season"]');
        const selectedSeason = await dialogSeasonSelect.inputValue();
        const expectedSeason = await options.nth(1).getAttribute('value');

        expect(selectedSeason).toBe(expectedSeason);
      }
    });
  });
});
```

### 2. ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ç®¡ç†ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£

`packages/frontend/e2e/utils/test-data-manager.ts`:

```typescript
import { Page } from '@playwright/test';

/**
 * ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆã™ã‚‹ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
 */
export class TestDataManager {
  constructor(private page: Page) {}

  /**
   * ãƒ‡ãƒƒã‚­ç¨®åˆ¥ã‚’ä½œæˆ
   */
  async createDeckMaster(className: string, deckName: string): Promise<string> {
    await this.page.goto('/decks');
    await this.page.click('button:has-text("ãƒ‡ãƒƒã‚­ç¨®åˆ¥ã‚’è¿½åŠ ")');
    await this.page.fill('input[name="className"]', className);
    await this.page.fill('input[name="deckName"]', deckName);
    await this.page.click('button:has-text("ä¿å­˜")');
    await this.page.waitForSelector('[role="dialog"]', { state: 'hidden' });

    // ä½œæˆã•ã‚ŒãŸIDã‚’è¿”ã™ï¼ˆå®Ÿè£…ã«å¿œã˜ã¦èª¿æ•´ï¼‰
    return deckName;
  }

  /**
   * ä½¿ç”¨ãƒ‡ãƒƒã‚­ã‚’ä½œæˆ
   */
  async createMyDeck(deckMasterName: string, deckCode: string, deckName: string): Promise<string> {
    await this.page.goto('/decks');
    await this.page.click('button:has-text("ä½¿ç”¨ãƒ‡ãƒƒã‚­")');
    await this.page.click('button:has-text("ä½¿ç”¨ãƒ‡ãƒƒã‚­ã‚’è¿½åŠ ")');
    await this.page.selectOption('select[name="deckId"]', { label: deckMasterName });
    await this.page.fill('input[name="deckCode"]', deckCode);
    await this.page.fill('input[name="deckName"]', deckName);
    await this.page.click('button:has-text("ä¿å­˜")');
    await this.page.waitForSelector('[role="dialog"]', { state: 'hidden' });

    return deckName;
  }

  /**
   * å¯¾æˆ¦å±¥æ­´ã‚’ç™»éŒ²
   */
  async createBattleLog(
    myDeckName: string,
    opponentDeckIndex: number = 1,
    turn: 'å…ˆæ”»' | 'å¾Œæ”»' = 'å…ˆæ”»',
    result: 'å‹ã¡' | 'è² ã‘' = 'å‹ã¡'
  ): Promise<void> {
    await this.page.goto('/statistics');
    await this.page.click('button:has-text("å¯¾æˆ¦ã‚’è¨˜éŒ²")');
    await this.page.selectOption('select[name="myDeckId"]', { label: myDeckName });
    await this.page.selectOption('select[name="opponentDeckId"]', { index: opponentDeckIndex });
    await this.page.selectOption('select[name="turn"]', turn);
    await this.page.selectOption('select[name="result"]', result);
    await this.page.click('button:has-text("ä¿å­˜")');
    await this.page.waitForSelector('[role="dialog"]', { state: 'hidden' });
  }
}
```

### 3. çµ±åˆãƒ†ã‚¹ãƒˆç”¨ãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£

`packages/frontend/e2e/fixtures/integration-fixtures.ts`:

```typescript
import { test as base } from '@playwright/test';
import { TestDataManager } from '../utils/test-data-manager';

interface IntegrationFixtures {
  testDataManager: TestDataManager;
  uniqueId: string;
}

export const test = base.extend<IntegrationFixtures>({
  testDataManager: async ({ page }, use) => {
    const manager = new TestDataManager(page);
    await use(manager);
  },

  uniqueId: async ({}, use) => {
    const id = `test_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
    await use(id);
  },
});

export { expect } from '@playwright/test';
```

---

## ãƒ†ã‚¹ãƒˆè¦ä»¶

### E2Eãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ä¸€è¦§

| ã‚«ãƒ†ã‚´ãƒª | ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ | èª¬æ˜ |
|---|---|---|
| ãƒ•ãƒ«ãƒ•ãƒ­ãƒ¼ | å®Œå…¨ãƒ•ãƒ­ãƒ¼ | ãƒ‡ãƒƒã‚­è¿½åŠ â†’å¯¾æˆ¦è¨˜éŒ²â†’çµ±è¨ˆç¢ºèª |
| å‰Šé™¤åˆ¶ç´„ | ä½¿ç”¨ä¸­ãƒ‡ãƒƒã‚­å‰Šé™¤ | å¯¾æˆ¦å±¥æ­´ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ãƒ‡ãƒƒã‚­ã¯å‰Šé™¤ä¸å¯ |
| ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ | å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ç©º | ä¿å­˜ãƒœã‚¿ãƒ³ãŒç„¡åŠ¹ã¾ãŸã¯è­¦å‘Šè¡¨ç¤º |
| ãƒ‡ãƒ¼ã‚¿ãªã— | ç©ºçŠ¶æ…‹ | é©åˆ‡ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º |
| ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ | ãƒšãƒ¼ã‚¸é·ç§» | å…¨ãƒšãƒ¼ã‚¸é–“ã®é·ç§»ãŒæ­£å¸¸ |
| ã‚·ãƒ¼ã‚ºãƒ³é€£æº | ã‚·ãƒ¼ã‚ºãƒ³é¸æŠåæ˜  | çµ±è¨ˆç”»é¢ã®ã‚·ãƒ¼ã‚ºãƒ³ãŒãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã«åæ˜  |

---

## å®Œäº†æ¡ä»¶

- [ ] çµ±åˆE2Eãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ãŒä½œæˆã•ã‚Œã¦ã„ã‚‹
- [ ] ãƒ•ãƒ«ãƒ•ãƒ­ãƒ¼ãƒ†ã‚¹ãƒˆãŒæˆåŠŸã™ã‚‹
- [ ] ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆãŒæˆåŠŸã™ã‚‹
- [ ] ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³é€£æºãƒ†ã‚¹ãƒˆãŒæˆåŠŸã™ã‚‹
- [ ] ã™ã¹ã¦ã®E2Eãƒ†ã‚¹ãƒˆãŒæˆåŠŸã™ã‚‹

---

## å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰

```bash
# çµ±åˆE2Eãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
pnpm exec playwright test e2e/integration.spec.ts

# ã™ã¹ã¦ã®E2Eãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
pnpm exec playwright test

# å¤±æ•—ã—ãŸãƒ†ã‚¹ãƒˆã®ã¿å†å®Ÿè¡Œ
pnpm exec playwright test --last-failed

# ãƒ†ã‚¹ãƒˆãƒ¬ãƒãƒ¼ãƒˆè¡¨ç¤º
pnpm exec playwright show-report
```

---

## æ¤œè¨¼æ‰‹é †

1. `packages/frontend/e2e/integration.spec.ts` ãŒå­˜åœ¨ã™ã‚‹ã‹ç¢ºèª
2. `pnpm exec playwright test e2e/integration.spec.ts` ã§ãƒ†ã‚¹ãƒˆãŒæˆåŠŸã™ã‚‹ã‹ç¢ºèª
3. ãƒ†ã‚¹ãƒˆãƒ¬ãƒãƒ¼ãƒˆã‚’ç¢ºèªï¼ˆ`playwright-report/index.html`ï¼‰
4. å…¨E2Eãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦æˆåŠŸã™ã‚‹ã“ã¨ã‚’ç¢ºèª

---

## é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [TASK-0033: å¯¾æˆ¦å±¥æ­´UIæ”¹å–„E2Eãƒ†ã‚¹ãƒˆ](./TASK-0033.md)
- [ãƒ‡ãƒƒã‚­ç®¡ç†æ©Ÿèƒ½æ‹¡å¼µ æŠ€è¡“è¨­è¨ˆæ›¸](../../design/deck-management-extension/)
- [ãƒ‡ãƒƒã‚­ç®¡ç†æ©Ÿèƒ½æ‹¡å¼µ è¦ä»¶å®šç¾©æ›¸](../../spec/deck-management-extension-requirements.md)

---

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå®Œäº†ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

ã“ã®ã‚¿ã‚¹ã‚¯ãŒå®Œäº†ã™ã‚‹ã¨ã€ãƒ‡ãƒƒã‚­ç®¡ç†æ©Ÿèƒ½æ‹¡å¼µãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã™ã¹ã¦ã®ã‚¿ã‚¹ã‚¯ãŒå®Œäº†ã¨ãªã‚‹ã€‚
ä»¥ä¸‹ã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã§æœ€çµ‚ç¢ºèªã‚’è¡Œã†ã“ã¨:

### Phase 1ã€œ3ï¼ˆæ—¢å­˜ï¼‰
- [ ] ãƒ‡ãƒƒã‚­ãƒã‚¹ã‚¿ãƒ¼CRUD API
- [ ] ãƒã‚¤ãƒ‡ãƒƒã‚­CRUD API
- [ ] ãƒ‡ãƒƒã‚­é–¢é€£ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

### Phase 4: ãƒ‡ãƒƒã‚­ç®¡ç†ç”»é¢çµ±åˆ
- [ ] TASK-0022: DeckManagePageã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
- [ ] TASK-0023: ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³æ‹¡å¼µ
- [ ] TASK-0024: ãƒ‡ãƒƒã‚­ç®¡ç†ç”»é¢E2Eãƒ†ã‚¹ãƒˆ

### Phase 5: çµ±è¨ˆç”»é¢æ©Ÿèƒ½æ‹¡å¼µ
- [ ] TASK-0025: ã‚·ãƒ¼ã‚ºãƒ³ä¸€è¦§å–å¾—API
- [ ] TASK-0026: ã‚·ãƒ¼ã‚ºãƒ³åˆ¥çµ±è¨ˆå–å¾—API
- [ ] TASK-0027: StatisticsStoreæ‹¡å¼µ
- [ ] TASK-0028: ã‚·ãƒ¼ã‚ºãƒ³é¸æŠUI
- [ ] TASK-0029: å¯¾æˆ¦å±¥æ­´ç™»éŒ²ãƒœã‚¿ãƒ³
- [ ] TASK-0030: çµ±è¨ˆç”»é¢E2Eãƒ†ã‚¹ãƒˆ

### Phase 6: å¯¾æˆ¦å±¥æ­´UIæ”¹å–„
- [ ] TASK-0031: ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆæ”¹å–„
- [ ] TASK-0032: ç›¸æ‰‹ãƒ‡ãƒƒã‚­ã‚½ãƒ¼ãƒˆ
- [ ] TASK-0033: UIæ”¹å–„E2Eãƒ†ã‚¹ãƒˆ
- [ ] TASK-0034: å…¨æ©Ÿèƒ½çµ±åˆE2Eãƒ†ã‚¹ãƒˆï¼ˆæœ¬ã‚¿ã‚¹ã‚¯ï¼‰

### æœ€çµ‚ç¢ºèª
- [ ] å…¨ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆãŒæˆåŠŸã™ã‚‹
- [ ] TypeScriptã‚¨ãƒ©ãƒ¼ãŒãªã„
- [ ] Lintã‚¨ãƒ©ãƒ¼ãŒãªã„
- [ ] ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒæœ€æ–°ã§ã‚ã‚‹
