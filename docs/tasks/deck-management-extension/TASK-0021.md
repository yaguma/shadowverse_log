# TASK-0021: ä½¿ç”¨ãƒ‡ãƒƒã‚­ç®¡ç†E2Eãƒ†ã‚¹ãƒˆ

## ã‚¿ã‚¹ã‚¯æ¦‚è¦

- **ã‚¿ã‚¹ã‚¯ID**: TASK-0021
- **ã‚¿ã‚¤ãƒˆãƒ«**: ä½¿ç”¨ãƒ‡ãƒƒã‚­ç®¡ç†E2Eãƒ†ã‚¹ãƒˆ
- **ã‚¿ã‚¤ãƒ—**: TDD
- **æ¨å®šå·¥æ•°**: 2æ™‚é–“
- **ãƒ•ã‚§ãƒ¼ã‚º**: Phase 3 - ä½¿ç”¨ãƒ‡ãƒƒã‚­ç®¡ç†æ©Ÿèƒ½
- **ä¿¡é ¼æ€§**: ğŸ”µ
- **ä¾å­˜ã‚¿ã‚¹ã‚¯**: TASK-0020
- **å¾Œç¶šã‚¿ã‚¹ã‚¯**: TASK-0022
- **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: [ ] æœªç€æ‰‹

---

## è¦ä»¶

### æ©Ÿèƒ½è¦ä»¶

- Playwright ã«ã‚ˆã‚‹ä½¿ç”¨ãƒ‡ãƒƒã‚­è¿½åŠ  E2E ãƒ†ã‚¹ãƒˆ
- ä½¿ç”¨ãƒ‡ãƒƒã‚­å‰Šé™¤ E2E ãƒ†ã‚¹ãƒˆ
- å‰Šé™¤åˆ¶ç´„ã‚¨ãƒ©ãƒ¼ E2E ãƒ†ã‚¹ãƒˆ

### ãƒ†ã‚¹ãƒˆå¯¾è±¡ãƒ•ãƒ­ãƒ¼

1. ä½¿ç”¨ãƒ‡ãƒƒã‚­è¿½åŠ ãƒ•ãƒ­ãƒ¼
2. ä½¿ç”¨ãƒ‡ãƒƒã‚­å‰Šé™¤ãƒ•ãƒ­ãƒ¼
3. å‰Šé™¤åˆ¶ç´„ã‚¨ãƒ©ãƒ¼ãƒ•ãƒ­ãƒ¼

---

## å®Ÿè£…è©³ç´°

### 1. Playwrightè¨­å®š

```typescript
// playwright.config.ts

import { defineConfig, devices } from '@playwright/test';

export default defineConfig({
  testDir: './e2e',
  fullyParallel: true,
  forbidOnly: !!process.env.CI,
  retries: process.env.CI ? 2 : 0,
  workers: process.env.CI ? 1 : undefined,
  reporter: 'html',
  use: {
    baseURL: 'http://localhost:5173',
    trace: 'on-first-retry',
    screenshot: 'only-on-failure',
  },
  projects: [
    {
      name: 'chromium',
      use: { ...devices['Desktop Chrome'] },
    },
  ],
  webServer: {
    command: 'pnpm dev',
    url: 'http://localhost:5173',
    reuseExistingServer: !process.env.CI,
  },
});
```

### 2. ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£

```typescript
// e2e/utils/test-helpers.ts

import { Page, expect } from '@playwright/test';

/**
 * ä½¿ç”¨ãƒ‡ãƒƒã‚­ä¸€è¦§ãƒšãƒ¼ã‚¸ã«ç§»å‹•
 */
export async function navigateToMyDecks(page: Page): Promise<void> {
  await page.goto('/my-decks');
  await page.waitForLoadState('networkidle');
}

/**
 * ä½¿ç”¨ãƒ‡ãƒƒã‚­ã‚’è¿½åŠ 
 */
export async function addMyDeck(
  page: Page,
  options: {
    className: string;
    deckName: string;
    deckCode?: string;
  }
): Promise<void> {
  // è¿½åŠ ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯
  await page.getByTestId('add-deck-button').click();

  // ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã®ã‚’å¾…ã¤
  await expect(page.getByTestId('mydeck-dialog')).toBeVisible();

  // ã‚¯ãƒ©ã‚¹é¸æŠ
  await page.getByTestId('deck-class-select').click();
  await page.getByText(options.className).click();

  // ãƒ‡ãƒƒã‚­åå…¥åŠ›
  await page.getByTestId('deck-name-input').fill(options.deckName);

  // ãƒ‡ãƒƒã‚­ã‚³ãƒ¼ãƒ‰å…¥åŠ›ï¼ˆä»»æ„ï¼‰
  if (options.deckCode) {
    await page.getByTestId('deck-code-input').fill(options.deckCode);
  }

  // ç™»éŒ²ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯
  await page.getByTestId('submit-button').click();

  // ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ãŒé–‰ã˜ã‚‹ã®ã‚’å¾…ã¤
  await expect(page.getByTestId('mydeck-dialog')).not.toBeVisible();
}

/**
 * ä½¿ç”¨ãƒ‡ãƒƒã‚­ã‚’å‰Šé™¤
 */
export async function deleteMyDeck(page: Page, deckName: string): Promise<void> {
  // å¯¾è±¡ãƒ‡ãƒƒã‚­ã®å‰Šé™¤ãƒœã‚¿ãƒ³ã‚’è¦‹ã¤ã‘ã¦ã‚¯ãƒªãƒƒã‚¯
  const deckItem = page.locator(`[data-testid^="deck-item-"]`, {
    hasText: deckName,
  });
  await deckItem.getByTestId('delete-button').click();

  // ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã§å‰Šé™¤ã‚’ã‚¯ãƒªãƒƒã‚¯
  await page.getByTestId('confirm-dialog-confirm').click();
}

/**
 * ãƒ‡ãƒƒã‚­ãŒä¸€è¦§ã«å­˜åœ¨ã™ã‚‹ã“ã¨ã‚’ç¢ºèª
 */
export async function expectDeckExists(page: Page, deckName: string): Promise<void> {
  await expect(page.getByText(deckName)).toBeVisible();
}

/**
 * ãƒ‡ãƒƒã‚­ãŒä¸€è¦§ã«å­˜åœ¨ã—ãªã„ã“ã¨ã‚’ç¢ºèª
 */
export async function expectDeckNotExists(page: Page, deckName: string): Promise<void> {
  await expect(page.getByText(deckName)).not.toBeVisible();
}

/**
 * ç©ºãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
 */
export async function expectEmptyMessage(page: Page): Promise<void> {
  await expect(page.getByTestId('empty-message')).toBeVisible();
}
```

### 3. E2Eãƒ†ã‚¹ãƒˆå®Ÿè£…

```typescript
// e2e/my-decks.spec.ts

import { test, expect } from '@playwright/test';
import {
  navigateToMyDecks,
  addMyDeck,
  deleteMyDeck,
  expectDeckExists,
  expectDeckNotExists,
  expectEmptyMessage,
} from './utils/test-helpers';

test.describe('ä½¿ç”¨ãƒ‡ãƒƒã‚­ç®¡ç†', () => {
  test.describe('ä½¿ç”¨ãƒ‡ãƒƒã‚­è¿½åŠ ', () => {
    test('æ–°ã—ã„ä½¿ç”¨ãƒ‡ãƒƒã‚­ã‚’è¿½åŠ ã§ãã‚‹', async ({ page }) => {
      await navigateToMyDecks(page);

      // ãƒ‡ãƒƒã‚­ã‚’è¿½åŠ 
      await addMyDeck(page, {
        className: 'ã‚¦ã‚£ãƒƒãƒ',
        deckName: 'E2Eãƒ†ã‚¹ãƒˆãƒ‡ãƒƒã‚­',
        deckCode: 'TEST123',
      });

      // è¿½åŠ ã•ã‚ŒãŸãƒ‡ãƒƒã‚­ãŒä¸€è¦§ã«è¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
      await expectDeckExists(page, 'E2Eãƒ†ã‚¹ãƒˆãƒ‡ãƒƒã‚­');

      // ã‚¯ãƒ©ã‚¹åãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
      await expect(page.getByText('ã‚¦ã‚£ãƒƒãƒ')).toBeVisible();

      // ãƒ‡ãƒƒã‚­ã‚³ãƒ¼ãƒ‰ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
      await expect(page.getByText('TEST123')).toBeVisible();
    });

    test('ãƒ‡ãƒƒã‚­ã‚³ãƒ¼ãƒ‰ç„¡ã—ã§ã‚‚è¿½åŠ ã§ãã‚‹', async ({ page }) => {
      await navigateToMyDecks(page);

      await addMyDeck(page, {
        className: 'ãƒ­ã‚¤ãƒ¤ãƒ«',
        deckName: 'ã‚³ãƒ¼ãƒ‰ç„¡ã—ãƒ‡ãƒƒã‚­',
      });

      await expectDeckExists(page, 'ã‚³ãƒ¼ãƒ‰ç„¡ã—ãƒ‡ãƒƒã‚­');
    });

    test('ãƒ‡ãƒƒã‚­åãŒç©ºã®å ´åˆã¯ã‚¨ãƒ©ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã‚‹', async ({ page }) => {
      await navigateToMyDecks(page);

      // è¿½åŠ ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯
      await page.getByTestId('add-deck-button').click();

      // ã‚¯ãƒ©ã‚¹ã®ã¿é¸æŠ
      await page.getByTestId('deck-class-select').click();
      await page.getByText('ã‚¦ã‚£ãƒƒãƒ').click();

      // ãƒ‡ãƒƒã‚­åã‚’ç©ºã®ã¾ã¾ç™»éŒ²ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯
      await page.getByTestId('submit-button').click();

      // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
      await expect(page.getByTestId('deck-name-error')).toBeVisible();
      await expect(page.getByTestId('deck-name-error')).toHaveText('ãƒ‡ãƒƒã‚­åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');

      // ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ãŒé–‰ã˜ã¦ã„ãªã„ã“ã¨ã‚’ç¢ºèª
      await expect(page.getByTestId('mydeck-dialog')).toBeVisible();
    });

    test('ã‚¯ãƒ©ã‚¹æœªé¸æŠã®å ´åˆã¯ã‚¨ãƒ©ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã‚‹', async ({ page }) => {
      await navigateToMyDecks(page);

      // è¿½åŠ ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯
      await page.getByTestId('add-deck-button').click();

      // ãƒ‡ãƒƒã‚­åã®ã¿å…¥åŠ›
      await page.getByTestId('deck-name-input').fill('ãƒ†ã‚¹ãƒˆãƒ‡ãƒƒã‚­');

      // ç™»éŒ²ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯
      await page.getByTestId('submit-button').click();

      // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
      await expect(page.getByTestId('deck-id-error')).toBeVisible();
      await expect(page.getByTestId('deck-id-error')).toHaveText('ã‚¯ãƒ©ã‚¹ã‚’é¸æŠã—ã¦ãã ã•ã„');
    });

    test('ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãƒœã‚¿ãƒ³ã§ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ãŒé–‰ã˜ã‚‹', async ({ page }) => {
      await navigateToMyDecks(page);

      // è¿½åŠ ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯
      await page.getByTestId('add-deck-button').click();
      await expect(page.getByTestId('mydeck-dialog')).toBeVisible();

      // ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯
      await page.getByTestId('cancel-button').click();

      // ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ãŒé–‰ã˜ã‚‹ã“ã¨ã‚’ç¢ºèª
      await expect(page.getByTestId('mydeck-dialog')).not.toBeVisible();
    });
  });

  test.describe('ä½¿ç”¨ãƒ‡ãƒƒã‚­å‰Šé™¤', () => {
    test.beforeEach(async ({ page }) => {
      await navigateToMyDecks(page);
      // ãƒ†ã‚¹ãƒˆç”¨ãƒ‡ãƒƒã‚­ã‚’è¿½åŠ 
      await addMyDeck(page, {
        className: 'ãƒã‚¯ãƒ­ãƒãƒ³ã‚µãƒ¼',
        deckName: 'å‰Šé™¤ãƒ†ã‚¹ãƒˆãƒ‡ãƒƒã‚­',
      });
    });

    test('ä½¿ç”¨ãƒ‡ãƒƒã‚­ã‚’å‰Šé™¤ã§ãã‚‹', async ({ page }) => {
      // ãƒ‡ãƒƒã‚­ãŒå­˜åœ¨ã™ã‚‹ã“ã¨ã‚’ç¢ºèª
      await expectDeckExists(page, 'å‰Šé™¤ãƒ†ã‚¹ãƒˆãƒ‡ãƒƒã‚­');

      // å‰Šé™¤å®Ÿè¡Œ
      await deleteMyDeck(page, 'å‰Šé™¤ãƒ†ã‚¹ãƒˆãƒ‡ãƒƒã‚­');

      // ãƒ‡ãƒƒã‚­ãŒä¸€è¦§ã‹ã‚‰æ¶ˆãˆã‚‹ã“ã¨ã‚’ç¢ºèª
      await expectDeckNotExists(page, 'å‰Šé™¤ãƒ†ã‚¹ãƒˆãƒ‡ãƒƒã‚­');
    });

    test('å‰Šé™¤ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã§ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã™ã‚‹ã¨å‰Šé™¤ã•ã‚Œãªã„', async ({ page }) => {
      // å‰Šé™¤ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯
      const deckItem = page.locator(`[data-testid^="deck-item-"]`, {
        hasText: 'å‰Šé™¤ãƒ†ã‚¹ãƒˆãƒ‡ãƒƒã‚­',
      });
      await deckItem.getByTestId('delete-button').click();

      // ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
      await expect(page.getByTestId('confirm-dialog')).toBeVisible();

      // ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã‚’ã‚¯ãƒªãƒƒã‚¯
      await page.getByTestId('confirm-dialog-cancel').click();

      // ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ãŒé–‰ã˜ã‚‹ã“ã¨ã‚’ç¢ºèª
      await expect(page.getByTestId('confirm-dialog')).not.toBeVisible();

      // ãƒ‡ãƒƒã‚­ãŒæ®‹ã£ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
      await expectDeckExists(page, 'å‰Šé™¤ãƒ†ã‚¹ãƒˆãƒ‡ãƒƒã‚­');
    });
  });

  test.describe('å‰Šé™¤åˆ¶ç´„ã‚¨ãƒ©ãƒ¼', () => {
    test('å¯¾æˆ¦å±¥æ­´ã‹ã‚‰å‚ç…§ã•ã‚Œã¦ã„ã‚‹ãƒ‡ãƒƒã‚­ã¯å‰Šé™¤ã§ããªã„', async ({ page }) => {
      // æ³¨: ã“ã®ãƒ†ã‚¹ãƒˆã«ã¯ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãŒå¿…è¦
      // å¯¾æˆ¦å±¥æ­´ã‹ã‚‰å‚ç…§ã•ã‚Œã¦ã„ã‚‹ãƒ‡ãƒƒã‚­ã‚’ç”¨æ„ã™ã‚‹å¿…è¦ãŒã‚ã‚‹

      await navigateToMyDecks(page);

      // å‚ç…§ã•ã‚Œã¦ã„ã‚‹ãƒ‡ãƒƒã‚­ã®å‰Šé™¤ãƒœã‚¿ãƒ³ãŒç„¡åŠ¹åŒ–ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
      const referencedDeckItem = page.locator(`[data-testid^="deck-item-"]`, {
        hasText: 'å‚ç…§ã•ã‚Œã¦ã„ã‚‹ãƒ‡ãƒƒã‚­', // ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã«ä¾å­˜
      });

      const deleteButton = referencedDeckItem.getByTestId('delete-button');
      await expect(deleteButton).toBeDisabled();

      // ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ã§ç†ç”±ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
      await expect(deleteButton).toHaveAttribute(
        'title',
        'å¯¾æˆ¦å±¥æ­´ã‹ã‚‰å‚ç…§ã•ã‚Œã¦ã„ã‚‹ãŸã‚å‰Šé™¤ã§ãã¾ã›ã‚“'
      );
    });

    test('å‚ç…§ã•ã‚Œã¦ã„ã‚‹ãƒ‡ãƒƒã‚­ã®å‰Šé™¤ã‚’è©¦ã¿ã‚‹ã¨ã‚¨ãƒ©ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã‚‹', async ({ page }) => {
      // æ³¨: APIãƒ¬ãƒ™ãƒ«ã§ã®ãƒ†ã‚¹ãƒˆï¼ˆå‰Šé™¤ãƒœã‚¿ãƒ³ãŒæœ‰åŠ¹ãªçŠ¶æ…‹ã§APIãŒã‚¨ãƒ©ãƒ¼ã‚’è¿”ã™ã‚±ãƒ¼ã‚¹ï¼‰
      // ã“ã®ãƒ†ã‚¹ãƒˆã¯ãƒ¢ãƒƒã‚¯ã‚„ãƒ†ã‚¹ãƒˆãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£ãŒå¿…è¦

      await navigateToMyDecks(page);

      // APIã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ãƒˆã§409ã‚¨ãƒ©ãƒ¼ã‚’è¿”ã™
      await page.route('**/api/my-decks/*', async (route) => {
        if (route.request().method() === 'DELETE') {
          await route.fulfill({
            status: 409,
            contentType: 'application/json',
            body: JSON.stringify({
              success: false,
              error: {
                code: 'DELETE_CONSTRAINT_ERROR',
                message: 'å¯¾æˆ¦å±¥æ­´ã‹ã‚‰å‚ç…§ã•ã‚Œã¦ã„ã‚‹ãŸã‚å‰Šé™¤ã§ãã¾ã›ã‚“',
                details: {
                  referencedBy: 'battle_logs',
                  count: 5,
                },
              },
            }),
          });
        } else {
          await route.continue();
        }
      });

      // ãƒ‡ãƒƒã‚­ã‚’è¿½åŠ 
      await addMyDeck(page, {
        className: 'ãƒ‰ãƒ©ã‚´ãƒ³',
        deckName: 'åˆ¶ç´„ãƒ†ã‚¹ãƒˆãƒ‡ãƒƒã‚­',
      });

      // å‰Šé™¤ã‚’è©¦ã¿ã‚‹
      const deckItem = page.locator(`[data-testid^="deck-item-"]`, {
        hasText: 'åˆ¶ç´„ãƒ†ã‚¹ãƒˆãƒ‡ãƒƒã‚­',
      });
      await deckItem.getByTestId('delete-button').click();
      await page.getByTestId('confirm-dialog-confirm').click();

      // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
      await expect(
        page.getByText('å¯¾æˆ¦å±¥æ­´ã‹ã‚‰å‚ç…§ã•ã‚Œã¦ã„ã‚‹ãŸã‚å‰Šé™¤ã§ãã¾ã›ã‚“')
      ).toBeVisible();
    });
  });

  test.describe('ç©ºçŠ¶æ…‹', () => {
    test('ãƒ‡ãƒƒã‚­ãŒ0ä»¶ã®å ´åˆã¯ç©ºãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹', async ({ page }) => {
      // ç©ºã®çŠ¶æ…‹ã§ãƒšãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹
      // æ³¨: ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ãŒå¿…è¦

      await navigateToMyDecks(page);

      // ç©ºãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
      await expectEmptyMessage(page);
      await expect(
        page.getByText('ä½¿ç”¨ãƒ‡ãƒƒã‚­ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“')
      ).toBeVisible();
    });
  });

  test.describe('ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹', () => {
    test('ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ä¸­ã¯ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¹ãƒ”ãƒŠãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã‚‹', async ({ page }) => {
      // APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’é…å»¶ã•ã›ã‚‹
      await page.route('**/api/my-decks', async (route) => {
        await new Promise((resolve) => setTimeout(resolve, 1000));
        await route.continue();
      });

      await page.goto('/my-decks');

      // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¹ãƒ”ãƒŠãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
      await expect(page.getByTestId('loading-spinner')).toBeVisible();

      // ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿å®Œäº†å¾Œã«ã‚¹ãƒ”ãƒŠãƒ¼ãŒæ¶ˆãˆã‚‹ã“ã¨ã‚’ç¢ºèª
      await expect(page.getByTestId('loading-spinner')).not.toBeVisible({
        timeout: 5000,
      });
    });
  });
});
```

### 4. ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£

```typescript
// e2e/fixtures/my-decks-fixtures.ts

import { test as base } from '@playwright/test';

interface MyDecksFixtures {
  cleanMyDecks: () => Promise<void>;
  seedMyDecks: (decks: Array<{ className: string; deckName: string; deckCode?: string }>) => Promise<void>;
}

export const test = base.extend<MyDecksFixtures>({
  cleanMyDecks: async ({ page }, use) => {
    const cleanMyDecks = async () => {
      // APIã‚’å‘¼ã³å‡ºã—ã¦ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
      await page.request.delete('/api/test/my-decks/clean');
    };
    await use(cleanMyDecks);
  },

  seedMyDecks: async ({ page }, use) => {
    const seedMyDecks = async (
      decks: Array<{ className: string; deckName: string; deckCode?: string }>
    ) => {
      // APIã‚’å‘¼ã³å‡ºã—ã¦ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ã‚·ãƒ¼ãƒ‰
      await page.request.post('/api/test/my-decks/seed', {
        data: { decks },
      });
    };
    await use(seedMyDecks);
  },
});

export { expect } from '@playwright/test';
```

---

## ãƒ†ã‚¹ãƒˆè¦ä»¶

### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ä¸€è¦§

| No | ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ | æœŸå¾…çµæœ | å„ªå…ˆåº¦ |
|----|-------------|----------|--------|
| 1 | ä½¿ç”¨ãƒ‡ãƒƒã‚­è¿½åŠ ãƒ•ãƒ­ãƒ¼ãŒå‹•ä½œã™ã‚‹ã“ã¨ | ãƒ‡ãƒƒã‚­è¿½åŠ æˆåŠŸ | é«˜ |
| 2 | ä½¿ç”¨ãƒ‡ãƒƒã‚­å‰Šé™¤ãƒ•ãƒ­ãƒ¼ãŒå‹•ä½œã™ã‚‹ã“ã¨ | ãƒ‡ãƒƒã‚­å‰Šé™¤æˆåŠŸ | é«˜ |
| 3 | å‰Šé™¤åˆ¶ç´„ã‚¨ãƒ©ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ | ã‚¨ãƒ©ãƒ¼è¡¨ç¤º | é«˜ |
| 4 | ç©ºå…¥åŠ›ã§ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ | ã‚¨ãƒ©ãƒ¼è¡¨ç¤º | é«˜ |
| 5 | ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ | ã‚¹ãƒ”ãƒŠãƒ¼è¡¨ç¤º | ä¸­ |
| 6 | ç©ºçŠ¶æ…‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ | ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º | ä¸­ |

---

## å®Œäº†æ¡ä»¶

- [ ] Playwrightè¨­å®šãŒå®Œäº†ã—ã¦ã„ã‚‹
- [ ] ä½¿ç”¨ãƒ‡ãƒƒã‚­è¿½åŠ E2Eãƒ†ã‚¹ãƒˆãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹
- [ ] ä½¿ç”¨ãƒ‡ãƒƒã‚­å‰Šé™¤E2Eãƒ†ã‚¹ãƒˆãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹
- [ ] å‰Šé™¤åˆ¶ç´„ã‚¨ãƒ©ãƒ¼E2Eãƒ†ã‚¹ãƒˆãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹
- [ ] ã™ã¹ã¦ã®E2Eãƒ†ã‚¹ãƒˆãŒæˆåŠŸã™ã‚‹
- [ ] ãƒ†ã‚¹ãƒˆãƒ¬ãƒãƒ¼ãƒˆãŒç”Ÿæˆã•ã‚Œã‚‹

---

## å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰

```bash
# E2Eãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
pnpm e2e

# ç‰¹å®šã®ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿å®Ÿè¡Œ
pnpm e2e e2e/my-decks.spec.ts

# UIãƒ¢ãƒ¼ãƒ‰ã§ãƒ†ã‚¹ãƒˆå®Ÿè¡Œï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰
pnpm e2e:ui

# ãƒ¬ãƒãƒ¼ãƒˆè¡¨ç¤º
pnpm e2e:report
```

---

## æ¤œè¨¼æ‰‹é †

1. `pnpm e2e` ã§å…¨E2Eãƒ†ã‚¹ãƒˆãŒæˆåŠŸã™ã‚‹ã“ã¨ã‚’ç¢ºèª
2. ãƒ†ã‚¹ãƒˆãƒ¬ãƒãƒ¼ãƒˆã§ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’ç¢ºèª
3. CIç’°å¢ƒã§ã‚‚ãƒ†ã‚¹ãƒˆãŒæˆåŠŸã™ã‚‹ã“ã¨ã‚’ç¢ºèª

---

## å‚è€ƒè³‡æ–™

- [Playwright Documentation](https://playwright.dev/docs/intro)
- [Playwright Best Practices](https://playwright.dev/docs/best-practices)
- [Testing Library Integration](https://playwright.dev/docs/test-assertions)
