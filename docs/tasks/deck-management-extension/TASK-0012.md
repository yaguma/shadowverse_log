# TASK-0012: DeckMasterDialogコンポーネント実装

**タスクID**: TASK-0012
**タスクタイプ**: TDD
**推定工数**: 2時間
**フェーズ**: Phase 2 - デッキ種別管理機能
**信頼性レベル**: 🔵 *interfaces.ts DeckMasterDialogPropsより*

## 関連文書
- [技術設計書](../../design/deck-management-extension/README.md)
- [アーキテクチャ設計](../../design/deck-management-extension/architecture.md)
- [インターフェース定義](../../design/deck-management-extension/interfaces.ts)

## タスク概要
デッキ種別の追加/編集ダイアログコンポーネントを実装する。className選択、deckName入力、バリデーションエラー表示を含む。

## 依存タスク
- **前提タスク**: [TASK-0011](TASK-0011.md) - DeckMasterItemコンポーネント
- **後続タスク**: [TASK-0013](TASK-0013.md) - 統合テスト

## 完了条件
- [ ] className選択式入力が機能すること
- [ ] deckName自由入力が機能すること
- [ ] 新規追加/編集モード切り替えが正しく動作すること
- [ ] 編集時classNameがdisabledになること
- [ ] バリデーションエラーが表示されること
- [ ] 全テストがパスすること

---
## 実装詳細

### ファイル構成
```
packages/web/src/
├── components/
│   └── deck-master/
│       ├── DeckMasterDialog.tsx      # ダイアログコンポーネント（新規）
│       └── DeckMasterDialog.test.tsx # テスト（新規）
```

### コンポーネント構造
```typescript
interface DeckMasterDialogProps {
  isOpen: boolean;
  mode: 'create' | 'edit';
  initialData?: DeckMasterWithUsage;
  onClose: () => void;
  onSubmit: (data: { className: string; deckName: string }) => Promise<void>;
  isSubmitting: boolean;
  error?: string;
}

const DeckMasterDialog: React.FC<DeckMasterDialogProps> = ({
  isOpen,
  mode,
  initialData,
  onClose,
  onSubmit,
  isSubmitting,
  error,
}) => {
  // 実装
};
```

### UI構成

#### 新規追加モード
```
┌─────────────────────────────────────────────────┐
│ デッキ種別の追加                                 │
├─────────────────────────────────────────────────┤
│                                                 │
│ クラス名 *                                      │
│ [▼ 選択してください                        ]    │
│                                                 │
│ デッキ名 *                                      │
│ [                                          ]    │
│                                                 │
│ [エラーメッセージ表示エリア]                     │
│                                                 │
├─────────────────────────────────────────────────┤
│                    [キャンセル] [登録]           │
└─────────────────────────────────────────────────┘
```

#### 編集モード
```
┌─────────────────────────────────────────────────┐
│ デッキ種別の編集                                 │
├─────────────────────────────────────────────────┤
│                                                 │
│ クラス名                                        │
│ [ウィッチ                      ] (disabled)     │
│                                                 │
│ デッキ名 *                                      │
│ [秘術ウィッチ                              ]    │
│                                                 │
│ [エラーメッセージ表示エリア]                     │
│                                                 │
├─────────────────────────────────────────────────┤
│                    [キャンセル] [更新]           │
└─────────────────────────────────────────────────┘
```

### クラス名選択肢
```typescript
const CLASS_OPTIONS = [
  { value: 'エルフ', label: 'エルフ' },
  { value: 'ロイヤル', label: 'ロイヤル' },
  { value: 'ウィッチ', label: 'ウィッチ' },
  { value: 'ドラゴン', label: 'ドラゴン' },
  { value: 'ナイトメア', label: 'ナイトメア' },
  { value: 'ビショップ', label: 'ビショップ' },
  { value: 'ネメシス', label: 'ネメシス' },
];
```

### バリデーションルール
- className: 必須（新規追加時のみ）
- deckName: 必須、1〜50文字

---
## 単体テスト要件

### テストファイル
`packages/web/src/components/deck-master/DeckMasterDialog.test.tsx`

### テストケース

#### 新規追加モード
1. **新規モードでタイトルが「デッキ種別の追加」**
   - 入力: mode: 'create'
   - 期待: "デッキ種別の追加"がDOMに存在

2. **新規モードでclassNameが選択可能**
   - 入力: mode: 'create'
   - 期待: classNameセレクトがdisabledでない

3. **className未選択で登録ボタン押下時にエラー**
   - 期待: バリデーションエラーが表示される

#### 編集モード
4. **編集モードでタイトルが「デッキ種別の編集」**
   - 入力: mode: 'edit'
   - 期待: "デッキ種別の編集"がDOMに存在

5. **編集モードでclassNameがdisabled**
   - 入力: mode: 'edit', initialData: {...}
   - 期待: classNameセレクトがdisabled

6. **編集モードで初期値が入力欄に表示**
   - 入力: initialData: { className: "ウィッチ", deckName: "秘術" }
   - 期待: 各フィールドに初期値が表示

#### バリデーション
7. **deckName空で登録ボタン押下時にエラー表示**
   - 入力: deckName: ""
   - 期待: "デッキ名を入力してください"がDOMに存在

8. **deckName51文字でエラー表示**
   - 入力: deckName: "a".repeat(51)
   - 期待: "デッキ名は50文字以内で入力してください"がDOMに存在

#### 送信
9. **登録成功でダイアログが閉じる**
   - 期待: onCloseが呼ばれる

10. **送信中は登録ボタンがdisabled**
    - 入力: isSubmitting: true
    - 期待: 登録ボタンがdisabled、ローディング表示

11. **APIエラー時にerrorが表示される**
    - 入力: error: "サーバーエラー"
    - 期待: "サーバーエラー"がDOMに存在

#### キャンセル
12. **キャンセルボタンでダイアログが閉じる**
    - 期待: onCloseが呼ばれる

---
## 実装手順

### Red Phase（失敗するテストを書く）
1. テストファイル `DeckMasterDialog.test.tsx` を作成
2. React Testing Libraryでテスト実装
3. テスト実行 → 失敗確認

### Green Phase（テストを通す最小実装）
1. DeckMasterDialogコンポーネント作成
2. フォーム状態管理実装
3. バリデーションロジック実装
4. 送信ハンドラ実装
5. テスト実行 → 成功確認

### Refactor Phase（リファクタリング）
1. フォームライブラリ検討（react-hook-form等）
2. バリデーションスキーマ共通化
3. アクセシビリティ対応
4. テスト実行 → 成功確認

---
## 信頼性レベルサマリー

| 項目 | レベル | 出典 |
|------|--------|------|
| コンポーネント構造 | 🔵 | interfaces.ts DeckMasterDialogProps |
| バリデーションルール | 🔵 | REQ-EXT-001〜007 |
| className変更不可 | 🔵 | REQ-EXT-007 |
| UI/UXフロー | 🔵 | architecture.md |
