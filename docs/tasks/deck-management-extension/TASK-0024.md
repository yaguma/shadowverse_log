# TASK-0024: ãƒ‡ãƒƒã‚­ç®¡ç†ç”»é¢E2Eãƒ†ã‚¹ãƒˆ

## ã‚¿ã‚¹ã‚¯æƒ…å ±

- **ã‚¿ã‚¹ã‚¯ID**: TASK-0024
- **ã‚¿ã‚¤ãƒ—**: TDD
- **æ¨å®šå·¥æ•°**: 2æ™‚é–“
- **ãƒ•ã‚§ãƒ¼ã‚º**: Phase 4 - ãƒ‡ãƒƒã‚­ç®¡ç†ç”»é¢çµ±åˆ
- **ä¿¡é ¼æ€§**: ğŸ”µ
- **ä¾å­˜ã‚¿ã‚¹ã‚¯**: TASK-0023
- **å¾Œç¶šã‚¿ã‚¹ã‚¯**: TASK-0025
- **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: [ ] æœªå®Œäº†

---

## æ¦‚è¦

ãƒ‡ãƒƒã‚­ç®¡ç†ç”»é¢ã®E2Eãƒ†ã‚¹ãƒˆã‚’ä½œæˆã™ã‚‹ã€‚ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ãƒ­ãƒ¼ã€ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆã€ãƒ‡ãƒƒã‚­ç¨®åˆ¥â†’ä½¿ç”¨ãƒ‡ãƒƒã‚­ã®é€£æºã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹ã€‚

---

## å®Ÿè£…å†…å®¹

### 1. E2Eãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ

`packages/frontend/e2e/deck-management.spec.ts`:

```typescript
import { test, expect } from '@playwright/test';

test.describe('ãƒ‡ãƒƒã‚­ç®¡ç†ç”»é¢', () => {
  test.beforeEach(async ({ page }) => {
    // ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ã‹ã‚‰ã‚¹ã‚¿ãƒ¼ãƒˆ
    await page.goto('/');
  });

  test.describe('ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³', () => {
    test('ãƒ˜ãƒƒãƒ€ãƒ¼ã‹ã‚‰ãƒ‡ãƒƒã‚­ç®¡ç†ç”»é¢ã«é·ç§»ã§ãã‚‹', async ({ page }) => {
      // ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯
      await page.click('nav >> text=ãƒ‡ãƒƒã‚­ç®¡ç†');

      // URLãŒæ­£ã—ã„ã“ã¨ã‚’ç¢ºèª
      await expect(page).toHaveURL('/decks');

      // ãƒšãƒ¼ã‚¸ã‚¿ã‚¤ãƒˆãƒ«ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
      await expect(page.locator('h1')).toHaveText('ãƒ‡ãƒƒã‚­ç®¡ç†');
    });

    test('ãƒ‡ãƒƒã‚­ç®¡ç†ãƒªãƒ³ã‚¯ãŒã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã«ãªã‚‹', async ({ page }) => {
      await page.goto('/decks');

      // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¹ã‚¿ã‚¤ãƒ«ãŒé©ç”¨ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
      const navLink = page.locator('nav >> text=ãƒ‡ãƒƒã‚­ç®¡ç†');
      await expect(navLink).toHaveClass(/text-blue-600/);
    });
  });

  test.describe('ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ', () => {
    test.beforeEach(async ({ page }) => {
      await page.goto('/decks');
    });

    test('åˆæœŸè¡¨ç¤ºã§ãƒ‡ãƒƒã‚­ç¨®åˆ¥ã‚¿ãƒ–ãŒã‚¢ã‚¯ãƒ†ã‚£ãƒ–', async ({ page }) => {
      const deckMasterTab = page.getByRole('button', { name: 'ãƒ‡ãƒƒã‚­ç¨®åˆ¥' });
      await expect(deckMasterTab).toHaveClass(/border-blue-500/);

      // ãƒ‡ãƒƒã‚­ç¨®åˆ¥ä¸€è¦§ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
      await expect(page.locator('[data-testid="deck-master-list"]')).toBeVisible();
    });

    test('ä½¿ç”¨ãƒ‡ãƒƒã‚­ã‚¿ãƒ–ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ãƒã‚¤ãƒ‡ãƒƒã‚­ä¸€è¦§ãŒè¡¨ç¤ºã•ã‚Œã‚‹', async ({ page }) => {
      // ä½¿ç”¨ãƒ‡ãƒƒã‚­ã‚¿ãƒ–ã‚’ã‚¯ãƒªãƒƒã‚¯
      await page.click('button:has-text("ä½¿ç”¨ãƒ‡ãƒƒã‚­")');

      // ãƒã‚¤ãƒ‡ãƒƒã‚­ä¸€è¦§ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
      await expect(page.locator('[data-testid="my-deck-list"]')).toBeVisible();

      // ãƒ‡ãƒƒã‚­ç¨®åˆ¥ä¸€è¦§ãŒéè¡¨ç¤ºã«ãªã‚‹ã“ã¨ã‚’ç¢ºèª
      await expect(page.locator('[data-testid="deck-master-list"]')).not.toBeVisible();
    });

    test('ãƒ‡ãƒƒã‚­ç¨®åˆ¥ã‚¿ãƒ–ã«æˆ»ã‚‹ã¨ãƒ‡ãƒƒã‚­ç¨®åˆ¥ä¸€è¦§ãŒè¡¨ç¤ºã•ã‚Œã‚‹', async ({ page }) => {
      // ä½¿ç”¨ãƒ‡ãƒƒã‚­ã‚¿ãƒ–ã«åˆ‡ã‚Šæ›¿ãˆ
      await page.click('button:has-text("ä½¿ç”¨ãƒ‡ãƒƒã‚­")');

      // ãƒ‡ãƒƒã‚­ç¨®åˆ¥ã‚¿ãƒ–ã«æˆ»ã‚‹
      await page.click('button:has-text("ãƒ‡ãƒƒã‚­ç¨®åˆ¥")');

      // ãƒ‡ãƒƒã‚­ç¨®åˆ¥ä¸€è¦§ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
      await expect(page.locator('[data-testid="deck-master-list"]')).toBeVisible();
    });
  });

  test.describe('ãƒ‡ãƒƒã‚­ç¨®åˆ¥â†’ä½¿ç”¨ãƒ‡ãƒƒã‚­é€£æº', () => {
    test.beforeEach(async ({ page }) => {
      await page.goto('/decks');
    });

    test('ãƒ‡ãƒƒã‚­ç¨®åˆ¥ã‚’è¿½åŠ ã—ãŸå¾Œã€ä½¿ç”¨ãƒ‡ãƒƒã‚­ã‚¿ãƒ–ã§ãã®ãƒ‡ãƒƒã‚­ç¨®åˆ¥ã‚’é¸æŠã§ãã‚‹', async ({ page }) => {
      // ãƒ‡ãƒƒã‚­ç¨®åˆ¥è¿½åŠ ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’é–‹ã
      await page.click('button:has-text("ãƒ‡ãƒƒã‚­ç¨®åˆ¥ã‚’è¿½åŠ ")');

      // ãƒ•ã‚©ãƒ¼ãƒ ã«å…¥åŠ›
      await page.fill('input[name="className"]', 'ãƒ†ã‚¹ãƒˆã‚¯ãƒ©ã‚¹');
      await page.fill('input[name="deckName"]', 'ãƒ†ã‚¹ãƒˆãƒ‡ãƒƒã‚­');

      // ä¿å­˜
      await page.click('button:has-text("ä¿å­˜")');

      // ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ãŒé–‰ã˜ã‚‹ã®ã‚’å¾…ã¤
      await expect(page.locator('[role="dialog"]')).not.toBeVisible();

      // ä½¿ç”¨ãƒ‡ãƒƒã‚­ã‚¿ãƒ–ã«åˆ‡ã‚Šæ›¿ãˆ
      await page.click('button:has-text("ä½¿ç”¨ãƒ‡ãƒƒã‚­")');

      // ä½¿ç”¨ãƒ‡ãƒƒã‚­è¿½åŠ ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’é–‹ã
      await page.click('button:has-text("ä½¿ç”¨ãƒ‡ãƒƒã‚­ã‚’è¿½åŠ ")');

      // ãƒ‡ãƒƒã‚­ç¨®åˆ¥é¸æŠã§è¿½åŠ ã—ãŸãƒ‡ãƒƒã‚­ãŒé¸æŠè‚¢ã«å«ã¾ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
      await page.click('select[name="deckId"]');
      await expect(page.locator('option:has-text("ãƒ†ã‚¹ãƒˆãƒ‡ãƒƒã‚­")')).toBeVisible();
    });

    test('ä½¿ç”¨ãƒ‡ãƒƒã‚­ã‚’è¿½åŠ ã—ã¦ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«è¨­å®šã§ãã‚‹', async ({ page }) => {
      // ä½¿ç”¨ãƒ‡ãƒƒã‚­ã‚¿ãƒ–ã«åˆ‡ã‚Šæ›¿ãˆ
      await page.click('button:has-text("ä½¿ç”¨ãƒ‡ãƒƒã‚­")');

      // æ—¢å­˜ã®ãƒ‡ãƒƒã‚­ç¨®åˆ¥ãŒã‚ã‚‹å‰æã§ä½¿ç”¨ãƒ‡ãƒƒã‚­ã‚’è¿½åŠ 
      await page.click('button:has-text("ä½¿ç”¨ãƒ‡ãƒƒã‚­ã‚’è¿½åŠ ")');

      // ãƒ•ã‚©ãƒ¼ãƒ ã«å…¥åŠ›
      await page.selectOption('select[name="deckId"]', { index: 1 }); // æœ€åˆã®ãƒ‡ãƒƒã‚­ç¨®åˆ¥ã‚’é¸æŠ
      await page.fill('input[name="deckCode"]', 'test-deck-code-123');
      await page.fill('input[name="deckName"]', 'ãƒã‚¤ãƒ†ã‚¹ãƒˆãƒ‡ãƒƒã‚­');

      // ä¿å­˜
      await page.click('button:has-text("ä¿å­˜")');

      // è¿½åŠ ã•ã‚ŒãŸãƒ‡ãƒƒã‚­ãŒä¸€è¦§ã«è¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
      await expect(page.locator('text=ãƒã‚¤ãƒ†ã‚¹ãƒˆãƒ‡ãƒƒã‚­')).toBeVisible();
    });
  });
});
```

### 2. ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£è¿½åŠ 

`packages/frontend/e2e/utils/test-helpers.ts`:

```typescript
import { Page } from '@playwright/test';

/**
 * ãƒ‡ãƒƒã‚­ç¨®åˆ¥ã‚’è¿½åŠ ã™ã‚‹ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
 */
export async function addDeckMaster(
  page: Page,
  className: string,
  deckName: string
): Promise<void> {
  await page.click('button:has-text("ãƒ‡ãƒƒã‚­ç¨®åˆ¥ã‚’è¿½åŠ ")');
  await page.fill('input[name="className"]', className);
  await page.fill('input[name="deckName"]', deckName);
  await page.click('button:has-text("ä¿å­˜")');
  await page.waitForSelector('[role="dialog"]', { state: 'hidden' });
}

/**
 * ä½¿ç”¨ãƒ‡ãƒƒã‚­ã‚’è¿½åŠ ã™ã‚‹ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
 */
export async function addMyDeck(
  page: Page,
  deckName: string,
  deckCode: string
): Promise<void> {
  await page.click('button:has-text("ä½¿ç”¨ãƒ‡ãƒƒã‚­ã‚’è¿½åŠ ")');
  await page.selectOption('select[name="deckId"]', { index: 1 });
  await page.fill('input[name="deckCode"]', deckCode);
  await page.fill('input[name="deckName"]', deckName);
  await page.click('button:has-text("ä¿å­˜")');
  await page.waitForSelector('[role="dialog"]', { state: 'hidden' });
}
```

### 3. Playwrightè¨­å®šç¢ºèª

`packages/frontend/playwright.config.ts` ã®è¨­å®šã‚’ç¢ºèª:

```typescript
import { defineConfig, devices } from '@playwright/test';

export default defineConfig({
  testDir: './e2e',
  fullyParallel: true,
  forbidOnly: !!process.env.CI,
  retries: process.env.CI ? 2 : 0,
  workers: process.env.CI ? 1 : undefined,
  reporter: 'html',
  use: {
    baseURL: 'http://localhost:5173',
    trace: 'on-first-retry',
  },
  projects: [
    {
      name: 'chromium',
      use: { ...devices['Desktop Chrome'] },
    },
  ],
  webServer: {
    command: 'pnpm dev',
    url: 'http://localhost:5173',
    reuseExistingServer: !process.env.CI,
  },
});
```

---

## ãƒ†ã‚¹ãƒˆè¦ä»¶

### E2Eãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ä¸€è¦§

| ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ | èª¬æ˜ | æœŸå¾…çµæœ |
|---|---|---|
| ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³é·ç§» | ãƒ˜ãƒƒãƒ€ãƒ¼ã‹ã‚‰ãƒ‡ãƒƒã‚­ç®¡ç†ç”»é¢ã¸é·ç§» | `/decks`ã«é·ç§»ã—ã€ãƒšãƒ¼ã‚¸ã‚¿ã‚¤ãƒˆãƒ«ãŒè¡¨ç¤ºã•ã‚Œã‚‹ |
| ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ | ãƒ‡ãƒƒã‚­ç®¡ç†ãƒªãƒ³ã‚¯ã®ã‚¹ã‚¿ã‚¤ãƒ« | ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¹ã‚¿ã‚¤ãƒ«ãŒé©ç”¨ã•ã‚Œã‚‹ |
| åˆæœŸã‚¿ãƒ–è¡¨ç¤º | åˆæœŸè¡¨ç¤ºã®ã‚¿ãƒ–çŠ¶æ…‹ | ãƒ‡ãƒƒã‚­ç¨®åˆ¥ã‚¿ãƒ–ãŒã‚¢ã‚¯ãƒ†ã‚£ãƒ– |
| ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ | ä½¿ç”¨ãƒ‡ãƒƒã‚­ã‚¿ãƒ–ã¸ã®åˆ‡ã‚Šæ›¿ãˆ | ãƒã‚¤ãƒ‡ãƒƒã‚­ä¸€è¦§ãŒè¡¨ç¤ºã•ã‚Œã‚‹ |
| ã‚¿ãƒ–æˆ»ã‚Š | ãƒ‡ãƒƒã‚­ç¨®åˆ¥ã‚¿ãƒ–ã¸ã®æˆ»ã‚Š | ãƒ‡ãƒƒã‚­ç¨®åˆ¥ä¸€è¦§ãŒè¡¨ç¤ºã•ã‚Œã‚‹ |
| ãƒ‡ãƒƒã‚­é€£æº | ãƒ‡ãƒƒã‚­ç¨®åˆ¥è¿½åŠ â†’ä½¿ç”¨ãƒ‡ãƒƒã‚­ã§é¸æŠå¯èƒ½ | æ–°è¦ãƒ‡ãƒƒã‚­ç¨®åˆ¥ãŒé¸æŠè‚¢ã«è¡¨ç¤ºã•ã‚Œã‚‹ |

---

## å®Œäº†æ¡ä»¶

- [ ] E2Eãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ãŒä½œæˆã•ã‚Œã¦ã„ã‚‹
- [ ] ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ãƒ­ãƒ¼ã®ãƒ†ã‚¹ãƒˆãŒæˆåŠŸã™ã‚‹
- [ ] ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆã®ãƒ†ã‚¹ãƒˆãŒæˆåŠŸã™ã‚‹
- [ ] ãƒ‡ãƒƒã‚­ç¨®åˆ¥â†’ä½¿ç”¨ãƒ‡ãƒƒã‚­é€£æºã®ãƒ†ã‚¹ãƒˆãŒæˆåŠŸã™ã‚‹
- [ ] ã™ã¹ã¦ã®E2Eãƒ†ã‚¹ãƒˆãŒæˆåŠŸã™ã‚‹

---

## å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰

```bash
# E2Eãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
pnpm exec playwright test e2e/deck-management.spec.ts

# UIãƒ¢ãƒ¼ãƒ‰ã§å®Ÿè¡Œï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰
pnpm exec playwright test e2e/deck-management.spec.ts --ui

# ãƒ˜ãƒƒãƒ‰ãƒ•ãƒ«ãƒ¢ãƒ¼ãƒ‰ã§å®Ÿè¡Œ
pnpm exec playwright test e2e/deck-management.spec.ts --headed
```

---

## æ¤œè¨¼æ‰‹é †

1. `packages/frontend/e2e/deck-management.spec.ts` ãŒå­˜åœ¨ã™ã‚‹ã‹ç¢ºèª
2. `pnpm exec playwright test e2e/deck-management.spec.ts` ã§ãƒ†ã‚¹ãƒˆãŒæˆåŠŸã™ã‚‹ã‹ç¢ºèª
3. ãƒ†ã‚¹ãƒˆãƒ¬ãƒãƒ¼ãƒˆã‚’ç¢ºèªï¼ˆ`playwright-report/index.html`ï¼‰

---

## é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [TASK-0022: DeckManagePageã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆå®Ÿè£…](./TASK-0022.md)
- [TASK-0023: ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³æ‹¡å¼µ](./TASK-0023.md)
