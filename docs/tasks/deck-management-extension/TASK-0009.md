# TASK-0009: DeckStoreæ‹¡å¼µï¼ˆDeckMaster CRUDï¼‰

**ã‚¿ã‚¹ã‚¯ID**: TASK-0009
**ã‚¿ã‚¹ã‚¯ã‚¿ã‚¤ãƒ—**: TDD
**æ¨å®šå·¥æ•°**: 2æ™‚é–“
**ãƒ•ã‚§ãƒ¼ã‚º**: Phase 2 - ãƒ‡ãƒƒã‚­ç¨®åˆ¥ç®¡ç†æ©Ÿèƒ½
**ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«**: ğŸ”µ *architecture.md 5.1ã‚ˆã‚Š*

## é–¢é€£æ–‡æ›¸
- [æŠ€è¡“è¨­è¨ˆæ›¸](../../design/deck-management-extension/README.md)
- [ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ](../../design/deck-management-extension/architecture.md)
- [ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼å›³](../../design/deck-management-extension/dataflow.md)

## ã‚¿ã‚¹ã‚¯æ¦‚è¦
ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®DeckStoreã‚’æ‹¡å¼µã—ã€DeckMasterã®CRUDæ“ä½œã«å¯¾å¿œã—ãŸçŠ¶æ…‹ç®¡ç†ã‚’å®Ÿè£…ã™ã‚‹ã€‚APIå‘¼ã³å‡ºã—ã¨ãƒ­ãƒ¼ã‚«ãƒ«çŠ¶æ…‹ã®åŒæœŸã‚’è¡Œã†ã€‚

## ä¾å­˜ã‚¿ã‚¹ã‚¯
- **å‰æã‚¿ã‚¹ã‚¯**: [TASK-0005](TASK-0005.md), [TASK-0006](TASK-0006.md), [TASK-0007](TASK-0007.md), [TASK-0008](TASK-0008.md) - DeckMaster APIå„ç¨®
- **å¾Œç¶šã‚¿ã‚¹ã‚¯**: [TASK-0010](TASK-0010.md) - DeckMasterListã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

## å®Œäº†æ¡ä»¶
- [ ] fetchDeckMastersWithUsageé–¢æ•°ãŒå‹•ä½œã™ã‚‹ã“ã¨
- [ ] addDeckMasteré–¢æ•°ãŒå‹•ä½œã™ã‚‹ã“ã¨
- [ ] updateDeckMasteré–¢æ•°ãŒå‹•ä½œã™ã‚‹ã“ã¨
- [ ] deleteDeckMasteré–¢æ•°ãŒå‹•ä½œã™ã‚‹ã“ã¨
- [ ] isLoading, errorã‚¹ãƒ†ãƒ¼ãƒˆç®¡ç†ãŒæ­£ã—ãå‹•ä½œã™ã‚‹ã“ã¨
- [ ] å…¨ãƒ†ã‚¹ãƒˆãŒãƒ‘ã‚¹ã™ã‚‹ã“ã¨

---
## å®Ÿè£…è©³ç´°

### ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ
```
packages/web/src/
â”œâ”€â”€ stores/
â”‚   â””â”€â”€ deck-store.ts    # Zustand Storeï¼ˆæ‹¡å¼µï¼‰
â”œâ”€â”€ types/
â”‚   â””â”€â”€ deck.ts          # å‹å®šç¾©ï¼ˆæ‹¡å¼µï¼‰
â””â”€â”€ hooks/
    â””â”€â”€ useDeckMaster.ts # ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ï¼ˆæ–°è¦ï¼‰
```

### Storeå‹å®šç¾©
```typescript
interface DeckMasterWithUsage {
  id: string;
  className: string;
  deckName: string;
  sortOrder: number;
  createdAt: string;
  updatedAt: string;
  usageCount?: number;
  lastUsedDate?: string | null;
}

interface DeckStoreState {
  // æ—¢å­˜ã®ã‚¹ãƒ†ãƒ¼ãƒˆ
  // ...

  // DeckMasteré–¢é€£
  deckMasters: DeckMasterWithUsage[];
  isLoadingDeckMasters: boolean;
  deckMasterError: string | null;

  // Actions
  fetchDeckMastersWithUsage: (includeUsage?: boolean) => Promise<void>;
  addDeckMaster: (data: { className: string; deckName: string }) => Promise<DeckMasterWithUsage>;
  updateDeckMaster: (id: string, data: { deckName: string }) => Promise<DeckMasterWithUsage>;
  deleteDeckMaster: (id: string) => Promise<void>;
  clearDeckMasterError: () => void;
}
```

### APIå‘¼ã³å‡ºã—ãƒ•ãƒ­ãƒ¼

#### fetchDeckMastersWithUsage
1. isLoadingDeckMasters = true
2. APIå‘¼ã³å‡ºã—: GET /api/deck-master?includeUsage={value}
3. æˆåŠŸ: deckMasters = response.data
4. å¤±æ•—: deckMasterError = error.message
5. isLoadingDeckMasters = false

#### addDeckMaster
1. APIå‘¼ã³å‡ºã—: POST /api/deck-master
2. æˆåŠŸ: deckMasters = [...deckMasters, response.data]
3. å¤±æ•—: throw errorï¼ˆå‘¼ã³å‡ºã—å…ƒã§ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ï¼‰

#### updateDeckMaster
1. APIå‘¼ã³å‡ºã—: PUT /api/deck-master/:id
2. æˆåŠŸ: deckMastersé…åˆ—å†…ã®è©²å½“ã‚¢ã‚¤ãƒ†ãƒ ã‚’æ›´æ–°
3. å¤±æ•—: throw error

#### deleteDeckMaster
1. APIå‘¼ã³å‡ºã—: DELETE /api/deck-master/:id
2. æˆåŠŸ: deckMasters = deckMasters.filter(d => d.id !== id)
3. å¤±æ•—: throw error

---
## å˜ä½“ãƒ†ã‚¹ãƒˆè¦ä»¶

### ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«
`packages/web/src/__tests__/deck-store.test.ts`

### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹

#### fetchDeckMastersWithUsage
1. **æ­£å¸¸å–å¾—ã§deckMastersé…åˆ—ã«è¨­å®š**
   - æœŸå¾…: deckMastersã«å–å¾—ãƒ‡ãƒ¼ã‚¿ãŒè¨­å®šã•ã‚Œã‚‹

2. **ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ã®é·ç§»**
   - æœŸå¾…: true â†’ false ã¨é·ç§»ã™ã‚‹

3. **ã‚¨ãƒ©ãƒ¼æ™‚ã«deckMasterErrorãŒè¨­å®š**
   - æœŸå¾…: ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¨­å®šã•ã‚Œã‚‹

#### addDeckMaster
4. **è¿½åŠ å¾Œã«deckMastersé…åˆ—ã«è¿½åŠ **
   - æœŸå¾…: æ–°è¦ãƒ‡ãƒ¼ã‚¿ãŒdeckMastersã«è¿½åŠ ã•ã‚Œã‚‹

5. **è¿½åŠ ã‚¨ãƒ©ãƒ¼æ™‚ã«throw**
   - æœŸå¾…: PromiseãŒrejectã•ã‚Œã‚‹

#### updateDeckMaster
6. **æ›´æ–°å¾Œã«deckMastersé…åˆ—ãŒæ›´æ–°**
   - æœŸå¾…: è©²å½“ãƒ‡ãƒ¼ã‚¿ã®deckNameãŒæ›´æ–°ã•ã‚Œã‚‹

7. **æ›´æ–°ã‚¨ãƒ©ãƒ¼æ™‚ã«throw**
   - æœŸå¾…: PromiseãŒrejectã•ã‚Œã‚‹

#### deleteDeckMaster
8. **å‰Šé™¤å¾Œã«deckMastersé…åˆ—ã‹ã‚‰å‰Šé™¤**
   - æœŸå¾…: è©²å½“ãƒ‡ãƒ¼ã‚¿ãŒdeckMastersã‹ã‚‰å‰Šé™¤ã•ã‚Œã‚‹

9. **å‰Šé™¤ã‚¨ãƒ©ãƒ¼æ™‚ã«throw**
   - æœŸå¾…: PromiseãŒrejectã•ã‚Œã‚‹

#### clearDeckMasterError
10. **ã‚¨ãƒ©ãƒ¼ã‚¯ãƒªã‚¢**
    - æœŸå¾…: deckMasterErrorãŒnullã«ãªã‚‹

---
## å®Ÿè£…æ‰‹é †

### Red Phaseï¼ˆå¤±æ•—ã™ã‚‹ãƒ†ã‚¹ãƒˆã‚’æ›¸ãï¼‰
1. ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ« `deck-store.test.ts` ã‚’ä½œæˆ
2. ãƒ¢ãƒƒã‚¯APIã‚’è¨­å®š
3. ä¸Šè¨˜ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã‚’å®Ÿè£…
4. ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ â†’ å¤±æ•—ç¢ºèª

### Green Phaseï¼ˆãƒ†ã‚¹ãƒˆã‚’é€šã™æœ€å°å®Ÿè£…ï¼‰
1. DeckMasterWithUsageå‹ã‚’è¿½åŠ 
2. Storeã«ã‚¹ãƒ†ãƒ¼ãƒˆè¿½åŠ 
3. å„ã‚¢ã‚¯ã‚·ãƒ§ãƒ³é–¢æ•°ã‚’å®Ÿè£…
4. ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ â†’ æˆåŠŸç¢ºèª

### Refactor Phaseï¼ˆãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ï¼‰
1. APIå‘¼ã³å‡ºã—ã®å…±é€šåŒ–
2. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®çµ±ä¸€
3. æ¥½è¦³çš„æ›´æ–°ã®æ¤œè¨
4. ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ â†’ æˆåŠŸç¢ºèª

---
## ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«ã‚µãƒãƒªãƒ¼

| é …ç›® | ãƒ¬ãƒ™ãƒ« | å‡ºå…¸ |
|------|--------|------|
| Storeæ§‹é€  | ğŸ”µ | architecture.md 5.1 |
| APIé€£æºãƒ•ãƒ­ãƒ¼ | ğŸ”µ | dataflow.md |
| ã‚¹ãƒ†ãƒ¼ãƒˆç®¡ç† | ğŸ”µ | architecture.md |
| å‹å®šç¾© | ğŸ”µ | interfaces.ts |
