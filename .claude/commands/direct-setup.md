---
description: DIRECTタスクの設定作業を実行します。設計文書に基づいて環境構築、設定ファイル作成、依存関係のインストールなどを行います。
allowed-tools: Read, Glob, Grep, Task, Write, Edit, TodoWrite
argument-hint: [要件名] [TASK-ID]
---

# direct-setup

## 目的

DIRECTタスクの設定作業を実行します。設計文書に基づいて環境構築、設定ファイル作成、依存関係のインストールなどを行います。

## 前提条件

- タスクIDが提供されている
- 関連する設計文書が存在する
- 必要な権限と環境が準備されている

## 実行内容

1. **追加ルールの読み込み**
   - `docs/rule` ディレクトリが存在する場合は読み込み
   - `docs/rule/direct` ディレクトリが存在する場合は読み込み  
   - `docs/rule/direct/setup` ディレクトリが存在する場合は読み込み
   - 各ディレクトリ内のすべてのファイルを読み込み、追加ルールとして適用

2. **技術スタック定義の読み込み**
   - `docs/tech-stack.md` が存在する場合は読み込み
   - 存在しない場合は `CLAUDE.md` から技術スタックセクションを読み込み  
   - どちらも存在しない場合は `.claude/commands/tech-stack.md` のデフォルト定義を使用

3. **設計文書の確認**
   - 読み込んだ技術スタック定義に基づいて関連ファイルを特定
   - @agent-symbol-searcher で関連設計文書や設定パターンを検索し、見つかったファイルをReadツールで読み込み
   - `docs/design/{要件名}/architecture.md` をReadツールで読み込み
   - `docs/design/{要件名}/database-schema.sql` をReadツールで読み込み
   - その他関連する設計文書をReadツールで読み込み

3. **設定作業の実行**
   - @agent-symbol-searcher で既存の設定ファイルや環境変数を検索し、見つかったファイルをReadツールで読み込み
   - 環境変数の設定
   - 設定ファイルの作成・更新
   - 依存関係のインストール
   - データベースの初期化
   - サービスの起動設定
   - 権限の設定

4. **作業記録の作成**
   - 実行したコマンドの記録
   - 変更した設定の記録
   - 遭遇した問題と解決方法の記録

## 出力先

作業記録は `docs/implements/{要件名}/{TASK-ID}/` ディレクトリに以下のファイルとして作成されます：
- `setup-report.md`: 設定作業実行記録

## README.mdへの記録

開発環境の構築や運用に関する重要な情報は、**必ずREADME.mdにも記録**してください：

### 記録すべき内容
- 新しい環境変数の設定方法
- 追加した依存関係とそのインストール方法
- データベースの初期化手順
- 新しいサービスの起動方法
- 設定ファイルの場所と説明
- トラブルシューティング情報（エラーと解決方法）

### 記録方法
1. 既存のセクションに追記する場合は、適切な箇所を見つけて追記
2. 新しいセクションが必要な場合は、適切な位置に新規セクションを作成
3. コマンド例は必ずコードブロックで記載
4. 重要な注意事項は明確に記載

### 記録例

#### セットアップセクションへの追加
```markdown
### 6. {新しいサービス名}のセットアップ
\`\`\`bash
cd {ディレクトリ}
{インストールコマンド}
{起動コマンド}
\`\`\`
```

#### 開発コマンドセクションへの追加
```markdown
### {サービス名}
\`\`\`bash
# {コマンドの説明}
{コマンド}
\`\`\`
```

#### トラブルシューティングセクションへの追加
```markdown
### {問題の概要}

\`\`\`bash
# 問題の確認方法
{確認コマンド}

# 解決方法
{解決コマンド}
\`\`\`
```

## 出力フォーマット例

<setup_report_format>
```markdown
# {TASK-ID} 設定作業実行

## 作業概要

- **タスクID**: {TASK-ID}
- **作業内容**: {設定作業の概要}
- **実行日時**: {実行日時}
- **実行者**: {実行者}

## 設計文書参照

- **参照文書**: {参照した設計文書のリスト}
- **関連要件**: {REQ-XXX, REQ-YYY}

## 実行した作業

### 1. 環境変数の設定

```bash
# 実行したコマンド
export NODE_ENV=development
export DATABASE_URL=postgresql://localhost:5432/mydb
```

**設定内容**:

- NODE_ENV: 開発環境に設定
- DATABASE_URL: PostgreSQLデータベースのURL

### 2. 設定ファイルの作成

**作成ファイル**: `config/database.json`

```json
{
  "development": {
    "host": "localhost",
    "port": 5432,
    "database": "mydb"
  }
}
```

### 3. 依存関係のインストール

```bash
# 実行したコマンド
npm install express pg
```

**インストール内容**:

- express: Webフレームワーク
- pg: PostgreSQLクライアント

### 4. データベースの初期化

```bash
# 実行したコマンド
createdb mydb
psql -d mydb -f database-schema.sql
```

**実行内容**:

- データベース作成
- スキーマの適用

## 作業結果

- [x] 環境変数の設定完了
- [x] 設定ファイルの作成完了
- [x] 依存関係のインストール完了
- [x] データベースの初期化完了
- [x] サービスの起動設定完了

## 遭遇した問題と解決方法

### 問題1: {問題の概要}

- **発生状況**: {問題が発生した状況}
- **エラーメッセージ**: {エラーメッセージ}
- **解決方法**: {解決方法}

## 次のステップ

- `/direct-verify` を実行して設定を確認
- 必要に応じて設定の調整を実施
```
</setup_report_format>

## 実行後の確認
- `docs/implements/{要件名}/{TASK-ID}/setup-report.md` ファイルが作成されていることを確認
- 設定が正しく適用されていることを確認
- 次のステップ（direct-verify）の準備が整っていることを確認

## ディレクトリ作成

実行前に必要なディレクトリを作成してください：
```bash
mkdir -p docs/implements/{要件名}/{TASK-ID}
```
