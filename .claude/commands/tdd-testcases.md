---
description: TDD開発のためのテストケース洗い出しを行います。整理された要件に基づいて包括的なテストケースを特定します。
allowed-tools: Read, Glob, Grep, Task, Write, TodoWrite, Edit
argument-hint: [要件名] [TASK-ID]
---
TDD開発のテストケース洗い出しを実施し、要件定義書を参照しながら網羅的なテストケースを作成します。信頼性レベルを示しながらテストケースを定義します。

# context

出力ディレクトリ="./docs/implements"
機能名={{feature_name}}
タスクID={{task_id}}
要件名={{requirement_name}}
信頼性評価=[]
要件定義ファイル=./docs/implements/{要件名}/{{task_id}}/{feature_name}-requirements.md
既存テストケースファイル=./docs/implements/{要件名}/{{task_id}}/{feature_name}-testcases.md
タスクファイル1=./docs/tasks/{要件名}/{{task_id}}.md
タスクファイル2=./docs/tasks/{要件名}-phase*.md
タスクoverviewファイル1=./docs/tasks/{要件名}/overview.md
タスクoverviewファイル2=./docs/tasks/{要件名}-overview.md

# step

- $ARGUMENTS がない場合、「引数に要件名とTASK-IDを指定してください（例: ユーザー認証機能 TASK-0001）」と言って終了する
- $ARGUMENTS の内容と context の内容をまとめてユーザに宣言する
- step2 を実行する

## step2

- 開発コンテキストの準備を実行する：
  **既存の実装ドキュメントの確認**
  - `./docs/implements/{要件名}/{{task_id}}/` ディレクトリ内の全てのMDファイルを確認
  - 特に以下のファイルを優先的に読み込み：
    - `note.md` - タスクノート（技術スタック、開発ルール、関連実装）
    - `{feature_name}-requirements.md` - 既存の要件定義
    - `{feature_name}-testcases.md` - 既存のテストケース
    - `{feature_name}-memo.md` - 開発履歴メモ
    - その他の関連MDファイル
  - これらのファイルから既存の実装状況、設計判断、注意事項を把握

  **タスクノートの読み込み**
  - `./docs/implements/{要件名}/{{task_id}}/note.md` が存在しない場合:
    - @task で `/tdd-tasknote {要件名} {{task_id}}` コマンドを実行してノートを生成
    - 生成されたノートファイルを読み込み
  - ノートには技術スタック、開発ルール、関連実装、設計文書、注意事項が含まれる

  **追加ルールの読み込み**
  - `./docs/rule` ディレクトリが存在する場合は読み込み
  - `./docs/rule/tdd` ディレクトリが存在する場合は読み込み
  - `./docs/rule/tdd/testcases` ディレクトリが存在する場合は読み込み
  - 各ディレクトリ内のすべてのファイルを読み込み、追加ルールとして適用

  **@agent-symbol-searcher でテスト関連情報を検索し、見つかったファイルを読み込み**
  - 既存のテストパターンやテストケースを検索し、該当テストファイルをReadツールで読み込み
  - 類似機能のテスト方法やモック戦略を特定し、関連ファイルをReadツールで読み込み
  - テストフレームワークの使用方法を確認し、設定ファイルをReadツールで読み込み

  **関連ファイルを直接読み込み**
  - `./docs/implements/{要件名}/{{task_id}}/{feature_name}-memo.md` - 既存の開発履歴を確認
  - `./docs/implements/{要件名}/{{task_id}}/{feature_name}-requirements.md` - 要件定義を確認
  - `./docs/implements/{要件名}/{{task_id}}/{feature_name}-testcases.md` - 既存のテストケースを確認
  - 関連する設計文書やタスクファイルも必要に応じて読み込み

- 読み込み完了後、step3 を実行する

## step3

- <testcases_template> の内容を context の情報で埋めて、テストケースを直接作成する
  - 読み込んだコンテキスト情報（タスクノート、要件定義、追加ルール等）を活用
  - 信頼性レベル（🔵🟡🔴）を各テストケースに記載
  - Write ツールを使用して出力ファイルに保存（既存ファイルがある場合は追記）

- 作成したテストケースの内容について、品質判定基準に基づいて以下を評価：
  - テストケース分類: 正常系・異常系・境界値が網羅されている
  - 期待値定義: 各テストケースの期待値が明確
  - 技術選択: プログラミング言語・テストフレームワークが確定
  - 実装可能性: 現在の技術スタックで実現可能
  - 信頼性レベル（🔵🟡🔴の分布）

- 品質判定結果をユーザーに表示する
- step4 を実行する

## step4

- TodoWrite ツールで TODO ステータスを更新する
  - 現在のTODOを「completed」にマーク
  - テストケース定義フェーズの完了をTODO内容に反映
  - 次のフェーズ「Redフェーズ（失敗テスト作成）」をTODOに追加
  - 品質判定結果をTODO内容に記録
- 次のステップ表示: 「次のお勧めステップ: `/tdd-red {要件名} {{TASK-ID}}` でRedフェーズ（失敗テスト作成）を開始します。」

# rules

## ファイル名のルール

### 出力ファイルのパス形式
- `docs/implements/{要件名}/{task_id}/{feature_name}-testcases.md`
- 例: `docs/implements/user-auth/task-001/login-testcases.md`

### ファイル名の命名規則
- 機能名を簡潔な英語に変換する
- ケバブケース（kebab-case）を使用
- 最大50文字程度に収める
- 例:
  - "ユーザー認証機能" → "user-auth"
  - "データエクスポート機能" → "data-export"
  - "パスワードリセット機能" → "password-reset"

## 品質判定基準

```
✅ 高品質:
- テストケース分類: 正常系・異常系・境界値が網羅されている
- 期待値定義: 各テストケースの期待値が明確
- 技術選択: プログラミング言語・テストフレームワークが確定
- 実装可能性: 現在の技術スタックで実現可能
- 信頼性レベル: 🔵（青信号）が多い

⚠️ 要改善:
- テストケースに漏れや重複がある
- 期待値が曖昧または不十分
- 技術選択に迷いがある
- 複雑すぎて実装困難
- 信頼性レベル: 🟡🔴（黄・赤信号）が多い

❌ 不適切:
- 要件との整合性が取れていない
- テストケースが不足している
- 技術的実現性に問題がある
```

## TODO更新パターン

```
- 現在のTODO「テストケース洗い出し」を「completed」にマーク
- テストケース定義フェーズの完了をTODO内容に反映
- 次のフェーズ「Redフェーズ（失敗テスト作成）」をTODOに追加
- 品質判定結果をTODO内容に記録
```

## 信頼性レベル指示

各テストケースについて、元の資料（要件定義、既存実装、ライブラリドキュメント等）との照合状況を以下の信号でコメントしてください：

- 🔵 **青信号**: 元の資料を参考にしてほぼ推測していない場合
- 🟡 **黄信号**: 元の資料から妥当な推測の場合
- 🔴 **赤信号**: 元の資料にない推測の場合

## ファイルパスの記載ルール

- **プロジェクトルートを基準とした相対パスを使用する**
- フルパス（絶対パス）は記載しない
- 例:
  - ❌ `/Users/username/projects/myapp/src/utils/helper.ts`
  - ✅ `src/utils/helper.ts`

# info

<testcases_template>
あなたはテスト設計の担当者です。以下の情報に基づいて、網羅的なテストケースを作成してください。

# テストケース作成対象の情報

機能名: {{機能名}}
タスクID: {{タスクID}}
要件名: {{要件名}}
出力ファイル名: {{出力ファイル名}}

# 重要な注意事項

**すべてのファイルパスは、プロジェクトルートを基準とした相対パスで記載してください。**
**絶対パス（/Users/... や C:\... など）は使用しないでください。**

例:
- ❌ `/Users/username/projects/myapp/src/utils/helper.ts`
- ✅ `src/utils/helper.ts`

# テストケース作成手順

既に読み込まれた以下のコンテキスト情報を活用してください：
- **タスクノート**（`note.md`）
  - 技術スタック（使用技術・フレームワーク・アーキテクチャパターン）
  - 開発ルール（コーディング規約・型チェック・テスト要件）
  - 関連実装（既存の実装パターン・参考コード）
  - 設計文書（データモデル・ディレクトリ構造）
  - 注意事項（技術的制約・セキュリティ要件・パフォーマンス要件）
- **要件定義書**（`{feature_name}-requirements.md`）
  - 機能の概要
  - 入力・出力の仕様
  - 制約条件
  - 想定される使用例
- 追加ルール（`docs/rule`, `docs/rule/tdd`, `docs/rule/tdd/testcases`）
- 既存のテストケース・テストパターン

これらの情報を基に、以下のフォーマットでテストケースを作成してください。

## TDD用テストケースフォーマット

**【信頼性レベル指示】**:
各テストケースについて、元の資料（要件定義、既存実装、ライブラリドキュメント等）との照合状況を以下の信号でコメントしてください：

- 🔵 **青信号**: 元の資料を参考にしてほぼ推測していない場合
- 🟡 **黄信号**: 元の資料から妥当な推測の場合
- 🔴 **赤信号**: 元の資料にない推測の場合

### 1. 正常系テストケース（基本的な動作）

以下の形式で記載してください：

- **テスト名**: [わかりやすい日本語名]
  - **何をテストするか**: [このテストで確認したい具体的な動作や機能]
  - **期待される動作**: [どのような処理が正常に実行されるべきか]
- **入力値**: [具体的な値]
  - **入力データの意味**: [なぜこの入力値を選んだか、何を代表しているか]
- **期待される結果**: [具体的な期待値]
  - **期待結果の理由**: [なぜこの結果が正しいとされるか]
- **テストの目的**: [何を確認するか]
  - **確認ポイント**: [特に注意して検証すべき点]
- 🔵🟡🔴 このテストケースの信頼性レベルを記載

### 2. 異常系テストケース（エラーハンドリング）

- **テスト名**: [わかりやすい日本語名]
  - **エラーケースの概要**: [どのような異常状況を想定しているか]
  - **エラー処理の重要性**: [なぜこのエラーハンドリングが必要か]
- **入力値**: [不正な値や境界を超えた値]
  - **不正な理由**: [なぜこの入力値が不正とされるか]
  - **実際の発生シナリオ**: [実運用でどのような場面で発生するか]
- **期待される結果**: [適切なエラーメッセージや例外]
  - **エラーメッセージの内容**: [ユーザーにとって分かりやすいメッセージか]
  - **システムの安全性**: [エラー時にシステムが安全な状態を保てるか]
- **テストの目的**: [エラーハンドリングの確認]
  - **品質保証の観点**: [このテストがシステム品質にどう貢献するか]
- 🔵🟡🔴 このテストケースの信頼性レベルを記載

### 3. 境界値テストケース（最小値、最大値、null等）

- **テスト名**: [わかりやすい日本語名]
  - **境界値の意味**: [なぜこの値が境界として重要か]
  - **境界値での動作保証**: [境界付近での動作の一貫性確認]
- **入力値**: [境界値]
  - **境界値選択の根拠**: [なぜこの値を境界値として選んだか]
  - **実際の使用場面**: [実運用でこの境界値がどう影響するか]
- **期待される結果**: [境界での動作]
  - **境界での正確性**: [境界値での計算や処理が正確に行われるか]
  - **一貫した動作**: [境界の内側と外側で動作が一貫しているか]
- **テストの目的**: [境界条件の確認]
  - **堅牢性の確認**: [システムが極端な条件下でも安定動作するか]
- 🔵🟡🔴 このテストケースの信頼性レベルを記載

### 4. 開発言語・フレームワーク

実装に使用する言語・テストフレームワークも併せて指定してください：

- **プログラミング言語**: {{language}}
  - **言語選択の理由**: [なぜこの言語を選んだか]
  - **テストに適した機能**: [この言語のテストに有利な特徴]
- **テストフレームワーク**: {{test_framework}}
  - **フレームワーク選択の理由**: [なぜこのテストフレームワークを選んだか]
  - **テスト実行環境**: [どのような環境でテストを実行するか]
- 🔵🟡🔴 この内容の信頼性レベルを記載

### 5. テストケース実装時の日本語コメント指針

各テストケースの実装時には以下の日本語コメントを必ず含めてください：

#### テストケース開始時のコメント

```javascript
// 【テスト目的】: [このテストで何を確認するかを日本語で明記]
// 【テスト内容】: [具体的にどのような処理をテストするかを説明]
// 【期待される動作】: [正常に動作した場合の結果を説明]
// 🔵🟡🔴 この内容の信頼性レベルを記載
```

#### Given（準備フェーズ）のコメント

```javascript
// 【テストデータ準備】: [なぜこのデータを用意するかの理由]
// 【初期条件設定】: [テスト実行前の状態を説明]
// 【前提条件確認】: [テスト実行に必要な前提条件を明記]
```

#### When（実行フェーズ）のコメント

```javascript
// 【実際の処理実行】: [どの機能/メソッドを呼び出すかを説明]
// 【処理内容】: [実行される処理の内容を日本語で説明]
// 【実行タイミング】: [なぜこのタイミングで実行するかを説明]
```

#### Then（検証フェーズ）のコメント

```javascript
// 【結果検証】: [何を検証するかを具体的に説明]
// 【期待値確認】: [期待される結果とその理由を説明]
// 【品質保証】: [この検証がシステム品質にどう貢献するかを説明]
```

#### 各expectステートメントのコメント

```javascript
// 【検証項目】: [この検証で確認している具体的な項目]
// 🔵🟡🔴 この内容の信頼性レベルを記載
expect(result.validPaths).toHaveLength(2); // 【確認内容】: 有効なパスが正確に2つ検出されることを確認
expect(result.invalidPaths).toContain('nonexistent.json'); // 【確認内容】: 存在しないファイルが無効パスとして適切に分類されることを確認
```

#### セットアップ・クリーンアップのコメント

```javascript
beforeEach(() => {
  // 【テスト前準備】: [各テスト実行前に行う準備作業の説明]
  // 【環境初期化】: [テスト環境をクリーンな状態にする理由と方法]
});

afterEach(() => {
  // 【テスト後処理】: [各テスト実行後に行うクリーンアップ作業の説明]
  // 【状態復元】: [次のテストに影響しないよう状態を復元する理由]
});
```

### 6. 要件定義との対応関係

要件定義書を参照した場合、以下の対応関係を明記してください：

- **参照した機能概要**: [要件定義の該当セクション]
- **参照した入力・出力仕様**: [要件定義の該当セクション]
- **参照した制約条件**: [要件定義の該当セクション]
- **参照した使用例**: [要件定義の該当セクション]

# 出力形式

上記のフォーマットに従って、テストケースを作成してください。

必ず Write ツールを使用して、{{出力ファイル名}} に結果を保存してください。
既存ファイルがある場合は、内容を追記してください。
</testcases_template>
